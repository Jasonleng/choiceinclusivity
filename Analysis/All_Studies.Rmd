---
title: "ORXOR-four studies together"
output:
  html_document:
    code_folding: hide
    number_sections: true
    toc: true
    toc_depth: 4
    toc_float: true
---

```{r library, include=FALSE}
library(MASS)
library(dplyr)
library(tidyr)
library(sjPlot)
library(lme4)
library(effects)
library(ggplot2)
library(brms)
library(gridExtra)
library(mclust)


getMultiBest <- function(x) {
  sorted<-sort(x)
  if(sorted[3]==sorted[4]) return(TRUE)
  else return(FALSE)
}

getMultiWorst <- function(x) {
  sorted<-sort(x)
  if(sorted[1]==sorted[2]) return(TRUE)
  else return(FALSE)
}


getMaxValue <- function(x) {
  return(max(x))
}

getSecondValue <- function(x) {
  sx = sort(x)
  return(sx[3])
}

getThirdValue <- function(x) {
  sx = sort(x)
  return(sx[2])
}

getMinValue <- function(x) {
  return(min(x))
}

getSecond <- function(x,y) {
  if(max(y)>=2)
    return(x[y==2])
  else
    return(-1)
}


getThird <- function(x,y) {
  if(max(y)>=3)
    return(x[y==3])
  else
    return(-1)
}

getFourth <- function(x,y) {
  if(max(y)>=4)
    return(x[y==4])
  else
    return(-1)
}

getMeanChosen <- function(x,y) {
  if(max(y)>0)
    return(mean(x[y>0]))
  else
    return(-1)
}


getMinChosen <- function(x,y) {
  if(max(y)>0)
    return(min(x[y>0]))
  else
    return(-1)
}

getNUFChosen <- function(x,y,z) {
  if(max(y)>0)
  {
    selected <- x[y>0]
    return(length(selected[selected<z]))
  }
  else
    return(-1)
}

getNUF <- function(x,z) {
  return(length(x[x<z]))
}


getMeanUnChosen <- function(x,y) {
  if(max(y)>0)
    return(mean(x[y<0]))
  else
    return(-1)
}


getMinUnChosen <- function(x,y) {
  if(max(y)<4)
    return(min(x[y<0]))
  else
    return(-1)
}



getNUFUnChosen <- function(x,y,z) {
  if(max(y)<4)
  {
    unselected <- x[y<0]
    return(length(unselected[unselected<z]))
  }
  else
    return(0)
}


getSumRT <- function(x,y) {
  return(max(x[y>0]))
}


std <- function(x) sd(x)/sqrt(length(x))

```

# Study 1: In-lab ORXOR


```{r standardize1, include=FALSE}

df.total.valid.1 <- read.csv('../Data/Study1/inlab/Study1a_1.csv')
df.rating.1 <- read.csv('../Data/Study1/inlab/Study1a_2.csv')


df.rating.1.summary <- df.rating.1 %>% group_by(participant) %>%
  summarise(medianValue=median(value),
            avgValue=mean(value)) %>% ungroup()

df.total.rt.1 <- df.total.valid.1 %>% filter(firstRT>0)
```

# Study 2: Online ORXOR

```{r}

df.total.valid.2 <- read.csv('../Data/Study1/online/Study1b_1.csv')
df.rating.2 <- read.csv('../Data/Study1/online/Study1b_2.csv')

df.rating.2.summary <- df.rating.2 %>% group_by(participant) %>%
  summarise(medianValue=median(value),
            avgValue=mean(value)) %>% ungroup()
```


```{r standardize2.good, include=FALSE}
df.total.valid.2 <- df.total.valid.2

df.total.rt.2 <- df.total.valid.2 %>% filter(firstRT>0.1)
```

# Study 3: Online ORXOR-D

```{r}

df.total.valid.3 <- read.csv('../Data/Study2/Study2_1.csv')
df.rating.3 <- read.csv('../Data/Study2/Study2_2.csv')

df.rating.3.summary <- df.rating.3 %>% group_by(participant) %>%
  summarise(medianValue=median(value),
            avgValue=mean(value)) %>% ungroup()
```


```{r, include=FALSE}
df.total.valid.3 <- df.total.valid.3 %>% 
  dplyr::mutate(scaledMeanValue=scale(meanValue),
                scaledValueDiff=scale(valueDiff),
                scaledTrialNum=scale(trialN),
                catChoiceCondition=relevel(factor(catChoiceCondition),ref='XOR'))

df.total.rt.3 <- df.total.valid.3 %>% filter(firstRT>0.1) %>%
  dplyr::mutate(scaledMeanValue=scale(meanValue),
                scaledValueDiff=scale(valueDiff),
                scaledTrialNum=scale(trialN),
                scaledLogFirstRT=scale(log10(firstRT)),
                acc=factor(isBestFirst))

contrasts(df.total.rt.3$catChoiceCondition)<-contr.sdif
contrasts(df.total.rt.3$acc)<-contr.sdif
contrasts(df.total.valid.3$catChoiceCondition)<-contr.sdif
```

# Apply exclusion criteria

Study 2 and 3: matched with study 1 regarding the likelihood of opposite actions

```{r}
df.total.rt.12 <- rbind(df.total.rt.1 %>% dplyr::select(-sex) %>% mutate(study='S1',
                                                                  participant=as.character(participant)),
                        df.total.rt.2 %>% mutate(study='S2')) %>%
  dplyr::mutate(scaledMeanValue=scale(meanValue),
                scaledValueDiff=scale(valueDiff),
                scaledTrialNum=scale(trialN),
                catChoiceCondition=relevel(factor(catChoiceCondition),ref='XOR'),
                acc=as.factor(isBestFirst==1))
df.total.valid.12 <- rbind(df.total.valid.1 %>% dplyr::select(-sex) %>% mutate(study='S1',
                                                                        participant=as.character(participant)),
                           df.total.valid.2 %>% mutate(study='S2')) %>% mutate(study=factor(study)) %>%
  dplyr::mutate(scaledMeanValue=scale(meanValue),
                scaledValueDiff=scale(valueDiff),
                scaledTrialNum=scale(trialN),
                catChoiceCondition=relevel(factor(catChoiceCondition),ref='XOR'))
contrasts(df.total.rt.12$catChoiceCondition)<-contr.sdif
contrasts(df.total.rt.12$acc)<-contr.sdif
contrasts(df.total.valid.12$catChoiceCondition)<-contr.sdif
```


## Selection Task - Models


```{r}
model.RT.12 <- lmerTest::lmer(firstRT ~ catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff + scaledTrialNum + 
                     (1 + catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),
                   data=df.total.rt.12)

anova(model.RT.12)

model.acc.12 <- glmer(isBestFirst ~ catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff +
                        scaledTrialNum + 
                     (1 + catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff +
                        scaledTrialNum|participant),
                     data=df.total.rt.12,family=binomial,control = glmerControl(optCtrl = list(maxfun=20000)))


anova(model.acc.12)

tab_model(model.RT.12,model.acc.12,transform = NULL,show.re.var = F,pred.labels = c("Intercept","Inclusivity","Overall Value","Relative Value","Trial Order","Incl by OV","Incl by RV"),dv.labels = c("RT","Accuracy"),show.stat = T,show.r2 = F,show.ngroups = F,show.obs = F,show.icc = F)
```

```{r}

model.acc.12.dummy <- lmer(isBestFirst ~ catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff +
                        scaledTrialNum + 
                     (1 + catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff +
                        scaledTrialNum|participant),
                     data=df.total.rt.12,control = lmerControl(optCtrl = list(maxfun=20000)))


```


```{r}
model.RT.12.coeff <- lmerTest::lmer(firstRT ~ catChoiceCondition / scaledMeanValue + catChoiceCondition / scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition / scaledMeanValue + catChoiceCondition / scaledValueDiff + scaledTrialNum|participant), 
                   data=df.total.rt.12,
                   control=lmerControl(optCtrl=list(maxfun=1e6)))

model.acc.12.coeff <- glmer(isBestFirst ~ catChoiceCondition / scaledMeanValue + catChoiceCondition / scaledValueDiff + scaledTrialNum + 
                     (1 + catChoiceCondition / scaledMeanValue + catChoiceCondition / scaledValueDiff + scaledTrialNum|participant),
                     data=df.total.rt.12,family=binomial)

```



```{r}
df.total.rt.12.rr <- df.total.rt.12 %>% mutate(rr=firstValue/firstRT) 


model.rr.12 <- lmerTest::lmer(rr ~ catChoiceCondition * (scaledMeanValue + scaledValueDiff) + scaledTrialNum + 
                     (1 + catChoiceCondition * (scaledMeanValue + scaledValueDiff) + scaledTrialNum|participant),
                   data=df.total.rt.12.rr,
                   control=lmerControl(optCtrl=list(maxfun=1e6)))

tab_model(model.rr.12,dv.labels = c('Reward Rate'),pred.labels = c('Intercept','OR - XOR','Mean Value','Value Diff','Trial Num','Incl X Mean Value','Incl X Value Diff'))
```


```{r}
model.conflict.12 <- lmerTest::lmer(conflict ~ catChoiceCondition * poly(scaledMeanValue,2) + catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * poly(scaledMeanValue,2) + catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.total.valid.12)

tab_model(model.conflict.12,transform = NULL,show.re.var = F,pred.labels = c("Intercept","Inclusivity","Overall Value","Overall Value^2","Relative Value","Trial Order","Incl by OV","Incl by OV^2","Incl by RV"),dv.labels = c("Conflict"),show.icc=F,show.ngroups = F,show.obs = F,show.r2 = F,show.stat = T)
```


```{r conflict_model.good, warning=TRUE}
df.total.rt.12$scaledRT<-scale(df.total.rt.12$firstRT)

model.conflict.12.rt <- lmerTest::lmer(conflict ~ scaledRT + acc + catChoiceCondition * poly(scaledMeanValue,2) + catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + scaledRT + acc + catChoiceCondition * poly(scaledMeanValue,2) + catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.total.rt.12)

tab_model(model.conflict.12.rt,transform = NULL,show.re.var = F,pred.labels = c("Intercept","RT","Accuracy","Inclusivity","Overall Value","Overall Value^2","Relative Value","Trial Order","Incl by OV","Incl by OV^2","Incl by RV"),dv.labels = c("Conflict"),show.icc=F,show.ngroups = F,show.obs = F,show.r2 = F,show.stat = T)
```

```{r}
df.total.valid.12.lvd <- df.total.valid.12 %>% filter(valueDiff<1) %>%
  mutate(scaledMeanValue=scale(meanValue),
         scaledValueDiff=scale(valueDiff),
         scaledTrialNum=scale(trialN))


model.conflict.12.lvd <- lmerTest::lmer(conflict ~ catChoiceCondition * poly(scaledMeanValue,2) + catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * poly(scaledMeanValue,2) + catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.total.valid.12.lvd)

tab_model(model.conflict.12.lvd,transform = NULL,show.re.var = F,pred.labels = c("Intercept","Inclusivity","Overall Value","Overall Value^2","Relative Value","Trial Order","Incl by OV","Incl by OV^2","Incl by RV"),dv.labels = c("Conflict"),show.ngroups = F,show.obs = F,show.r2=F,show.stat = T)
```


```{r}
p1 <- ggplot(df.total.rt.12 %>% filter(catChoiceCondition=='XOR'), aes(meanValue,valueDiff)) + geom_point(color='#0673C3',size=0.5) + theme_classic() + xlab('Overall Value') + ylab('Relative Value') + theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6),strip.text.y = element_blank(),axis.line=element_line(colour='black',size=0.2),axis.ticks=element_line(colour='black',size=0.2))
p1 <- ggExtra::ggMarginal(p1, type = "histogram") 

p2 <- ggplot(df.total.rt.12 %>% filter(catChoiceCondition=='OR'), aes(meanValue,valueDiff)) + geom_point(color='#00B024',size=0.5) + theme_classic() +  xlab('Overall Value') + ylab('Relative Value') + theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6),strip.text.y = element_blank(),axis.line=element_line(colour='black',size=0.2),axis.ticks=element_line(colour='black',size=0.2))
p2 <- ggExtra::ggMarginal(p2, type = "histogram") 

ggsave(filename = '../Figures/Figure_MVDV1.pdf',p1,units = 'cm',width = 3,height = 3)
ggsave(filename = '../Figures/Figure_MVDV2.pdf',p2,units = 'cm',width = 3,height = 3)
```


```{r fig.width=2,fig.height=2}
eff_mv.cfl.12 <- Effect(c("scaledMeanValue","catChoiceCondition"),
                   model.conflict.12.lvd,
                   xlevels=list(scaledMeanValue=seq(quantile(df.total.valid.12$scaledMeanValue,0.025),
                                                    quantile(df.total.valid.12$scaledMeanValue,0.975),0.1)))
IA.mv.cfl.12 <- as.data.frame(eff_mv.cfl.12)

IA.mv.cfl.12$catChoiceCondition <- relevel(IA.mv.cfl.12$catChoiceCondition,ref = 'XOR')

p.eff.mv.cfl.12<-ggplot(data=IA.mv.cfl.12, aes(x=scaledMeanValue, y=fit,group=catChoiceCondition)) + 
  geom_line(size=0.5,aes(color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.mv.cfl.12, aes(x=scaledMeanValue, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab("Conflict") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), plot.title = element_text(hjust = 0.5,size=6),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6),strip.text.y = element_blank(),axis.line=element_line(colour='black',size=0.2),axis.ticks=element_line(colour='black',size=0.2)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024','#008012')) + 
  scale_color_manual("",values=c('#0673C3','#00B024','#008012')) + 
  coord_cartesian(ylim=c(1,5)) + scale_y_continuous(breaks = c(1,5))

ggsave(filename = '../Figures/Figure_LVD.pdf',p.eff.mv.cfl.12,units = 'cm',width = 3,height = 3)
```



```{r}

df.volun.summary <- df.total.rt.12 %>% filter(catChoiceCondition=='OR',NChosen >= 1) %>% 
  rowwise() %>% dplyr::mutate(totalRT=getSumRT(c(RT1,RT2,RT3,RT4),
                                        c(Order1,Order2,Order3,Order4))) %>% ungroup() %>%
  group_by(NChosen) %>% summarise(ntrial=n(),
                                  meanSumRT=mean(totalRT))

df.volun.RT.summary.1 <- df.total.rt.12 %>% filter(catChoiceCondition=='OR',firstRT>0) %>% group_by(NChosen) %>%
  summarise(sRT=mean(firstRT)) %>% mutate(selection = 1)

df.volun.RT.summary.2 <- df.total.rt.12 %>% rowwise() %>% mutate(secondRT=getSecond(c(RT1,RT2,RT3,RT4),
                                        c(Order1,Order2,Order3,Order4))) %>% ungroup() %>% filter(catChoiceCondition=='OR',secondRT>0) %>% group_by(NChosen) %>%
  summarise(sRT=mean(secondRT-firstRT)) %>% mutate(selection = 2)

df.volun.RT.summary.3 <- df.total.rt.12 %>% 
  rowwise() %>% dplyr::mutate(secondRT=getSecond(c(RT1,RT2,RT3,RT4),
                                        c(Order1,Order2,Order3,Order4)),thirdRT=getThird(c(RT1,RT2,RT3,RT4),
                                        c(Order1,Order2,Order3,Order4))) %>% ungroup() %>% filter(catChoiceCondition=='OR',thirdRT>0) %>%  group_by(NChosen) %>%
  summarise(sRT=mean(thirdRT-secondRT)) %>% mutate(selection = 3)

df.volun.RT.summary.4 <- df.total.rt.12 %>% 
  rowwise() %>% dplyr::mutate(fourthRT=getFourth(c(RT1,RT2,RT3,RT4),
                                        c(Order1,Order2,Order3,Order4)),
                              thirdRT=getThird(c(RT1,RT2,RT3,RT4),
                                        c(Order1,Order2,Order3,Order4))) %>% ungroup() %>% filter(catChoiceCondition=='OR',fourthRT>0) %>%  group_by(NChosen) %>%
  summarise(sRT=mean(fourthRT-thirdRT)) %>% mutate(selection = 4)

df.volun.RT.summary <- inner_join(rbind(df.volun.RT.summary.1,df.volun.RT.summary.2,
                             df.volun.RT.summary.3,df.volun.RT.summary.4) %>%  pivot_wider(
    names_from = selection,
    values_from = sRT,names_prefix='sRT_'
  ),df.volun.summary,by='NChosen')
```




```{r}
coeff.rt <- t(fixef(model.RT.12)['catChoiceConditionOR-XOR'])
df.ci <- confint(model.RT.12,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.rt <- df.ci['catChoiceConditionOR-XOR',]
estimate.rt <- cbind(coeff.rt,t(ci.rt))
colnames(estimate.rt)<-c('coeff','lower','upper')

coeff.acc <- t(fixef(model.acc.12.dummy)['catChoiceConditionOR-XOR'])
df.ci <- confint(model.acc.12.dummy,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.acc <- df.ci['catChoiceConditionOR-XOR',]
estimate.acc <- cbind(coeff.acc,t(ci.acc))
colnames(estimate.acc)<-c('coeff','lower','upper')

coeff.conf <- t(fixef(model.conflict.12)['catChoiceConditionOR-XOR'])
df.ci <- confint(model.conflict.12,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.conf <- df.ci['catChoiceConditionOR-XOR',]
estimate.conf <- cbind(coeff.conf,t(ci.conf))
colnames(estimate.conf)<-c('coeff','lower','upper')

coeff.rr <- t(fixef(model.rr.12)['catChoiceConditionOR-XOR'])
df.ci <- confint(model.rr.12,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.rr <- df.ci['catChoiceConditionOR-XOR',]
estimate.rr <- cbind(coeff.rr,t(ci.rr))
colnames(estimate.rr)<-c('coeff','lower','upper')

estimate.all <- data.frame(rbind(estimate.rt,estimate.acc,estimate.conf,estimate.rr))
estimate.all$var <- c('RT','Acc','Conflict','RR')
```


```{r,fig.width=2,fig.height=2}
p.diff.acc.12 <- ggplot(estimate.all %>% filter(var %in% c('Acc')), aes(x=var, y=coeff))  + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  geom_point(stat="identity", position=position_dodge(0.6),size=0.5) +
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.1,size=0.4,
                 position=position_dodge(.6))+labs(x="", y = "Effect of Inclusivity")+theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks =element_line(size=0.2),
        text=element_text(size=6),legend.position="none") +
  scale_x_discrete(labels=c("Acc"='P(Best First)')) + scale_y_continuous(limits = c(-0.1,0.004),breaks = c(-0.1,0))
p.diff.acc.12
```


```{r fig.height=2,fig.width=2}
p.diff.rt.12 <- ggplot(estimate.all %>% filter(var %in% c('RT')), aes(x=var, y=coeff))  + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  geom_point(stat="identity", position=position_dodge(0.6),size=0.5) +
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.1,size=0.4,
                 position=position_dodge(.6))+labs(x="", y = "Effect of Inclusivity\n(sec)")+theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks =element_line(size=0.2),
        text=element_text(size=6),legend.position="none") +
  scale_x_discrete(labels=c("RT"='RT')) + scale_y_continuous(limits = c(-0.5,0.02),breaks = c(-0.5,0))

p.diff.rt.12
```


```{r fig.height=2,fig.width=2}
p.diff.conflict.12 <- ggplot(estimate.all %>% filter(var %in% c('Conflict')), aes(x=var, y=coeff))  + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  geom_point(stat="identity", position=position_dodge(0.6),size=0.5) +
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.1,size=0.4,
                 position=position_dodge(.6))+labs(x="", y = "Effect of Inclusivity")+theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks =element_line(size=0.2),
        text=element_text(size=6),legend.position="none") +
  scale_x_discrete(labels=c("Conflict"='Conflict')) + scale_y_continuous(limits = c(-1,.02),breaks = c(-1,0))
p.diff.conflict.12
```


```{r fig.height=2,fig.width=2}
p.diff.rr.12 <- ggplot(estimate.all %>% filter(var %in% c('RR')), aes(x=var, y=coeff))  + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  geom_point(stat="identity", position=position_dodge(0.6),size=0.5) +
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.1,size=0.4,
                 position=position_dodge(.6))+labs(x="", y = "Effect of Inclusivity\n(Unit Value/sec)")+theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        text=element_text(size=6),legend.position="none",axis.ticks =element_line(size=0.2)) +
  scale_x_discrete(labels=c("RR"='Reward Rate')) + scale_y_continuous(limits = c(-0.02,0.5),breaks = c(0,0.5))
p.diff.rr.12
```


#### Get predictions about value effects for selection study (1a and 1b)


```{r fig.width=2, fig.height=2}
eff_mv.RT.12 <- Effect(c("scaledMeanValue","catChoiceCondition"),
                   model.RT.12,
                   xlevels=list(scaledMeanValue=seq(quantile(df.total.rt.12$scaledMeanValue,0.025),
                                                    quantile(df.total.rt.12$scaledMeanValue,0.975),0.1)))
IA.mv.RT.12 <- as.data.frame(eff_mv.RT.12) %>% dplyr::mutate(study='Study 12')

p.eff.mv.RT.12<-ggplot(data=IA.mv.RT.12, aes(x=scaledMeanValue, y=fit, group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.mv.RT.12, aes(x=scaledMeanValue, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab("RT (sec)")  + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),legend.justification=c(1,1),legend.position='none',text = element_text(size=6),axis.ticks =element_line(colour='black',size=0.2)) +  
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + 
  coord_cartesian(ylim=c(1,4)) + scale_y_continuous(breaks = c(1,4))
p.eff.mv.RT.12
```


```{r fig.width=2, fig.height=2}
eff_vd.RT.12 <- Effect(c("scaledValueDiff","catChoiceCondition"),
                   model.RT.12,
                   xlevels=list(scaledValueDiff=seq(quantile(df.total.rt.12$scaledValueDiff,0.025),
                                                    quantile(df.total.rt.12$scaledValueDiff,0.975),0.1)))
IA.vd.RT.12 <- as.data.frame(eff_vd.RT.12) %>% dplyr::mutate(study='Study 12')

p.eff.vd.RT.12<-ggplot(data=IA.vd.RT.12, aes(x=scaledValueDiff, y=fit, group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.vd.RT.12, aes(x=scaledValueDiff, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Relative Value\n(z-scored)") + ylab("RT (sec)")  + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),legend.justification=c(1,1),legend.position='none',text = element_text(size=6),axis.ticks =element_line(colour='black',size=0.2)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + 
  coord_cartesian(ylim=c(1,4)) + scale_y_continuous(breaks = c(1,4))
p.eff.vd.RT.12
```

```{r fig.width=2, fig.height=2}
eff_mv.Acc.12 <- Effect(c("scaledMeanValue","catChoiceCondition"),
                   model.acc.12,
                   xlevels=list(scaledMeanValue=seq(quantile(df.total.rt.12$scaledMeanValue,0.025),
                                                    quantile(df.total.rt.12$scaledMeanValue,0.975),0.1)))
IA.mv.Acc.12 <- as.data.frame(eff_mv.Acc.12) %>% dplyr::mutate(study='Study 12')

p.eff.mv.Acc.12<-ggplot(data=IA.mv.Acc.12, aes(x=scaledMeanValue, y=fit, group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.mv.Acc.12, aes(x=scaledMeanValue, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab("P(Best First)") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),legend.justification=c(1,1),legend.position='none',text = element_text(size=6),axis.ticks =element_line(colour='black',size=0.2)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + 
  coord_cartesian(ylim=c(0.1,0.9)) + scale_y_continuous(breaks = c(0.1,0.9))
p.eff.mv.Acc.12
```


```{r fig.width=2, fig.height=2}
eff_vd.Acc.12 <- Effect(c("scaledValueDiff","catChoiceCondition"),
                   model.acc.12,
                   xlevels=list(scaledValueDiff=seq(quantile(df.total.rt.12$scaledValueDiff,0.025),
                                                    quantile(df.total.rt.12$scaledValueDiff,0.975),0.1)))
IA.vd.Acc.12 <- as.data.frame(eff_vd.Acc.12) %>% dplyr::mutate(study='Study 12')

p.eff.vd.Acc.12<-ggplot(data=IA.vd.Acc.12, aes(x=scaledValueDiff, y=fit, group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.vd.Acc.12, aes(x=scaledValueDiff, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Relative Value\n(z-scored)") + ylab("P(Best First)") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),legend.justification=c(1,1),legend.position='none',text = element_text(size=6),axis.ticks =element_line(colour='black',size=0.2)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + 
  coord_cartesian(ylim=c(0.1,0.9)) + scale_y_continuous(breaks = c(0.1,0.9))
p.eff.vd.Acc.12
```


```{r}
lay <- rbind(c(1, 4, 4, 4, 7),
             c(2, 2, NA,3, 3),
             c(5, 5, NA,6, 6))

plots <- list(p.diff.rt.12,p.eff.vd.RT.12,p.eff.vd.Acc.12,
              p.diff.acc.12,p.eff.mv.RT.12,p.eff.mv.Acc.12,p.diff.rr.12)
grobs <- list()
widths <- list()
heights <- list()

for (i in 1:length(plots)){
    grobs[[i]] <- ggplotGrob(plots[[i]])
    widths[[i]] <- grobs[[i]]$widths
    heights[[i]] <- grobs[[i]]$heights
}

maxwidth <- do.call(grid::unit.pmax, widths)
maxheight <- do.call(grid::unit.pmax,heights)

for (i in c(2,3,5,6)){
     grobs[[i]]$widths <- as.list(maxwidth)
}

for (i in 1:length(grobs)){
     grobs[[i]]$heights <- as.list(maxheight)
}

widths <- list()

for (i in c(1,4,7)){
    widths[[i]] <- grobs[[i]]$widths
}

maxwidth <- do.call(grid::unit.pmax,widths)

for (i in c(1,4,7)){
     grobs[[i]]$widths <- as.list(maxwidth)
}

p<-grid.arrange(grobs = grobs, layout_matrix = lay,widths=unit(c(2,0.9,0.2,0.9,2), c("cm", "cm")),heights=unit(c(3,3,3),c('cm','cm')))

ggsave(filename = '../Figures/Figure2.pdf',p,units = 'cm',width = 10,height = 15)
```

## Prepare simulation

```{r}
df.total.rt.values <- df.total.rt.12 %>% dplyr::select(Value1,Value2,Value3,Value4)
write.csv(x = df.total.rt.values,file = '../Model/data/trial/simulation_value_12.csv',row.names = F,col.names = T)
```


```{r}
coeff.mat.RT.12 <- coef(summary(model.RT.12.coeff))
coeff.mat.RT.12.ov <- data.frame(coeff.mat.RT.12[c('catChoiceConditionOR:scaledMeanValue',
                                      'catChoiceConditionXOR:scaledMeanValue'),
                                    c('Estimate','Std. Error')])
coeff.mat.RT.12.ov$catChoiceCondition <- c('OR','XOR')
colnames(coeff.mat.RT.12.ov) <- c('beta_OV','se_OV','catChoiceCondition')
coeff.mat.RT.12.vd <- data.frame(coeff.mat.RT.12[c('catChoiceConditionOR:scaledValueDiff',
                                      'catChoiceConditionXOR:scaledValueDiff')
                                    ,c('Estimate','Std. Error')])
coeff.mat.RT.12.vd$catChoiceCondition <- c('OR','XOR')
colnames(coeff.mat.RT.12.vd) <- c('beta_VD','se_VD','catChoiceCondition')

coeff.mat.RT.12 <- inner_join(data.frame(coeff.mat.RT.12.ov),
                             data.frame(coeff.mat.RT.12.vd),by='catChoiceCondition') %>% mutate(study='Study 12')
rownames(coeff.mat.RT.12) <- NULL

coeff.mat.RT <- rbind(coeff.mat.RT.12)

coeff.mat.Acc.12 <- coef(summary(model.acc.12.coeff))
coeff.mat.Acc.12.ov <- data.frame(coeff.mat.Acc.12[c('catChoiceConditionOR:scaledMeanValue',
                                      'catChoiceConditionXOR:scaledMeanValue'),
                                    c('Estimate','Std. Error')])
coeff.mat.Acc.12.ov$catChoiceCondition <- c('OR','XOR')
colnames(coeff.mat.Acc.12.ov) <- c('beta_OV','se_OV','catChoiceCondition')
coeff.mat.Acc.12.vd <- data.frame(coeff.mat.Acc.12[c('catChoiceConditionOR:scaledValueDiff',
                                      'catChoiceConditionXOR:scaledValueDiff')
                                    ,c('Estimate','Std. Error')])
coeff.mat.Acc.12.vd$catChoiceCondition <- c('OR','XOR')
colnames(coeff.mat.Acc.12.vd) <- c('beta_VD','se_VD','catChoiceCondition')

coeff.mat.Acc.12 <- inner_join(data.frame(coeff.mat.Acc.12.ov),
                             data.frame(coeff.mat.Acc.12.vd),by='catChoiceCondition') %>% mutate(study='Study 12')
rownames(coeff.mat.Acc.12) <- NULL

coeff.mat.Acc <- rbind(coeff.mat.Acc.12)

#coeff.mat.RT$catChoiceCondition <- rownames(coeff.mat.RT)
```

```{r}
eff_cc.acc.12 <- Effect(c("catChoiceCondition"),model.acc.12.coeff)
IA.cc.acc.12 <- as.data.frame(eff_cc.acc.12) %>% dplyr::mutate(study='Study 12')

IA.cc.acc <- rbind(IA.cc.acc.12) %>% 
  dplyr::mutate(catChoiceCondition=factor(catChoiceCondition,levels=c('XOR','OR')))

eff_cc.RT.12 <- Effect(c("catChoiceCondition"),model.RT.12.coeff)
IA.cc.RT.12 <- as.data.frame(eff_cc.RT.12) %>% dplyr::mutate(study='Study 12')

IA.cc.RT <- rbind(IA.cc.RT.12) %>% 
  dplyr::mutate(catChoiceCondition=factor(catChoiceCondition,levels=c('XOR','OR')))

```

```{r fig.height=2,fig.width=3}

IA.cc.acc.rt <- inner_join(IA.cc.acc %>% dplyr::select(catChoiceCondition,fit,se,study) %>%
                             rename(I_acc=fit,se_acc=se),
                           IA.cc.RT %>% dplyr::select(catChoiceCondition,fit,se,study) %>%
                             rename(I_rt=fit,se_rt=se),by=c('catChoiceCondition','study'))
```


```{r}
write.csv(coeff.mat.Acc,'../Model/data/outcome/coeff_acc_12.csv',row.names = F,col.names = T)
write.csv(coeff.mat.RT,'../Model/data/outcome/coeff_rt_12.csv',row.names = F,col.names = T)
write.csv(IA.cc.acc.rt,'../Model/data/outcome/intercept_acc_rt_12.csv',row.names = F,col.names = T)
```

### LCA stuff goes here


```{r}

coeff.mat.Acc <- read.csv('../Model/data/outcome/coeff_acc_12.csv')
coeff.mat.RT <- read.csv('../Model/data/outcome/coeff_rt_12.csv')
IA.cc.acc.rt <- read.csv('../Model/data/outcome/intercept_acc_rt_12.csv')

```



```{r}
prediction12_full <- read.csv('../Model/gridsearch/result/prediction_task_12_full.csv') %>% 
  mutate(catChoiceCondition=relevel(factor(condition),'XOR'))
prediction12_inhi <- read.csv('../Model/gridsearch/result/prediction_task_12_inhib.csv') %>% 
  mutate(catChoiceCondition=relevel(factor(condition),'XOR'))
prediction12_thre <- read.csv('../Model/gridsearch/result/prediction_task_12_thresh.csv') %>% 
  mutate(catChoiceCondition=relevel(factor(condition),'XOR'))
prediction12_end <- read.csv('../Model/gridsearch/result/prediction_task_12_ddl.csv') %>% 
  mutate(catChoiceCondition=relevel(factor(condition),'XOR'))
prediction12_bound <- read.csv('../Model/gridsearch/result/prediction_task_12_bound.csv') %>% 
  mutate(catChoiceCondition=relevel(factor(condition),'XOR'))
```


```{r}

df.inhib <- read.csv('../Model/gridsearch/result/trend_m.csv')
df.thres <- read.csv('../Model/gridsearch/result/trend_a.csv')
df.end <- read.csv('../Model/gridsearch/result/trend_theta.csv')
```


```{r fig.height=1,fig.width=1}

p1 <- ggplot() + 
  geom_path(data = df.thres,aes(x=b1_RT,y=b2_RT),color='#587F13',alpha=0.5) + 
  geom_point(data = df.thres,aes(x=b1_RT,y=b2_RT),color='#587F13',size=0.5,alpha=0.5) + 
  geom_path(data = df.end,aes(x=b1_RT,y=b2_RT),color='#5E1796',alpha=0.5) + 
  geom_point(data = df.end,aes(x=b1_RT,y=b2_RT),color='#5E1796',size=0.5,alpha=0.5) + 
  
  geom_path(data = df.inhib,aes(x=b1_RT,y=b2_RT),color='red') + 
  geom_point(data = df.inhib,aes(x=b1_RT,y=b2_RT),color='red',size=0.5) + xlab('OV Effect on RT') + ylab('RV Effect on RT') +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black",size=0.2),text = element_text(size=6),axis.ticks = element_line(color='black',size=0.2)) + 
  scale_y_continuous(labels=function(x) sprintf("%.1f", x),limits = c(-0.4,-0),breaks = c(-0.4,-0))  + 
  scale_x_continuous(labels=function(x) sprintf("%.1f", x),limits = c(-0.5,-0.1),breaks = c(-0.5,-0.1))


p1

```

```{r fig.height=1,fig.width=1}

p2<-ggplot() + geom_vline(xintercept = 0,linetype="dashed",size=0.5) +
  geom_path(data = df.thres,aes(x=b1_Acc,y=b2_Acc),color='#587F13',alpha=0.5) + 
  geom_point(data = df.thres,aes(x=b1_Acc,y=b2_Acc),color='#587F13',size=0.5,alpha=0.5) + 
  geom_path(data = df.end,aes(x=b1_Acc,y=b2_Acc),color='#5E1796',alpha=0.5) + 
  geom_point(data = df.end,aes(x=b1_Acc,y=b2_Acc),color='#5E1796',size=0.5,alpha=0.5) + 
  
  geom_path(data = df.inhib,aes(x=b1_Acc,y=b2_Acc),color='red') + 
  geom_point(data = df.inhib,aes(x=b1_Acc,y=b2_Acc),color='red',size=0.5) + xlab('OV Effect on Accuracy') + ylab('RV Effect on Accuracy') +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black",size=0.2),text = element_text(size=6),axis.ticks = element_line(color='black',size=0.2)) + 
  scale_y_continuous(labels=function(x) sprintf("%.1f", x),limits = c(.4,.8),breaks = c(.4,.8))  + 
  scale_x_continuous(labels=function(x) sprintf("%.1f", x),limits = c(-0.1,.1),breaks = c(-0.1,.1))
p2

```



```{r fig.height=1,fig.width=1}

p3<-ggplot() + 
  geom_path(data = df.thres,aes(x=I_RT,y=I_Acc),color='#587F13',alpha=0.5) + 
  geom_point(data = df.thres,aes(x=I_RT,y=I_Acc),color='#587F13',size=0.5,alpha=0.5) + 
  geom_path(data = df.end,aes(x=I_RT,y=I_Acc),color='#5E1796',alpha=0.5) + 
  geom_point(data = df.end,aes(x=I_RT,y=I_Acc),color='#5E1796',size=0.5,alpha=0.5) + 
    geom_path(data = df.inhib,aes(x=I_RT,y=I_Acc),color='red') + 
  geom_point(data = df.inhib,aes(x=I_RT,y=I_Acc),color='red',size=0.5) +ylab('Intercept of Accuracy') + xlab('Intercept of RT')+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black",size=0.2),text = element_text(size=6),axis.ticks = element_line(color='black',size=0.2)) + 
  scale_y_continuous(labels=function(x) sprintf("%.1f", x),limits = c(.35,.55),breaks = c(.4,.5))  + 
  scale_x_continuous(labels=function(x) sprintf("%.1f", x),limits = c(0,5),breaks = c(0,5))

p3

```



```{r fig.width=1,fig.height=1}
IA.cc.acc.rt$catChoiceCondition<-relevel(factor(IA.cc.acc.rt$catChoiceCondition),'XOR')


p.pred.real.int<-ggplot(data=IA.cc.acc.rt,aes(x=I_rt,y=I_acc,color=catChoiceCondition)) + geom_line(data=df.inhib,aes(x=I_RT,y=I_Acc),color='red',alpha=0.5,linetype=2,linewidth=0.5) + geom_point(size=1) +
  geom_errorbar(aes(ymin = I_acc-1.96*se_acc, ymax = I_acc+1.96*se_acc),width=.05) +
  geom_errorbarh(aes(xmin = I_rt-1.96*se_rt, xmax = I_rt+1.96*se_rt),height=.005) + xlab('Intercept of RT') + ylab('Intercept of Accuracy') +
  geom_line(data=prediction12_inhi,aes(x=I_RT,y=I_Acc),color='black',linewidth=0.5) +
   geom_point(data=prediction12_inhi,aes(x=I_RT,y=I_Acc,fill=catChoiceCondition),shape=24,size=1,color='black') + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour='black',size=0.2),legend.position = 'none',text = element_text(size=6)) + scale_fill_manual(values=c('#0673C3','#00B024')) +  scale_color_manual(values=c('#0673C3','#00B024')) + scale_x_continuous(limits = c(2.2,3.2),breaks=c(2.2,3.2)) + scale_y_continuous(limits=c(0.4,0.55),breaks=c(0.4,0.55))
p.pred.real.int
# ggsave('figures/int_prediction_data_new_12.pdf',width = 12, height = 6, units = "cm")
```




```{r fig.height=1,fig.width=1}
coeff.mat.RT$catChoiceCondition<-relevel(factor(coeff.mat.RT$catChoiceCondition),'XOR')

df.coeff.mat.RT <- data.frame(coeff.mat.RT)

p.pred.real.RT<-ggplot(data=df.coeff.mat.RT,aes(x=beta_OV,y=beta_VD,color=catChoiceCondition)) +
  geom_line(data=df.inhib,aes(x=b1_RT,y=b2_RT),color='red',alpha=0.5,linetype=2,linewidth=0.5) + geom_point(size=1) +
  geom_errorbar(aes(ymin = beta_VD-1.96*se_VD, ymax = beta_VD+1.96*se_VD),width=.01) +
  geom_errorbarh(aes(xmin = beta_OV-1.96*se_OV, xmax = beta_OV+1.96*se_OV),height=.01) + xlab('OV Effect on RT') + ylab('RV Effect on RT') +  geom_line(data=prediction12_inhi,aes(x=b1_RT,y=b2_RT),color='black',linewidth=0.5) +geom_point(data=prediction12_inhi,aes(x=b1_RT,y=b2_RT,fill=catChoiceCondition),shape=24,size=1,color='black') +
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour='black',size=0.2),legend.position = 'none',text = element_text(size=6)) + scale_fill_manual(values=c('#0673C3','#00B024')) +
  scale_fill_manual(values=c('#0673C3','#00B024')) + scale_color_manual(values=c('#0673C3','#00B024')) + scale_y_continuous(limits = c(-0.3,-.0),breaks=c(-.3,-.0)) + scale_x_continuous(limits=c(-.5,-0.2),breaks=c(-0.5,-0.2))
p.pred.real.RT
# ggsave('figures/RT_prediction_data_new_12.pdf',width = 16, height = 6, units = "cm")
```


```{r fig.width=1,fig.height=1}
coeff.mat.Acc$catChoiceCondition<-relevel(factor(coeff.mat.Acc$catChoiceCondition),'XOR')


p.pred.real.acc<-ggplot(data=data.frame(coeff.mat.Acc),aes(x=beta_OV,y=beta_VD,color=catChoiceCondition)) +
  geom_line(data=df.inhib,aes(x=b1_Acc,y=b2_Acc),color='red',alpha=0.5,linetype=2,linewidth=0.5) +geom_point(size=1) +
  geom_errorbar(aes(ymin = beta_VD-se_VD*1.96, ymax = beta_VD+se_VD*1.96),width=.01) +
  geom_errorbarh(aes(xmin = beta_OV-se_OV*1.96, xmax = beta_OV+se_OV*1.96),height=.01) + xlab('OV Effect on Accuracy') + ylab('RV Effect on Accuracy') + geom_line(data=prediction12_inhi,aes(x=b1_Acc,y=b2_Acc),color='black',linewidth=0.5) +
  geom_point(data=prediction12_inhi,aes(x=b1_Acc,y=b2_Acc,fill=catChoiceCondition),shape=24,size=1,color='black') + 
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour='black',size=0.2),legend.position = 'none',text = element_text(size=6)) + scale_fill_manual(values=c('#0673C3','#00B024')) + scale_fill_manual(values=c('#0673C3','#00B024')) +  scale_color_manual(values=c('#0673C3','#00B024')) + scale_y_continuous(limits = c(.4,.8),breaks=c(.4,.8)) +
  scale_x_continuous(limits=c(-.15,.15),breaks=c(-0.15,.15))
p.pred.real.acc
# ggsave('figures/Acc_prediction_data_new_12.pdf',width = 8, height = 6, units = "cm")
```


```{r}
lay <- rbind(c(1,NA,2,NA,3),c(NA,NA,NA),c(4,NA,5,NA,6))

plots <- list(p3,p1,p2,p.pred.real.int,p.pred.real.RT,p.pred.real.acc)
grobs <- list()
widths <- list()
heights <- list()

for (i in 1:length(plots)){
    grobs[[i]] <- ggplotGrob(plots[[i]])
    widths[[i]] <- grobs[[i]]$widths
    heights[[i]] <- grobs[[i]]$heights
}

maxwidth <- do.call(grid::unit.pmax, widths)
maxheight <- do.call(grid::unit.pmax,heights)

for (i in 1:length(grobs)){
     grobs[[i]]$heights <- as.list(maxheight)
     grobs[[i]]$widths <- as.list(maxwidth)
}

p<-grid.arrange(grobs = grobs, layout_matrix = lay,widths=unit(c(3,0.5,3,0.5,3), c("cm", "cm")),heights=unit(c(3,0.25,3),c('cm','cm')))

ggsave(filename = '../Figures//Figure3_CD.pdf',p,units = 'cm',width = 28,height = 10)
```




```{r fig.width=1,fig.height=1}
p.pred.real.int.inhi<-ggplot(data=IA.cc.acc.rt,aes(x=I_rt,y=I_acc,color=catChoiceCondition)) + geom_point(size=1) +
  geom_errorbar(aes(ymin = I_acc-1.96*se_acc, ymax = I_acc+1.96*se_acc),width=.05) +
  geom_errorbarh(aes(xmin = I_rt-1.96*se_rt, xmax = I_rt+1.96*se_rt),height=.005) + xlab('Intercept of RT') + ylab('Intercept of Accuracy') +
  geom_line(data=prediction12_inhi,aes(x=I_RT,y=I_Acc),color='black',linewidth=0.5) +
   geom_point(data=prediction12_inhi,aes(x=I_RT,y=I_Acc,fill=catChoiceCondition),shape=24,size=1,color='black') + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour='black',size=0.2),legend.position = 'none',text = element_text(size=6)) + scale_fill_manual(values=c('#0673C3','#00B024')) +  scale_color_manual(values=c('#0673C3','#00B024')) + scale_x_continuous(limits = c(2.2,3.2),breaks=c(2.2,3.2)) + scale_y_continuous(limits=c(0.4,0.55),breaks=c(0.4,0.55))
p.pred.real.int.inhi

p.pred.real.RT.inhi<-ggplot(data=df.coeff.mat.RT,aes(x=beta_OV,y=beta_VD,color=catChoiceCondition)) + geom_point(size=1) +
  geom_errorbar(aes(ymin = beta_VD-1.96*se_VD, ymax = beta_VD+1.96*se_VD),width=.01) +
  geom_errorbarh(aes(xmin = beta_OV-1.96*se_OV, xmax = beta_OV+1.96*se_OV),height=.01) + xlab('OV Effect on RT') + ylab('RV Effect on RT') +  geom_line(data=prediction12_inhi,aes(x=b1_RT,y=b2_RT),color='black',linewidth=0.5) +geom_point(data=prediction12_inhi,aes(x=b1_RT,y=b2_RT,fill=catChoiceCondition),shape=24,size=1,color='black') +
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour='black',size=0.2),legend.position = 'none',text = element_text(size=6)) +
  scale_fill_manual(values=c('#0673C3','#00B024')) + scale_color_manual(values=c('#0673C3','#00B024')) + scale_y_continuous(limits = c(-0.3,-.1),breaks=c(-.3,-.1)) + scale_x_continuous(limits=c(-.5,-0.2),breaks=c(-0.5,-0.2))
p.pred.real.RT.inhi

p.pred.real.acc.inhi<-ggplot(data=data.frame(coeff.mat.Acc),aes(x=beta_OV,y=beta_VD,color=catChoiceCondition)) + geom_point(size=1) +
  geom_errorbar(aes(ymin = beta_VD-se_VD*1.96, ymax = beta_VD+se_VD*1.96),width=.01) +
  geom_errorbarh(aes(xmin = beta_OV-se_OV*1.96, xmax = beta_OV+se_OV*1.96),height=.01) + xlab('OV Effect on Accuracy') + ylab('RV Effect on Accuracy') + geom_line(data=prediction12_inhi,aes(x=b1_Acc,y=b2_Acc),color='black',linewidth=0.5) +
  geom_point(data=prediction12_inhi,aes(x=b1_Acc,y=b2_Acc,fill=catChoiceCondition),shape=24,size=1,color='black') + 
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour='black',size=0.2),legend.position = 'none',text = element_text(size=6)) +scale_fill_manual(values=c('#0673C3','#00B024')) +  scale_color_manual(values=c('#0673C3','#00B024')) + scale_y_continuous(limits = c(.4,.8),breaks=c(.4,.8)) +
  scale_x_continuous(limits=c(-.15,.15),breaks=c(-0.15,.15))
p.pred.real.acc.inhi
# ggsave('figures/int_prediction_data_new_12.pdf',width = 12, height = 6, units = "cm")
```


```{r fig.width=1,fig.height=1}
p.pred.real.int.full<-ggplot(data=IA.cc.acc.rt,aes(x=I_rt,y=I_acc,color=catChoiceCondition)) + geom_point(size=1) +
  geom_errorbar(aes(ymin = I_acc-1.96*se_acc, ymax = I_acc+1.96*se_acc),width=.05) +
  geom_errorbarh(aes(xmin = I_rt-1.96*se_rt, xmax = I_rt+1.96*se_rt),height=.005) + xlab('Intercept of RT') + ylab('Intercept of Accuracy') +
  geom_line(data=prediction12_full,aes(x=I_RT,y=I_Acc),color='black',linewidth=0.5) +
   geom_point(data=prediction12_full,aes(x=I_RT,y=I_Acc,fill=catChoiceCondition),shape=24,size=1,color='black') + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour='black',size=0.2),legend.position = 'none',text = element_text(size=6)) + scale_fill_manual(values=c('#0673C3','#00B024')) +  scale_color_manual(values=c('#0673C3','#00B024')) + scale_x_continuous(limits = c(2.2,3.2),breaks=c(2.2,3.2)) + scale_y_continuous(limits=c(0.4,0.55),breaks=c(0.4,0.55))
p.pred.real.int.full

p.pred.real.RT.full<-ggplot(data=df.coeff.mat.RT,aes(x=beta_OV,y=beta_VD,color=catChoiceCondition)) + geom_point(size=1) +
  geom_errorbar(aes(ymin = beta_VD-1.96*se_VD, ymax = beta_VD+1.96*se_VD),width=.01) +
  geom_errorbarh(aes(xmin = beta_OV-1.96*se_OV, xmax = beta_OV+1.96*se_OV),height=.01) + xlab('OV Effect on RT') + ylab('RV Effect on RT') +  geom_line(data=prediction12_full,aes(x=b1_RT,y=b2_RT),color='black',linewidth=0.5) +geom_point(data=prediction12_full,aes(x=b1_RT,y=b2_RT,fill=catChoiceCondition),shape=24,size=1,color='black') +
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour='black',size=0.2),legend.position = 'none',text = element_text(size=6)) +
  scale_fill_manual(values=c('#0673C3','#00B024')) + scale_color_manual(values=c('#0673C3','#00B024')) + scale_y_continuous(limits = c(-0.3,-.1),breaks=c(-.3,-.1)) + scale_x_continuous(limits=c(-.5,-0.2),breaks=c(-0.5,-0.2))
p.pred.real.RT.full

p.pred.real.acc.full<-ggplot(data=data.frame(coeff.mat.Acc),aes(x=beta_OV,y=beta_VD,color=catChoiceCondition)) + geom_point(size=1) +
  geom_errorbar(aes(ymin = beta_VD-se_VD*1.96, ymax = beta_VD+se_VD*1.96),width=.01) +
  geom_errorbarh(aes(xmin = beta_OV-se_OV*1.96, xmax = beta_OV+se_OV*1.96),height=.01) + xlab('OV Effect on Accuracy') + ylab('RV Effect on Accuracy') + geom_line(data=prediction12_full,aes(x=b1_Acc,y=b2_Acc),color='black',linewidth=0.5) +
  geom_point(data=prediction12_full,aes(x=b1_Acc,y=b2_Acc,fill=catChoiceCondition),shape=24,size=1,color='black') + 
  theme_bw()+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour='black',size=0.2),legend.position = 'none',text = element_text(size=6)) + scale_fill_manual(values=c('#0673C3','#00B024')) +  scale_color_manual(values=c('#0673C3','#00B024')) + scale_y_continuous(limits = c(.4,.8),breaks=c(.4,.8)) +
  scale_x_continuous(limits=c(-.15,.15),breaks=c(-0.15,.15))
p.pred.real.acc.full
# ggsave('figures/int_prediction_data_new_12.pdf',width = 12, height = 6, units = "cm")
```


```{r fig.width=1,fig.height=1}
p.pred.real.int.thre<-ggplot(data=IA.cc.acc.rt,aes(x=I_rt,y=I_acc,color=catChoiceCondition)) + geom_point(size=1) +
  geom_errorbar(aes(ymin = I_acc-1.96*se_acc, ymax = I_acc+1.96*se_acc),width=.05) +
  geom_errorbarh(aes(xmin = I_rt-1.96*se_rt, xmax = I_rt+1.96*se_rt),height=.005) + xlab('Intercept of RT') + ylab('Intercept of Accuracy') +
  geom_line(data=prediction12_thre,aes(x=I_RT,y=I_Acc),color='black',linewidth=0.5) +
   geom_point(data=prediction12_thre,aes(x=I_RT,y=I_Acc,fill=catChoiceCondition),shape=24,size=1,color='black') + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour='black',size=0.2),legend.position = 'none',text = element_text(size=6)) + scale_fill_manual(values=c('#0673C3','#00B024')) +  scale_color_manual(values=c('#0673C3','#00B024')) + scale_x_continuous(limits = c(2.2,3.2),breaks=c(2.2,3.2)) + scale_y_continuous(limits=c(0.4,0.55),breaks=c(0.4,0.55))
p.pred.real.int.thre

p.pred.real.RT.thre<-ggplot(data=df.coeff.mat.RT,aes(x=beta_OV,y=beta_VD,color=catChoiceCondition)) + geom_point(size=1) +
  geom_errorbar(aes(ymin = beta_VD-1.96*se_VD, ymax = beta_VD+1.96*se_VD),width=.01) +
  geom_errorbarh(aes(xmin = beta_OV-1.96*se_OV, xmax = beta_OV+1.96*se_OV),height=.01) + xlab('OV Effect on RT') + ylab('RV Effect on RT') +  geom_line(data=prediction12_thre,aes(x=b1_RT,y=b2_RT),color='black',linewidth=0.5) +geom_point(data=prediction12_thre,aes(x=b1_RT,y=b2_RT,fill=catChoiceCondition),shape=24,size=1,color='black') +
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour='black',size=0.2),legend.position = 'none',text = element_text(size=6)) +
  scale_fill_manual(values=c('#0673C3','#00B024')) + scale_color_manual(values=c('#0673C3','#00B024')) + scale_y_continuous(limits = c(-0.3,-.0),breaks=c(-.3,-.0)) + scale_x_continuous(limits=c(-.5,-0.2),breaks=c(-0.5,-0.2))
p.pred.real.RT.thre

p.pred.real.acc.thre<-ggplot(data=data.frame(coeff.mat.Acc),aes(x=beta_OV,y=beta_VD,color=catChoiceCondition)) + geom_point(size=1) +
  geom_errorbar(aes(ymin = beta_VD-se_VD*1.96, ymax = beta_VD+se_VD*1.96),width=.01) +
  geom_errorbarh(aes(xmin = beta_OV-se_OV*1.96, xmax = beta_OV+se_OV*1.96),height=.01) + xlab('OV Effect on Accuracy') + ylab('RV Effect on Accuracy') + geom_line(data=prediction12_thre,aes(x=b1_Acc,y=b2_Acc),color='black',linewidth=0.5) +
  geom_point(data=prediction12_thre,aes(x=b1_Acc,y=b2_Acc,fill=catChoiceCondition),shape=24,size=1,color='black') + 
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour='black',size=0.2),legend.position = 'none',text = element_text(size=6)) + scale_fill_manual(values=c('#0673C3','#00B024')) +  scale_color_manual(values=c('#0673C3','#00B024')) + scale_y_continuous(limits = c(.4,.8),breaks=c(.4,.8)) +
  scale_x_continuous(limits=c(-.15,.15),breaks=c(-0.15,.15))
p.pred.real.acc.thre
# ggsave('figures/int_prediction_data_new_12.pdf',width = 12, height = 6, units = "cm")
```


```{r fig.width=1,fig.height=1}
p.pred.real.int.end<-ggplot(data=IA.cc.acc.rt,aes(x=I_rt,y=I_acc,color=catChoiceCondition)) + geom_point(size=1) +
  geom_errorbar(aes(ymin = I_acc-1.96*se_acc, ymax = I_acc+1.96*se_acc),width=.05) +
  geom_errorbarh(aes(xmin = I_rt-1.96*se_rt, xmax = I_rt+1.96*se_rt),height=.005) + xlab('Intercept of RT') + ylab('Intercept of Accuracy') +
  geom_line(data=prediction12_end,aes(x=I_RT,y=I_Acc),color='black',linewidth=0.5) +
   geom_point(data=prediction12_end,aes(x=I_RT,y=I_Acc,fill=catChoiceCondition),shape=24,size=1,color='black') + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour='black',size=0.2),legend.position = 'none',text = element_text(size=6)) + scale_fill_manual(values=c('#0673C3','#00B024')) +  scale_color_manual(values=c('#0673C3','#00B024')) + scale_x_continuous(limits = c(2.2,3.2),breaks=c(2.2,3.2)) + scale_y_continuous(limits=c(0.4,0.55),breaks=c(0.4,0.55))
p.pred.real.int.end

p.pred.real.RT.end<-ggplot(data=df.coeff.mat.RT,aes(x=beta_OV,y=beta_VD,color=catChoiceCondition)) + geom_point(size=1) +
  geom_errorbar(aes(ymin = beta_VD-1.96*se_VD, ymax = beta_VD+1.96*se_VD),width=.01) +
  geom_errorbarh(aes(xmin = beta_OV-1.96*se_OV, xmax = beta_OV+1.96*se_OV),height=.01) + xlab('OV Effect on RT') + ylab('RV Effect on RT') +  geom_line(data=prediction12_end,aes(x=b1_RT,y=b2_RT),color='black',linewidth=0.5) +geom_point(data=prediction12_end,aes(x=b1_RT,y=b2_RT,fill=catChoiceCondition),shape=24,size=1,color='black') +
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour='black',size=0.2),legend.position = 'none',text = element_text(size=6)) +
  scale_fill_manual(values=c('#0673C3','#00B024')) + scale_color_manual(values=c('#0673C3','#00B024')) + scale_y_continuous(limits = c(-0.3,-.0),breaks=c(-.3,-.0)) + scale_x_continuous(limits=c(-.5,-0.2),breaks=c(-0.5,-0.2))
p.pred.real.RT.end

p.pred.real.acc.end<-ggplot(data=data.frame(coeff.mat.Acc),aes(x=beta_OV,y=beta_VD,color=catChoiceCondition)) + geom_point(size=1) +
  geom_errorbar(aes(ymin = beta_VD-se_VD*1.96, ymax = beta_VD+se_VD*1.96),width=.01) +
  geom_errorbarh(aes(xmin = beta_OV-se_OV*1.96, xmax = beta_OV+se_OV*1.96),height=.01) + xlab('OV Effect on Accuracy') + ylab('RV Effect on Accuracy') + geom_line(data=prediction12_end,aes(x=b1_Acc,y=b2_Acc),color='black',linewidth=0.5) +
  geom_point(data=prediction12_end,aes(x=b1_Acc,y=b2_Acc,fill=catChoiceCondition),shape=24,size=1,color='black') + 
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour='black',size=0.2),legend.position = 'none',text = element_text(size=6)) + scale_fill_manual(values=c('#0673C3','#00B024')) +  scale_color_manual(values=c('#0673C3','#00B024')) + scale_y_continuous(limits = c(.4,.8),breaks=c(.4,.8)) +
  scale_x_continuous(limits=c(-.15,.15),breaks=c(-0.15,.15))
p.pred.real.acc.end
# ggsave('figures/int_prediction_data_new_12.pdf',width = 12, height = 6, units = "cm")
```


```{r fig.width=1,fig.height=1}
p.pred.real.int.bound<-ggplot(data=IA.cc.acc.rt,aes(x=I_rt,y=I_acc,color=catChoiceCondition)) + geom_point(size=1) +
  geom_errorbar(aes(ymin = I_acc-1.96*se_acc, ymax = I_acc+1.96*se_acc),width=.05) +
  geom_errorbarh(aes(xmin = I_rt-1.96*se_rt, xmax = I_rt+1.96*se_rt),height=.005) + xlab('Intercept of RT') + ylab('Intercept of Accuracy') +
  geom_line(data=prediction12_bound,aes(x=I_RT,y=I_Acc),color='black',linewidth=0.5) +
   geom_point(data=prediction12_bound,aes(x=I_RT,y=I_Acc,fill=catChoiceCondition),shape=24,size=1,color='black') + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour='black',size=0.2),legend.position = 'none',text = element_text(size=6)) + scale_fill_manual(values=c('#0673C3','#00B024')) +  scale_color_manual(values=c('#0673C3','#00B024')) + scale_x_continuous(limits = c(2.2,3.2),breaks=c(2.2,3.2)) + scale_y_continuous(limits=c(0.4,0.55),breaks=c(0.4,0.55))
p.pred.real.int.bound

p.pred.real.RT.bound<-ggplot(data=df.coeff.mat.RT,aes(x=beta_OV,y=beta_VD,color=catChoiceCondition)) + geom_point(size=1) +
  geom_errorbar(aes(ymin = beta_VD-1.96*se_VD, ymax = beta_VD+1.96*se_VD),width=.01) +
  geom_errorbarh(aes(xmin = beta_OV-1.96*se_OV, xmax = beta_OV+1.96*se_OV),height=.01) + xlab('OV Effect on RT') + ylab('RV Effect on RT') +  geom_line(data=prediction12_bound,aes(x=b1_RT,y=b2_RT),color='black',linewidth=0.5) +geom_point(data=prediction12_bound,aes(x=b1_RT,y=b2_RT,fill=catChoiceCondition),shape=24,size=1,color='black') +
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour='black',size=0.2),legend.position = 'none',text = element_text(size=6)) +
  scale_fill_manual(values=c('#0673C3','#00B024')) + scale_color_manual(values=c('#0673C3','#00B024')) + scale_y_continuous(limits = c(-0.3,-.1),breaks=c(-.3,-.1)) + scale_x_continuous(limits=c(-.5,-0.2),breaks=c(-0.5,-0.2))
p.pred.real.RT.bound

p.pred.real.acc.bound<-ggplot(data=data.frame(coeff.mat.Acc),aes(x=beta_OV,y=beta_VD,color=catChoiceCondition)) + geom_point(size=1) +
  geom_errorbar(aes(ymin = beta_VD-se_VD*1.96, ymax = beta_VD+se_VD*1.96),width=.01) +
  geom_errorbarh(aes(xmin = beta_OV-se_OV*1.96, xmax = beta_OV+se_OV*1.96),height=.01) + xlab('OV Effect on Accuracy') + ylab('RV Effect on Accuracy') + geom_line(data=prediction12_bound,aes(x=b1_Acc,y=b2_Acc),color='black',linewidth=0.5) +
  geom_point(data=prediction12_bound,aes(x=b1_Acc,y=b2_Acc,fill=catChoiceCondition),shape=24,size=1,color='black') + 
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour='black',size=0.2),legend.position = 'none',text = element_text(size=6)) + scale_fill_manual(values=c('#0673C3','#00B024')) +  scale_color_manual(values=c('#0673C3','#00B024')) + scale_y_continuous(limits = c(.4,.8),breaks=c(.4,.8)) +
  scale_x_continuous(limits=c(-.15,.15),breaks=c(-0.15,.15))
p.pred.real.acc.bound
# ggsave('figures/int_prediction_data_new_12.pdf',width = 12, height = 6, units = "cm")
```


```{r}
lay <- rbind(c(1,NA,2,NA,3),c(4,NA,5,NA,6),c(7,NA,8,NA,9),c(10,NA,11,NA,12),c(13,NA,14,NA,15))

plots <- list(p.pred.real.int.end,p.pred.real.RT.end,p.pred.real.acc.end,
              p.pred.real.int.thre,p.pred.real.RT.thre,p.pred.real.acc.thre,
              p.pred.real.int.bound,p.pred.real.RT.bound,p.pred.real.acc.bound,
              p.pred.real.int.inhi,p.pred.real.RT.inhi,p.pred.real.acc.inhi,
              p.pred.real.int.full,p.pred.real.RT.full,p.pred.real.acc.full)
grobs <- list()
widths <- list()
heights <- list()

for (i in 1:length(plots)){
    grobs[[i]] <- ggplotGrob(plots[[i]])
    widths[[i]] <- grobs[[i]]$widths
    heights[[i]] <- grobs[[i]]$heights
}

maxwidth <- do.call(grid::unit.pmax, widths)
maxheight <- do.call(grid::unit.pmax,heights)

for (i in 1:length(grobs)){
     grobs[[i]]$heights <- as.list(maxheight)
     grobs[[i]]$widths <- as.list(maxwidth)
}

p<-grid.arrange(grobs = grobs, layout_matrix = lay,widths=unit(c(3,1,3,1,3), c("cm", "cm")),heights=unit(c(3,3,3,3,3),c('cm','cm')))

ggsave(filename = '../Figures/Figure_S0.pdf',p,units = 'cm',width = 17,height = 26)
```



## Conflict 

```{r fig.width=2,fig.height=2}

eff_mv.cfl.12 <- Effect(c("scaledMeanValue","catChoiceCondition"),
                   model.conflict.12,
                   xlevels=list(scaledMeanValue=seq(quantile(df.total.valid.12$scaledMeanValue,0.025),
                                                    quantile(df.total.valid.12$scaledMeanValue,0.975),0.1)))
IA.mv.cfl.12 <- as.data.frame(eff_mv.cfl.12)

IA.mv.cfl.12$catChoiceCondition <- relevel(IA.mv.cfl.12$catChoiceCondition,ref = 'XOR')

p.eff.mv.cfl.12<-ggplot(data=IA.mv.cfl.12, aes(x=scaledMeanValue, y=fit,group=catChoiceCondition)) + 
  geom_line(size=0.5,aes(color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.mv.cfl.12, aes(x=scaledMeanValue, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab("Conflict") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), plot.title = element_text(hjust = 0.5,size=6),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour='black',size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6),strip.text.y = element_blank()) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + 
  coord_cartesian(ylim=c(1,4)) + scale_y_continuous(breaks = c(1,4))

p.eff.mv.cfl.12
```

```{r}
marginalConflictMVEffect <- function(model,x,newx) {
  poly.base <- poly(x,2)
  
  new_poly <- predict(poly.base,newx)
  
  coeffs.mv.1 <- summary(model)$coeff[,'Estimate']
  
  eff <- coeffs.mv.1['catChoiceConditionOR-XOR'] + 
    coeffs.mv.1['catChoiceConditionOR-XOR:poly(scaledMeanValue, 2)1']*new_poly[,1] + 
    coeffs.mv.1['catChoiceConditionOR-XOR:poly(scaledMeanValue, 2)2']*new_poly[,2]
  
  cov.mat <- vcov(model)
  
  eff.ci <-  1.96 * sqrt(cov.mat[2,2] + new_poly[,1]^2 * cov.mat[7,7] + new_poly[,2]^2 * cov.mat[8,8] + 
                                 2 * new_poly[,1] * cov.mat[2,7] + 2 * new_poly[,2] * cov.mat[2,8] + 
                                 2 * new_poly[,1] * new_poly[,2] * cov.mat[7,8])
  
  eff.df<-data.frame(x=newx,eff=eff,ci=eff.ci)
  
  return(eff.df)
}
```



```{r fig.width=2,fig.height=2}
new.mv.1 <- seq(quantile(df.total.valid.12$scaledMeanValue,0.025),
                quantile(df.total.valid.12$scaledMeanValue,0.975),0.1)

eff.df.mv.12 <- marginalConflictMVEffect(model.conflict.12,
                                         df.total.valid.12$scaledMeanValue,
                                         new.mv.1) %>%
  dplyr::mutate(scaledMeanValue=x,
                catChoiceCondition='XOR - OR',
                fit=eff,
                upper=eff+ci,
                lower=eff-ci,
                se=NA,
                study='Study 12')

p.eff.cc.int.12<-ggplot(data=eff.df.mv.12, aes(x=x, y=fit)) + 
  geom_line(size=0.5)+theme_bw(12) +
  geom_ribbon(data=eff.df.mv.12, aes(x=x, max = upper, min = lower),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab('Effect of Inclusivity') +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), plot.title = element_text(hjust = 0.5,size=6),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks=element_line(color='black',size=0.2),strip.text.y = element_blank()) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  scale_fill_manual("",values=c("#005555","#550055")) + scale_color_manual("",values=c("#005555","#550055")) + # ggtitle('Exclusive - Non-Exclusive') +
  coord_cartesian(ylim=c(-1.6,0.1)) + scale_y_continuous(breaks = c(-1.6,0))

p.eff.cc.int.12

# ggsave('figures/ov_conflict_123.pdf',unit='cm',width=5,height=5)

```


```{r fig.width=2,fig.height=2}

eff_vd.cfl.12 <- Effect(c("scaledValueDiff","catChoiceCondition"),
                   model.conflict.12,
                   xlevels=list(scaledValueDiff=seq(quantile(df.total.rt.12$scaledValueDiff,0.025),
                                                    quantile(df.total.rt.12$scaledValueDiff,0.975),0.1)))
IA.vd.cfl <- as.data.frame(eff_vd.cfl.12) %>% dplyr::mutate(study='Study 12')


IA.vd.cfl$catChoiceCondition <- relevel(IA.vd.cfl$catChoiceCondition,ref = 'XOR')

p.eff.vd.cfl.12<-ggplot(data=IA.vd.cfl, aes(x=scaledValueDiff, y=fit,group=catChoiceCondition)) +
  geom_line(size=0.5,aes(color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.vd.cfl, aes(x=scaledValueDiff, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Relative Value\n(z-scored)") + ylab("Conflict") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), plot.title = element_text(hjust = 0.5,size=6),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour='black',size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + 
  coord_cartesian(ylim=c(1,4)) + scale_y_continuous(breaks = c(1,4))

p.eff.vd.cfl.12
#ggsave('Study12_RT.pdf')
```



```{r}
lay <- rbind(c(1,NA,2,NA,3,NA,4))

plots <- list(p.diff.conflict.12,p.eff.mv.cfl.12,p.eff.cc.int.12,p.eff.vd.cfl.12)
grobs <- list()
widths <- list()
heights <- list()

for (i in 1:length(plots)){
    grobs[[i]] <- ggplotGrob(plots[[i]])
    widths[[i]] <- grobs[[i]]$widths
    heights[[i]] <- grobs[[i]]$heights
}

maxwidth <- do.call(grid::unit.pmax, widths)
maxheight <- do.call(grid::unit.pmax, heights)

for (i in 1:length(grobs)){
  grobs[[i]]$widths <- as.list(maxwidth)
  grobs[[i]]$heights <- as.list(maxheight)
}

for (i in 2:length(grobs)){
  grobs[[i]]$heights <- as.list(maxheight)
} 

p<-grid.arrange(grobs = grobs, layout_matrix = lay,widths=unit(c(2,0.1,2.7,0.1,2.7,0.1,2.7), c("cm", "cm")),heights=unit(c(3),c('cm','cm')))

ggsave(filename = '../Figures/Figure_4.pdf',p,units = 'cm',width = 25,height = 12)
```


```{r}
model.RT.3 <- lmerTest::lmer(firstRT ~ catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff + scaledTrialNum + 
                     (1 + catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),
                     data=df.total.rt.3,
                   control=lmerControl(optCtrl=list(maxfun=1e6)))

model.RT.3.nest <- lmerTest::lmer(firstRT ~ catChoiceCondition / scaledMeanValue + catChoiceCondition / scaledValueDiff + scaledTrialNum + 
                     (1 + catChoiceCondition / scaledMeanValue + catChoiceCondition / scaledValueDiff + scaledTrialNum|participant),
                     data=df.total.rt.3,
                   control=lmerControl(optCtrl=list(maxfun=1e6)))

model.acc.3 <- glmer(isWorstFirst ~ catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff +
                        scaledTrialNum + 
                     (1 + catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff +
                        scaledTrialNum|participant),
                     data=df.total.rt.3,family=binomial)

model.acc.3.dummy <- lmer(isWorstFirst ~ catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff +
                        scaledTrialNum + 
                     (1 + catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff +
                        scaledTrialNum|participant),
                     data=df.total.rt.3)

model.acc.3.nest <- lmer(isWorstFirst ~ catChoiceCondition / scaledMeanValue + catChoiceCondition / scaledValueDiff +
                        scaledTrialNum + 
                     (1 + catChoiceCondition / scaledMeanValue + catChoiceCondition / scaledValueDiff +
                        scaledTrialNum|participant),
                     data=df.total.rt.3)

tab_model(model.RT.3,model.acc.3,show.re.var = F,transform = NULL,pred.labels = c("Intercept","Inclusivity","Overall Value","Relative Value","Trial Order","Incl by OV","Incl by RV"),dv.labels = c("Reaction Time","Accuracy"),show.stat = T,show.ngroups = F,show.obs = F,show.r2 = F,show.icc = F)
```


```{r}
model.conflict.3 <- lmerTest::lmer(conflict ~ catChoiceCondition * poly(scaledMeanValue,2) + catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * poly(scaledMeanValue,2) + catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.total.valid.3)


model.conflict.3.coeff <- lmerTest::lmer(conflict ~ catChoiceCondition / poly(scaledMeanValue,2) + catChoiceCondition / scaledValueDiff + scaledTrialNum + 
                     (1 + catChoiceCondition / poly(scaledMeanValue,2) + catChoiceCondition / scaledValueDiff + scaledTrialNum|participant),
                     data=df.total.valid.3)
```


```{r}
tab_model(model.conflict.3,transform = NULL,show.re.var = F,pred.labels = c("Intercept","Inclusivity","Overall Value","Overall Value^2","Relative Value","Trial Order","Incl by OV","Incl by OV^2","Excl by RV"),dv.labels = c("Conflict"),show.stat = T,show.ngroups = F,show.obs = F,show.r2 = F,show.icc = F)
```



```{r}
tab_model(model.conflict.3.rt,transform = NULL,show.re.var = F,pred.labels = c("Intercept","RT","Accuracy","Inclusivity","Overall Value","Overall Value^2","Relative Value","Trial Order","Incl by OV","Incl by OV^2","Excl by RV"),dv.labels = c("Conflict"),show.stat = T,show.ngroups = F,show.obs = F,show.r2 = F,show.icc = F)
```

#### Get prediction for two ORXOR studies


```{r}
coeff.rt <- t(fixef(model.RT.3)['catChoiceConditionOR-XOR'])
df.ci <- confint(model.RT.3,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.rt <- df.ci['catChoiceConditionOR-XOR',]
estimate.rt <- cbind(coeff.rt,t(ci.rt))
colnames(estimate.rt)<-c('coeff','lower','upper')

coeff.acc <- t(fixef(model.acc.3.dummy)['catChoiceConditionOR-XOR'])
df.ci <- confint(model.acc.3.dummy,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.acc <- df.ci['catChoiceConditionOR-XOR',]
estimate.acc <- cbind(coeff.acc,t(ci.acc))
colnames(estimate.acc)<-c('coeff','lower','upper')

coeff.conf <- t(fixef(model.conflict.3)['catChoiceConditionOR-XOR'])
df.ci <- confint(model.conflict.3,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.conf <- df.ci['catChoiceConditionOR-XOR',]
estimate.conf <- cbind(coeff.conf,t(ci.conf))
colnames(estimate.conf)<-c('coeff','lower','upper')

estimate.all <- data.frame(rbind(estimate.rt,estimate.acc,estimate.conf))
estimate.all$var <- c('RT','Acc','Conflict')
```


```{r,fig.width=1,fig.height=1}
p.diff.acc.3 <- ggplot(estimate.all %>% filter(var %in% c('Acc')), aes(x=var, y=coeff))  + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  geom_point(stat="identity", position=position_dodge(0.6),size=0.5) +
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.1,size=0.4,
                 position=position_dodge(.6))+labs(x="", y = "Effect of Inclusivity")+theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour = "black",size=0.2),
        text=element_text(size=6),legend.position="none") +
  scale_x_discrete(labels=c("Acc"='P(Worst First)')) + scale_y_continuous(limits = c(-0.1,0.004),breaks = c(-0.1,0))
p.diff.acc.3
```


```{r fig.height=1,fig.width=1}
p.diff.rt.3 <- ggplot(estimate.all %>% filter(var %in% c('RT')), aes(x=var, y=coeff))  + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  geom_point(stat="identity", position=position_dodge(0.6),size=0.5) +
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.1,size=0.4,
                 position=position_dodge(.6))+labs(x="", y = "Effect of Inclusivity")+theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour = "black",size=0.2),
        text=element_text(size=6),legend.position="none") +
  scale_x_discrete(labels=c("RT"='RT')) + 
  scale_color_manual(values=c('#0673C3','#00B024')) + scale_y_continuous(limits = c(-0.5,0.02),breaks = c(-0.5,0))
p.diff.rt.3
```


```{r fig.height=1,fig.width=1}
p.diff.conflict.3 <- ggplot(estimate.all %>% filter(var %in% c('Conflict')), aes(x=var, y=coeff))  + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  geom_point(stat="identity", position=position_dodge(0.6),size=0.5) +
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.1,size=0.4,
                 position=position_dodge(.6))+labs(x="", y = "Effect of Inclusivity")+theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour = "black",size=0.2),
        text=element_text(size=6),legend.position="none") +
  scale_x_discrete(labels=c("Conflict"='Conflict')) + scale_y_continuous(limits = c(-0.5,0.02),breaks = c(-0.5,0))
p.diff.conflict.3
```



```{r fig.width=1, fig.height=1}
eff_mv.RT.3 <- Effect(c("scaledMeanValue","catChoiceCondition"),
                   model.RT.3,
                   xlevels=list(scaledMeanValue=seq(quantile(df.total.rt.3$scaledMeanValue,0.025),
                                                    quantile(df.total.rt.3$scaledMeanValue,0.975),0.1)))
IA.mv.RT.3 <- as.data.frame(eff_mv.RT.3) %>% dplyr::mutate(study='Study 3')

p.eff.mv.rt.3<-ggplot(data=IA.mv.RT.3, aes(x=scaledMeanValue, y=fit, group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.mv.RT.3, aes(x=scaledMeanValue, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab("RT (sec)") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + 
  coord_cartesian(ylim=c(1,4)) + scale_y_continuous(breaks = c(1,4))

p.eff.mv.rt.3
```


```{r fig.width=1, fig.height=1}
eff_vd.RT.3 <- Effect(c("scaledValueDiff","catChoiceCondition"),
                   model.RT.3,
                   xlevels=list(scaledValueDiff=seq(quantile(df.total.rt.3$scaledValueDiff,0.025),
                                                    quantile(df.total.rt.3$scaledValueDiff,0.975),0.1)))
IA.vd.RT.3 <- as.data.frame(eff_vd.RT.3) %>% dplyr::mutate(study='Study 3')

p.eff.vd.rt.3<-ggplot(data=IA.vd.RT.3, aes(x=scaledValueDiff, y=fit, group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.vd.RT.3, aes(x=scaledValueDiff, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Relative Value\n(z-scored)") + ylab("RT (sec)") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + 
  coord_cartesian(ylim=c(1,4)) + scale_y_continuous(breaks = c(1,4))

p.eff.vd.rt.3
```





```{r fig.width=1,fig.height=1}

eff_mv.acc.3 <- Effect(c("scaledMeanValue","catChoiceCondition"),
                   model.acc.3,
                   xlevels=list(scaledMeanValue=seq(quantile(df.total.rt.3$scaledMeanValue,0.025),
                                                    quantile(df.total.rt.3$scaledMeanValue,0.972),0.1)))
IA.mv.acc.3 <- as.data.frame(eff_mv.acc.3) %>% dplyr::mutate(study='Study 3')

p.eff.mv.acc.3 <-ggplot(data=IA.mv.acc.3, aes(x=scaledMeanValue, y=fit, group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.mv.acc.3, aes(x=scaledMeanValue, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab("P(Worst First)") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + 
  coord_cartesian(ylim=c(0.2,0.8)) + scale_y_continuous(breaks = c(0.2,0.8),labels=function(x) sprintf("%.1f", x))

p.eff.mv.acc.3
#ggsave('Study12_RT.pdf')
```



```{r fig.width=1,fig.height=1}

eff_vd.acc.3 <- Effect(c("scaledValueDiff","catChoiceCondition"),
                   model.acc.3,
                   xlevels=list(scaledValueDiff=seq(quantile(df.total.rt.3$scaledValueDiff,0.025),
                                                    quantile(df.total.rt.3$scaledValueDiff,0.975),0.1)))
IA.vd.acc.3 <- as.data.frame(eff_vd.acc.3) %>% dplyr::mutate(study='Study 3')

p.eff.vd.acc.3<-ggplot(data=IA.vd.acc.3, aes(x=scaledValueDiff, y=fit, group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.vd.acc.3, aes(x=scaledValueDiff, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Relative Value\n(z-scored)") + ylab("P(Worst First)") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + 
  coord_cartesian(ylim=c(0.2,0.8)) + scale_y_continuous(breaks = c(0.2,0.8),labels=function(x) sprintf("%.1f", x))

p.eff.vd.acc.3
#ggsave('Study12_RT.pdf')
```



```{r fig.width=1,fig.height=1}

eff_mv.cfl.3 <- Effect(c("scaledMeanValue","catChoiceCondition"),
                       model.conflict.3,
                       xlevels=list(scaledMeanValue=seq(quantile(df.total.valid.3$scaledMeanValue,0.025),
                                                        quantile(df.total.valid.3$scaledMeanValue,0.975),0.1)))
IA.mv.cfl.3 <- as.data.frame(eff_mv.cfl.3) %>% dplyr::mutate(study='Study 3')

IA.mv.cfl <- IA.mv.cfl.3

IA.mv.cfl$catChoiceCondition <- relevel(IA.mv.cfl$catChoiceCondition,ref = 'XOR')

p.eff.mv.cfl.3<-ggplot(data=IA.mv.cfl, aes(x=scaledMeanValue, y=fit,group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.mv.cfl, aes(x=scaledMeanValue, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab("Conflict") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + # ggtitle('Exclusive') +
  coord_cartesian(ylim=c(1,4)) + scale_y_continuous(breaks = c(1,4))

p.eff.mv.cfl.3
# ggsave('figures/ov_conflict_by_cond_d.pdf',width=4,height=2.5)
```




```{r fig.width=1,fig.height=1}

new.mv.1 <- seq(quantile(df.total.valid.3$scaledMeanValue,0.025),
                quantile(df.total.valid.3$scaledMeanValue,0.975),0.1)

eff.df.mv.3 <- marginalConflictMVEffect(model.conflict.3,df.total.valid.3$scaledMeanValue,new.mv.1) %>%
  dplyr::mutate(scaledMeanValue=x,
                catChoiceCondition='XOR - OR',
                fit= eff,
                upper= eff+ci,
                lower= eff-ci,
                se=NA,
                study='Study 3')

p.eff.cc.int.3<-ggplot(data=eff.df.mv.3, aes(x=x, y=fit)) + 
  geom_line(size=0.5)+theme_bw(12) +
  geom_ribbon(data=eff.df.mv.3, aes(x=x, max = upper, min = lower),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab('Effect of Inclusivity') +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + geom_hline(yintercept=0,color='#555555') + 
  scale_fill_manual("",values=c("#005555","#550055")) + scale_color_manual("",values=c("#005555","#550055")) + # ggtitle('Exclusive - Non-Exclusive') +
  coord_cartesian(ylim=c(-0.8,0.2)) + scale_y_continuous(breaks = c(-0.8,0))

p.eff.cc.int.3


```




```{r fig.width=1,fig.height=1}

eff_vd.cfl.3 <- Effect(c("scaledValueDiff","catChoiceCondition"),
                   model.conflict.3,
                   xlevels=list(scaledValueDiff=seq(quantile(df.total.rt.3$scaledValueDiff,0.025),
                                                    quantile(df.total.rt.3$scaledValueDiff,0.975),0.1)))
IA.vd.cfl <- as.data.frame(eff_vd.cfl.3) %>% dplyr::mutate(study='Study 1')

IA.vd.cfl$catChoiceCondition <- relevel(IA.vd.cfl$catChoiceCondition,ref = 'XOR')

p.eff.vd.cfl.3<-ggplot(data=IA.vd.cfl, aes(x=scaledValueDiff, y=fit,group=catChoiceCondition)) +
  geom_line(size=0.5,aes(color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.vd.cfl, aes(x=scaledValueDiff, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Relative Value\n(z-scored)") + ylab("Conflict") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + 
  coord_cartesian(ylim=c(1,4)) + scale_y_continuous(breaks = c(1,4))

p.eff.vd.cfl.3
#ggsave('Study12_RT.pdf')
```



```{r}
lay <- rbind(c(1,NA,2,NA,NA,3,3,NA),
             c(4,NA,5,NA,NA,6,6,NA),
             c(7,NA,8,NA,9,9,10,10))

plots <- list(p.diff.rt.3,p.eff.vd.rt.3,p.eff.mv.rt.3,
              p.diff.acc.3,p.eff.vd.acc.3,p.eff.mv.acc.3,
              p.diff.conflict.3,p.eff.vd.cfl.3,p.eff.mv.cfl.3,p.eff.cc.int.3)
grobs <- list()
widths <- list()
heights <- list()

for (i in 1:length(plots)){
    grobs[[i]] <- ggplotGrob(plots[[i]])
    widths[[i]] <- grobs[[i]]$widths
    heights[[i]] <- grobs[[i]]$heights
}

maxwidth <- do.call(grid::unit.pmax, widths)
maxheight <- do.call(grid::unit.pmax,heights)

for (i in 1:length(grobs)){
     grobs[[i]]$heights <- as.list(maxheight)
     grobs[[i]]$widths <- as.list(maxwidth)
}


for (i in 1:length(grobs)){
     grobs[[i]]$heights <- as.list(maxheight)
     grobs[[i]]$widths <- as.list(maxwidth)
}


p<-grid.arrange(grobs = grobs, layout_matrix = lay,widths=unit(c(2,0.1,2.7,0.1,0.8,1.35,1.35,0.8), c("cm", "cm")),heights=unit(c(3,3,3),c('cm','cm')))

ggsave(filename = '../Figures/Figure5_V3.pdf',p,units = 'cm',width = 25,height = 20)
```

```{r warning=TRUE}
df.total.rt.3$scaledRT<-scale(df.total.rt.3$firstRT)

model.conflict.3.rt <- lmerTest::lmer(conflict ~ scaledRT + acc + catChoiceCondition * poly(scaledMeanValue,2) + catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + scaledRT + acc + catChoiceCondition * poly(scaledMeanValue,2) + catChoiceCondition * scaledValueDiff + scaledTrialNum|participant), data=df.total.rt.3)
```

```{r}
tab_model(model.conflict.3.rt,show.re.var = FALSE,pred.labels = c('Intercept','RT','Accuracy','Inclusivity','OV','OV^2','RV','Trial Num','Incl by OV','Incl by OV^2','Excl by RV'))
```

```{r}

df.rating.new.s <- read.csv('../Data/Study3/Selection/Study3a_2.csv')

df.total.new.s <- read.csv('../Data/Study3/Selection/Study3a_1.csv') %>%
  mutate(catChoiceCondition=relevel(factor(catChoiceCondition),ref = 'XOR'),
         isBestFirst=firstValue==bestValue,
         scaledTrialNum=scale(trialN),
         scaledMeanValue=scale(meanValue),
         scaledValueDiff=scale(valueDiff))

df.total.rt.new.s <- df.total.new.s %>% filter(firstRT>0.1,firstRT<18) %>%
  mutate(scaledMeanValue=scale(meanValue),
         scaledValueDiff=scale(valueDiff),
         scaledTrialNum=scale(trialN))

contrasts(df.total.new.s$catChoiceCondition) <- contr.sdif
contrasts(df.total.rt.new.s$catChoiceCondition) <- contr.sdif

df.or.rt.new.s <- df.total.rt.new.s %>% filter(catChoiceCondition=='OR',NChosen>=1) %>%
    dplyr::mutate(scaledMeanValue=scale(meanValue),
                  scaledValueDiff=scale(valueDiff),
                  scaledTrialNum=scale(trialN),
                  scaledFirstRT=scale(firstRT),
                  acc=factor(isBestFirst))

contrasts(df.or.rt.new.s$acc)<-contr.sum
```


```{r}

df.rating.new.d <- read.csv('../Data/Study3/Removal/Study3b_2.csv')

df.total.new.d <- read.csv('../Data/Study3/Removal/Study3b_1.csv') %>%
  mutate(catChoiceCondition=relevel(factor(catChoiceCondition),ref = 'XOR'),
         isWorstFirst=firstValue==worstValue,
         scaledTrialNum=scale(trialN),
         scaledMeanValue=scale(meanValue),
         scaledValueDiff=scale(valueDiff))

df.total.rt.new.d <- df.total.new.d %>% filter(firstRT>0.1,firstRT<18) %>%
  mutate(scaledMeanValue=scale(meanValue),
         scaledValueDiff=scale(valueDiff),
         scaledTrialNum=scale(trialN))


contrasts(df.total.new.d$catChoiceCondition) <- contr.sdif
contrasts(df.total.rt.new.d$catChoiceCondition) <- contr.sdif

df.or.rt.new.d <- df.total.rt.new.d %>% filter(catChoiceCondition=='OR',NChosen>=1) %>%
    dplyr::mutate(scaledMeanValue=scale(meanValue),
                  scaledValueDiff=scale(valueDiff),
                  scaledTrialNum=scale(trialN),
                  scaledFirstRT=scale(firstRT),
                  acc=factor(isWorstFirst))

contrasts(df.or.rt.new.d$acc)<-contr.sum
```


```{r}
model.RT.ns <-  lmerTest::lmer(log10(firstRT) ~ catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.total.rt.new.s)

model.RT.ns.r <-  lmerTest::lmer(firstRT ~ catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.total.rt.new.s)

model.acc.ns <- glmer(isBestFirst ~ catChoiceCondition * scaledMeanValue +  catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * scaledMeanValue +  catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.total.rt.new.s,family = binomial)

model.acc.ns.dummy <- lmerTest::lmer(isBestFirst ~ catChoiceCondition * scaledMeanValue +  catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * scaledMeanValue +  catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.total.rt.new.s)

model.rating.ns <- lmerTest::lmer(conflict ~ catChoiceCondition * poly(scaledMeanValue,2) + catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * poly(scaledMeanValue,2) + catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.total.new.s)

tab_model(model.RT.ns,model.acc.ns,show.re.var = FALSE,transform = NULL,show.icc=F,show.ngroups = F,show.obs = F,show.r2 = F,show.stat = T,pred.labels = c("Intercept","Inclusivity","Overall Value","Relative Value","Trial Order","Incl by OV","Incl by RV"),dv.labels = c("RT (Log-Transformed)","Accuracy"))
```

```{r}
model.RT.nd <- lmerTest::lmer(log10(firstRT) ~ catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.total.rt.new.d)

model.RT.nd.r <- lmerTest::lmer(firstRT ~ catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.total.rt.new.d)

model.acc.nd <- glmer(isWorstFirst ~ catChoiceCondition * scaledMeanValue +  catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * scaledMeanValue +  catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.total.rt.new.d,family = binomial)

model.acc.nd.dummy <- lmerTest::lmer(isWorstFirst ~ catChoiceCondition * scaledMeanValue +  catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * scaledMeanValue +  catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.total.rt.new.d)

model.rating.nd <- lmerTest::lmer(conflict ~ catChoiceCondition * poly(scaledMeanValue,2) + catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition *  poly(scaledMeanValue,2) + catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.total.new.d)


tab_model(model.RT.nd,model.acc.nd,show.re.var = FALSE,transform = NULL,show.icc=F,show.ngroups = F,show.obs = F,show.r2 = F,show.stat = T,pred.labels = c("Intercept","Inclusivity","Overall Value","Relative Value","Trial Order","Incl by OV","Incl by RV"),dv.labels = c("RT (Log-Transformed)","Accuracy"))
```

```{r}
tab_model(model.RT.ns.r,model.RT.nd.r,pred.labels = c("Intercept","Inclusivity","Overall Value","Relative Value","Trial Order","Incl by OV","Incl by RV"),dv.labels = c("Replication Study-Selection RT","Replication Study-Removal RT"),show.stat=T,show.re.var = F,show.icc = F,show.r2 = F,show.ngroups = F,show.obs = F)
```


```{r}
tab_model(model.rating.ns,model.rating.nd,pred.labels = c("Intercept","Inclusivity","Overall Value","Overall Value^2","Relative Value","Trial Order","Incl by OV","Incl by OV^2","Incl by RV"),dv.labels = c("Replication Study-Selection Conflict","Replication Study-Removal Conflict"),show.stat=T,show.re.var = F,show.icc = F,show.r2 = F,show.ngroups = F,show.obs = F)
```

```{r}
coeff.rt.ns <- fixef(model.RT.ns)[c('catChoiceConditionOR-XOR','catChoiceConditionOR-XOR:scaledMeanValue','catChoiceConditionOR-XOR:scaledValueDiff')]
df.ci <- confint(model.RT.ns,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.rt <- df.ci[c('catChoiceConditionOR-XOR','catChoiceConditionOR-XOR:scaledMeanValue','catChoiceConditionOR-XOR:scaledValueDiff'),]
estimate.rt.ns <- t(rbind(coeff.rt.ns,t(ci.rt)))
colnames(estimate.rt.ns)<-c('coeff','lower','upper')
rownames(estimate.rt.ns) <- NULL
estimate.rt.ns <- data.frame(estimate.rt.ns)
estimate.rt.ns$params <- c('Incl - Excl','(Incl - Excl) X OV','(Incl - Excl) X RV')
estimate.rt.ns$dv <- 'RT'

coeff.acc.ns <- fixef(model.acc.ns)[c('catChoiceConditionOR-XOR','catChoiceConditionOR-XOR:scaledMeanValue','catChoiceConditionOR-XOR:scaledValueDiff')]
df.ci <- confint(model.acc.ns,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.acc <- df.ci[c('catChoiceConditionOR-XOR','catChoiceConditionOR-XOR:scaledMeanValue','catChoiceConditionOR-XOR:scaledValueDiff'),]
estimate.acc.ns <- t(rbind(coeff.acc.ns,t(ci.acc)))
colnames(estimate.acc.ns)<-c('coeff','lower','upper')
rownames(estimate.acc.ns) <- NULL
estimate.acc.ns <- data.frame(estimate.acc.ns)
estimate.acc.ns$params <- c('Incl - Excl','(Incl - Excl) X OV','(Incl - Excl) X RV')
estimate.acc.ns$dv <- 'P(Best First)'

estimate.rt.acc.ns <- rbind(estimate.rt.ns,estimate.acc.ns)
estimate.rt.acc.ns$order <- seq(1,6)
estimate.rt.acc.ns$study <- 'Selection'

coeff.rt.nd <- fixef(model.RT.nd)[c('catChoiceConditionOR-XOR','catChoiceConditionOR-XOR:scaledMeanValue','catChoiceConditionOR-XOR:scaledValueDiff')]
df.ci <- confint(model.RT.nd,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.rt <- df.ci[c('catChoiceConditionOR-XOR','catChoiceConditionOR-XOR:scaledMeanValue','catChoiceConditionOR-XOR:scaledValueDiff'),]
estimate.rt.nd <- t(rbind(coeff.rt.nd,t(ci.rt)))
colnames(estimate.rt.nd)<-c('coeff','lower','upper')
rownames(estimate.rt.nd) <- NULL
estimate.rt.nd <- data.frame(estimate.rt.nd)
estimate.rt.nd$params <- c('Incl - Excl','(Incl - Excl) X OV','(Incl - Excl) X RV')
estimate.rt.nd$dv <- 'RT'

coeff.acc.nd <- fixef(model.acc.nd)[c('catChoiceConditionOR-XOR','catChoiceConditionOR-XOR:scaledMeanValue','catChoiceConditionOR-XOR:scaledValueDiff')]
df.ci <- confint(model.acc.nd,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.acc <- df.ci[c('catChoiceConditionOR-XOR','catChoiceConditionOR-XOR:scaledMeanValue','catChoiceConditionOR-XOR:scaledValueDiff'),]
estimate.acc.nd <- t(rbind(coeff.acc.nd,t(ci.acc)))
colnames(estimate.acc.nd)<-c('coeff','lower','upper')
rownames(estimate.acc.nd) <- NULL
estimate.acc.nd <- data.frame(estimate.acc.nd)
estimate.acc.nd$params <- c('Incl - Excl','(Incl - Excl) X OV','(Incl - Excl) X RV')
estimate.acc.nd$dv <- 'P(Best First)'

estimate.rt.acc.nd <- rbind(estimate.rt.nd,estimate.acc.nd)
estimate.rt.acc.nd$order <- seq(1,6)
estimate.rt.acc.nd$study <- 'Deselection'

estimate.rt.acc.new <- rbind(estimate.rt.acc.ns,estimate.rt.acc.nd)
estimate.rt.acc.new$params <- factor(estimate.rt.acc.new$params,
                                     levels = c('(Incl - Excl) X RV','(Incl - Excl) X OV','Incl - Excl'))
```



```{r fig.width=4,fig.height=2}
p.summary.new.acc <- ggplot(estimate.rt.acc.new %>% filter(dv=='P(Best First)'),aes(x=params,y=coeff,group=study,color=study)) + geom_hline(yintercept=0,color='#AAAAAA',size=0.2) + geom_point(position = position_dodge(0.6),size=0.5,aes(shape=study)) + geom_errorbar(position = position_dodge(0.6),aes(ymin=lower,ymax=upper),width=0.2) + coord_flip() + theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        text=element_text(size=6),legend.position="none") + scale_y_continuous(limits = c(-0.5,0.5),breaks = c(-0.5,0,0.5)) +  scale_color_manual("",values=c('#222222','#AA0000')) + xlab('') + ylab('') + scale_x_discrete(labels=c('Incl - Excl'='On intercept',
                                                                                                                                                                                                                                          '(Incl - Excl) X OV'='On overall value effect','(Incl - Excl) X RV'='On relative value effect'))

p.summary.new.acc
```







```{r fig.width=4,fig.height=2}
p.summary.new.rt <- ggplot(estimate.rt.acc.new %>% filter(dv=='RT'),aes(x=params,y=coeff,group=study,color=study)) + geom_hline(yintercept=0,color='#AAAAAA',size=0.2) + geom_point(position = position_dodge(0.6),size=1,aes(shape=study)) + geom_errorbar(position = position_dodge(0.6),aes(ymin=lower,ymax=upper),width=0.2,linewidth=0.5) + coord_flip() + theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        text=element_text(size=6),legend.position="none") + scale_y_continuous(limits = c(-0.04,0.04),breaks = c(-0.04,0,0.04)) + scale_color_manual("",values=c('#AA0000','#222222')) + xlab('') + ylab('') + scale_x_discrete(labels=c('Incl - Excl'='On intercept',
                                                                                                                                                                                                                                          '(Incl - Excl) X OV'='On overall value effect','(Incl - Excl) X RV'='On relative value effect'))
p.summary.new.rt

ggsave(filename = '../Figures/Figure7A.pdf',p.summary.new.rt,units = 'cm',width = 5,height = 3)
```


```{r fig.width=1,fig.height=1}


new.mv.1 <- seq(min(quantile(df.total.rt.new.s$scaledMeanValue,0.025),
                    quantile(df.total.rt.new.d$scaledMeanValue,0.025)),
                max(quantile(df.total.rt.new.s$scaledMeanValue,0.975),
                    quantile(df.total.rt.new.d$scaledMeanValue,0.975)),0.1)

eff.df.mv.ns <- marginalConflictMVEffect(model.rating.ns,df.total.rt.new.s$scaledMeanValue,new.mv.1) %>%
  dplyr::mutate(scaledMeanValue=x,
                catChoiceCondition='XOR - OR',
                fit=eff,
                upper=eff+ci,
                lower=eff-ci,
                se=NA,
                study='Selection')

eff.df.mv.nd <- marginalConflictMVEffect(model.rating.nd,df.total.rt.new.d$scaledMeanValue,new.mv.1) %>%
  dplyr::mutate(scaledMeanValue=x,
                catChoiceCondition='XOR - OR',
                fit=eff,
                upper=eff+ci,
                lower=eff-ci,
                se=NA,
                study='Deselection')


eff.df.mv.new <- rbind(eff.df.mv.ns,eff.df.mv.nd)

p.eff.cc.int.new<-ggplot(data=eff.df.mv.new, aes(x=x, y=fit,group=study)) + geom_hline(yintercept=0,color='#AAAAAA',size=0.2) + 
  geom_line(size=0.5,aes(color=study))+theme_bw(12) +
  geom_ribbon(aes(x=x, max = upper, min = lower,fill=study),alpha=0.3)+ 
  xlab("Overall Value\n(z-scored)") + ylab('Effect of Inclusivity') +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), plot.title = element_text(hjust = 0.5,size=6),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),strip.text.y = element_blank()) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c("#AA0000","#222222")) + scale_color_manual("",values=c("#AA0000","#222222")) + # ggtitle('Exclusive - Non-Exclusive') +
  coord_cartesian(ylim=c(-1,0.2)) + scale_y_continuous(breaks = c(-1,0))

p.eff.cc.int.new

ggsave(filename = '../Figures/Figure7B.pdf',p.eff.cc.int.new,units = 'cm',width = 3,height = 3)

```


```{r}
coeff.rt <- t(fixef(model.RT.ns)['catChoiceConditionOR-XOR'])
df.ci <- confint(model.RT.ns,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.rt <- df.ci['catChoiceConditionOR-XOR',]
estimate.rt <- cbind(coeff.rt,t(ci.rt))
colnames(estimate.rt)<-c('coeff','lower','upper')

coeff.acc <- t(fixef(model.acc.ns.dummy)['catChoiceConditionOR-XOR'])
df.ci <- confint(model.acc.ns.dummy,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.acc <- df.ci['catChoiceConditionOR-XOR',]
estimate.acc <- cbind(coeff.acc,t(ci.acc))
colnames(estimate.acc)<-c('coeff','lower','upper')

coeff.conf <- t(fixef(model.rating.ns)['catChoiceConditionOR-XOR'])
df.ci <- confint(model.rating.ns,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.conf <- df.ci['catChoiceConditionOR-XOR',]
estimate.conf <- cbind(coeff.conf,t(ci.conf))
colnames(estimate.conf)<-c('coeff','lower','upper')

estimate.all <- data.frame(rbind(estimate.rt,estimate.acc,estimate.conf))
estimate.all$var <- c('RT','Acc','Conflict')
```


```{r,fig.width=2,fig.height=2}
p.diff.acc.ns <- ggplot(estimate.all %>% filter(var %in% c('Acc')), aes(x=var, y=coeff))  + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  geom_point(stat="identity", position=position_dodge(0.6),size=0.5) +
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.1,size=0.4,
                 position=position_dodge(.6))+labs(x="", y = "Effect of Inclusivity")+theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        text=element_text(size=6),legend.position="none") +
  scale_x_discrete(labels=c("Acc"='P(Best First)')) + scale_y_continuous(limits = c(-0.05,0.05),breaks = c(-0.05,0.05))

p.diff.acc.ns

```


```{r fig.height=2,fig.width=2}
p.diff.rt.ns <- ggplot(estimate.all %>% filter(var %in% c('RT')), aes(x=var, y=coeff))  + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  geom_point(stat="identity", position=position_dodge(0.6),size=0.5) +
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.1,size=0.4,
                 position=position_dodge(.6))+labs(x="", y = "Effect of Inclusivity")+theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        text=element_text(size=6),legend.position="none") +
  scale_x_discrete(labels=c("RT"='log(RT)')) + scale_y_continuous(limits = c(-0.05,0.005),breaks = c(-0.05,0))

p.diff.rt.ns
```


```{r fig.height=2,fig.width=2}
p.diff.conflict.ns <- ggplot(estimate.all %>% filter(var %in% c('Conflict')), aes(x=var, y=coeff))  + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  geom_point(stat="identity", position=position_dodge(0.6),size=0.5) +
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.1,size=0.4,
                 position=position_dodge(.6))+labs(x="", y = "Effect of Inclusivity")+theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        text=element_text(size=6),legend.position="none") +
  scale_x_discrete(labels=c("Conflict"='Conflict')) + scale_y_continuous(limits = c(-0.5,0.02),breaks = c(-0.5,0))
p.diff.conflict.ns
```






```{r fig.width=1, fig.height=1}
eff_mv.RT.ns <- Effect(c("scaledMeanValue","catChoiceCondition"),
                   model.RT.ns,
                   xlevels=list(scaledMeanValue=seq(quantile(df.total.rt.new.s$scaledMeanValue,0.025),
                                                    quantile(df.total.rt.new.s$scaledMeanValue,0.975),0.1)))
IA.mv.RT.ns <- as.data.frame(eff_mv.RT.ns) %>% dplyr::mutate(study='Study 3')

p.eff.mv.rt.ns<-ggplot(data=IA.mv.RT.ns, aes(x=scaledMeanValue, y=fit, group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.mv.RT.ns, aes(x=scaledMeanValue, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab("RT (Log-Transformed)") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + 
  coord_cartesian(ylim=c(.3,.7)) + scale_y_continuous(breaks = c(.3,.7))

p.eff.mv.rt.ns
```


```{r fig.width=2, fig.height=2}
eff_vd.RT.ns <- Effect(c("scaledValueDiff","catChoiceCondition"),
                   model.RT.ns,
                   xlevels=list(scaledValueDiff=seq(quantile(df.total.rt.new.s$scaledValueDiff,0.025),
                                                    quantile(df.total.rt.new.s$scaledValueDiff,0.975),0.1)))
IA.vd.RT.ns <- as.data.frame(eff_vd.RT.ns) %>% dplyr::mutate(study='Study 3')

p.eff.vd.rt.ns<-ggplot(data=IA.vd.RT.ns, aes(x=scaledValueDiff, y=fit, group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.vd.RT.ns, aes(x=scaledValueDiff, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Relative Value\n(z-scored)") + ylab("RT (Log-Transformed)") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + 
  coord_cartesian(ylim=c(.3,.7)) + scale_y_continuous(breaks = c(.3,.7))

p.eff.vd.rt.ns
```



```{r fig.width=1,fig.height=1}

eff_mv.acc.ns <- Effect(c("scaledMeanValue","catChoiceCondition"),
                   model.acc.ns,
                   xlevels=list(scaledMeanValue=seq(quantile(df.total.rt.new.s$scaledMeanValue,0.025),
                                                    quantile(df.total.rt.new.s$scaledMeanValue,0.972),0.1)))
IA.mv.acc.ns <- as.data.frame(eff_mv.acc.ns) %>% dplyr::mutate(study='Study 3')

p.eff.mv.acc.ns <-ggplot(data=IA.mv.acc.ns, aes(x=scaledMeanValue, y=fit, group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.mv.acc.ns, aes(x=scaledMeanValue, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab("P(Best First)") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + 
  coord_cartesian(ylim=c(0.1,0.9)) + scale_y_continuous(breaks = c(0.1,0.9),labels=function(x) sprintf("%.1f", x))

p.eff.mv.acc.ns
#ggsave('Study12_RT.pdf')
```



```{r fig.width=1,fig.height=1}

eff_vd.acc.ns <- Effect(c("scaledValueDiff","catChoiceCondition"),
                   model.acc.ns,
                   xlevels=list(scaledValueDiff=seq(quantile(df.total.rt.new.s$scaledValueDiff,0.025),
                                                    quantile(df.total.rt.new.s$scaledValueDiff,0.975),0.1)))
IA.vd.acc.ns <- as.data.frame(eff_vd.acc.ns) %>% dplyr::mutate(study='Study 3')

p.eff.vd.acc.ns<-ggplot(data=IA.vd.acc.ns, aes(x=scaledValueDiff, y=fit, group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.vd.acc.ns, aes(x=scaledValueDiff, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Relative Value\n(z-scored)") + ylab("P(Best First)") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + 
  coord_cartesian(ylim=c(0.1,0.9)) + scale_y_continuous(breaks = c(0.1,0.9),labels=function(x) sprintf("%.1f", x))

p.eff.vd.acc.ns
#ggsave('Study12_RT.pdf')
```




```{r}
lay <- rbind(c(1,NA,2,NA,3),
             c(4,NA,5,NA,6))

plots <- list(p.diff.rt.ns,p.eff.mv.rt.ns,p.eff.vd.rt.ns,
              p.diff.acc.ns,p.eff.mv.acc.ns,p.eff.vd.acc.ns)
grobs <- list()
widths <- list()
heights <- list()

for (i in 1:length(plots)){
    grobs[[i]] <- ggplotGrob(plots[[i]])
    widths[[i]] <- grobs[[i]]$widths
    heights[[i]] <- grobs[[i]]$heights
}

maxwidth <- do.call(grid::unit.pmax, widths)
maxheight <- do.call(grid::unit.pmax,heights)

for (i in 1:length(grobs)){
     grobs[[i]]$heights <- as.list(maxheight)
     grobs[[i]]$widths <- as.list(maxwidth)
}


for (i in 1:length(grobs)){
     grobs[[i]]$heights <- as.list(maxheight)
     grobs[[i]]$widths <- as.list(maxwidth)
}


p<-grid.arrange(grobs = grobs, layout_matrix = lay,widths=unit(c(2,0.1,2.7,0.1,2.7), c("cm", "cm")),heights=unit(c(3,3),c('cm','cm')))

ggsave(filename = '../Figures/FigureS1.pdf',p,units = 'cm',width = 20,height = 12)
```


```{r}
coeff.rt <- t(fixef(model.RT.nd)['catChoiceConditionOR-XOR'])
df.ci <- confint(model.RT.nd,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.rt <- df.ci['catChoiceConditionOR-XOR',]
estimate.rt <- cbind(coeff.rt,t(ci.rt))
colnames(estimate.rt)<-c('coeff','lower','upper')

coeff.acc <- t(fixef(model.acc.nd.dummy)['catChoiceConditionOR-XOR'])
df.ci <- confint(model.acc.nd.dummy,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.acc <- df.ci['catChoiceConditionOR-XOR',]
estimate.acc <- cbind(coeff.acc,t(ci.acc))
colnames(estimate.acc)<-c('coeff','lower','upper')

coeff.conf <- t(fixef(model.rating.nd)['catChoiceConditionOR-XOR'])
df.ci <- confint(model.rating.nd,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.conf <- df.ci['catChoiceConditionOR-XOR',]
estimate.conf <- cbind(coeff.conf,t(ci.conf))
colnames(estimate.conf)<-c('coeff','lower','upper')

estimate.all <- data.frame(rbind(estimate.rt,estimate.acc,estimate.conf))
estimate.all$var <- c('RT','Acc','Conflict')
```


```{r,fig.width=2,fig.height=2}
p.diff.acc.nd <- ggplot(estimate.all %>% filter(var %in% c('Acc')), aes(x=var, y=coeff))  + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  geom_point(stat="identity", position=position_dodge(0.6),size=0.5) +
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.1,size=0.4,
                 position=position_dodge(.6))+labs(x="", y = "Effect of Inclusivity")+theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        text=element_text(size=6),legend.position="none") +
  scale_x_discrete(labels=c("Acc"='P(Worst First)')) + scale_y_continuous(limits = c(-0.05,0.05),breaks = c(-0.05,0.05))

p.diff.acc.nd

```


```{r fig.height=2,fig.width=2}
p.diff.rt.nd <- ggplot(estimate.all %>% filter(var %in% c('RT')), aes(x=var, y=coeff))  + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  geom_point(stat="identity", position=position_dodge(0.6),size=0.5) +
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.1,size=0.4,
                 position=position_dodge(.6))+labs(x="", y = "Effect of Inclusivity")+theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        text=element_text(size=6),legend.position="none") +
  scale_x_discrete(labels=c("RT"='log(RT)')) + 
  scale_color_manual(values=c('#0673C3','#00B024')) + scale_y_continuous(limits = c(-0.05,0.005),breaks = c(-0.05,0))

p.diff.rt.nd
```


```{r fig.height=2,fig.width=2}
p.diff.conflict.nd <- ggplot(estimate.all %>% filter(var %in% c('Conflict')), aes(x=var, y=coeff))  + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  geom_point(stat="identity", position=position_dodge(0.6),size=0.5) +
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.1,size=0.4,
                 position=position_dodge(.6))+labs(x="", y = "Effect of Inclusivity")+theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        text=element_text(size=6),legend.position="none") +
  scale_x_discrete(labels=c("Conflict"='Conflict')) + 
  scale_color_manual(values=c('#0673C3','#00B024')) + scale_y_continuous(limits = c(-0.5,0.1),breaks = c(-0.5,0))
p.diff.conflict.nd
```



```{r fig.width=1, fig.height=1}
eff_mv.RT.nd <- Effect(c("scaledMeanValue","catChoiceCondition"),
                   model.RT.nd,
                   xlevels=list(scaledMeanValue=seq(quantile(df.total.rt.new.s$scaledMeanValue,0.025),
                                                    quantile(df.total.rt.new.s$scaledMeanValue,0.975),0.1)))
IA.mv.RT.nd <- as.data.frame(eff_mv.RT.nd) %>% dplyr::mutate(study='Study 3')

p.eff.mv.rt.nd<-ggplot(data=IA.mv.RT.nd, aes(x=scaledMeanValue, y=fit, group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.mv.RT.nd, aes(x=scaledMeanValue, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab("RT (Log-Transformed)") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + 
  coord_cartesian(ylim=c(.2,.7)) + scale_y_continuous(breaks = c(.2,.7))

p.eff.mv.rt.nd
```


```{r fig.width=1, fig.height=1}
eff_vd.RT.nd <- Effect(c("scaledValueDiff","catChoiceCondition"),
                   model.RT.nd,
                   xlevels=list(scaledValueDiff=seq(quantile(df.total.rt.new.s$scaledValueDiff,0.025),
                                                    quantile(df.total.rt.new.s$scaledValueDiff,0.975),0.1)))
IA.vd.RT.nd <- as.data.frame(eff_vd.RT.nd) %>% dplyr::mutate(study='Study 3')

p.eff.vd.rt.nd<-ggplot(data=IA.vd.RT.nd, aes(x=scaledValueDiff, y=fit, group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.vd.RT.nd, aes(x=scaledValueDiff, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Relative Value\n(z-scored)") + ylab("RT (Log-Transformed)") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + 
  coord_cartesian(ylim=c(.2,.7)) + scale_y_continuous(breaks = c(.2,.7))

p.eff.vd.rt.nd
```





```{r fig.width=1,fig.height=1}

eff_mv.acc.nd <- Effect(c("scaledMeanValue","catChoiceCondition"),
                   model.acc.nd,
                   xlevels=list(scaledMeanValue=seq(quantile(df.total.rt.new.s$scaledMeanValue,0.025),
                                                    quantile(df.total.rt.new.s$scaledMeanValue,0.972),0.1)))
IA.mv.acc.nd <- as.data.frame(eff_mv.acc.nd) %>% dplyr::mutate(study='Study 3')

p.eff.mv.acc.nd <-ggplot(data=IA.mv.acc.nd, aes(x=scaledMeanValue, y=fit, group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.mv.acc.nd, aes(x=scaledMeanValue, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab("P(Worst First)") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + 
  coord_cartesian(ylim=c(0.1,0.9)) + scale_y_continuous(breaks = c(0.1,0.9),labels=function(x) sprintf("%.1f", x))

p.eff.mv.acc.nd
#ggsave('Study12_RT.pdf')
```



```{r fig.width=1,fig.height=1}

eff_vd.acc.nd <- Effect(c("scaledValueDiff","catChoiceCondition"),
                   model.acc.nd,
                   xlevels=list(scaledValueDiff=seq(quantile(df.total.rt.new.s$scaledValueDiff,0.025),
                                                    quantile(df.total.rt.new.s$scaledValueDiff,0.975),0.1)))
IA.vd.acc.nd <- as.data.frame(eff_vd.acc.nd) %>% dplyr::mutate(study='Study 3')

p.eff.vd.acc.nd<-ggplot(data=IA.vd.acc.nd, aes(x=scaledValueDiff, y=fit, group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.vd.acc.nd, aes(x=scaledValueDiff, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Relative Value\n(z-scored)") + ylab("P(Worst First)") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + 
  coord_cartesian(ylim=c(0.1,0.9)) + scale_y_continuous(breaks = c(0.1,0.9),labels=function(x) sprintf("%.1f", x))

p.eff.vd.acc.nd
#ggsave('Study12_RT.pdf')
```




```{r}
lay <- rbind(c(1,NA,2,NA,3),
             c(4,NA,5,NA,6))

plots <- list(p.diff.rt.nd,p.eff.mv.rt.nd,p.eff.vd.rt.nd,
              p.diff.acc.nd,p.eff.mv.acc.nd,p.eff.vd.acc.nd)
grobs <- list()
widths <- list()
heights <- list()

for (i in 1:length(plots)){
    grobs[[i]] <- ggplotGrob(plots[[i]])
    widths[[i]] <- grobs[[i]]$widths
    heights[[i]] <- grobs[[i]]$heights
}

maxwidth <- do.call(grid::unit.pmax, widths)
maxheight <- do.call(grid::unit.pmax,heights)

for (i in 1:length(grobs)){
     grobs[[i]]$heights <- as.list(maxheight)
     grobs[[i]]$widths <- as.list(maxwidth)
}


for (i in 1:length(grobs)){
     grobs[[i]]$heights <- as.list(maxheight)
     grobs[[i]]$widths <- as.list(maxwidth)
}


p<-grid.arrange(grobs = grobs, layout_matrix = lay,widths=unit(c(2,0.1,2.7,0.1,2.7), c("cm", "cm")),heights=unit(c(3,3),c('cm','cm')))

ggsave(filename = '../Figures/FigureS2.pdf',p,units = 'cm',width = 20,height = 12)
```


```{r fig.width=1,fig.height=1}

eff_mv.cfl.ns <- Effect(c("scaledMeanValue","catChoiceCondition"),
                       model.rating.ns,
                       xlevels=list(scaledMeanValue=seq(quantile(df.total.new.s$scaledMeanValue,0.025),
                                                        quantile(df.total.new.s$scaledMeanValue,0.975),0.1)))
IA.mv.cfl.ns <- as.data.frame(eff_mv.cfl.ns) %>% dplyr::mutate(study='Study 3')

IA.mv.cfl <- IA.mv.cfl.ns

IA.mv.cfl$catChoiceCondition <- relevel(IA.mv.cfl$catChoiceCondition,ref = 'XOR')

p.eff.mv.cfl.ns<-ggplot(data=IA.mv.cfl, aes(x=scaledMeanValue, y=fit,group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.mv.cfl, aes(x=scaledMeanValue, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab("Conflict") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + # ggtitle('Exclusive') +
  coord_cartesian(ylim=c(1,4)) + scale_y_continuous(breaks = c(1,4))

p.eff.mv.cfl.ns
# ggsave('figures/ov_conflict_by_cond_d.pdf',width=4,height=2.5)
```




```{r fig.width=1,fig.height=1}

new.mv.1 <- seq(quantile(df.total.new.s$scaledMeanValue,0.025),
                quantile(df.total.new.s$scaledMeanValue,0.975),0.1)

eff.df.mv.ns <- marginalConflictMVEffect(model.rating.ns,df.total.rt.new.s$scaledMeanValue,new.mv.1) %>%
  dplyr::mutate(scaledMeanValue=x,
                catChoiceCondition='XOR - OR',
                fit= eff,
                upper= eff+ci,
                lower= eff-ci,
                se=NA,
                study='Study 3')

p.eff.cc.int.ns<-ggplot(data=eff.df.mv.ns, aes(x=x, y=fit)) + 
  geom_line(size=0.5)+theme_bw(12) +
  geom_ribbon(data=eff.df.mv.ns, aes(x=x, max = upper, min = lower),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab('Effect of Inclusivity') +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  scale_fill_manual("",values=c("#005555","#550055")) + scale_color_manual("",values=c("#005555","#550055")) + # ggtitle('Exclusive - Non-Exclusive') +
  coord_cartesian(ylim=c(-1,0.2)) + scale_y_continuous(breaks = c(-1,0))

p.eff.cc.int.ns


```



```{r fig.width=1,fig.height=1}

eff_vd.cfl.ns <- Effect(c("scaledValueDiff","catChoiceCondition"),
                   model.rating.ns,
                   xlevels=list(scaledValueDiff=seq(quantile(df.total.new.s$scaledValueDiff,0.025),
                                                    quantile(df.total.new.s$scaledValueDiff,0.975),0.1)))
IA.vd.cfl <- as.data.frame(eff_vd.cfl.ns) %>% dplyr::mutate(study='Study 1')

IA.vd.cfl$catChoiceCondition <- relevel(IA.vd.cfl$catChoiceCondition,ref = 'XOR')

p.eff.vd.cfl.ns<-ggplot(data=IA.vd.cfl, aes(x=scaledValueDiff, y=fit,group=catChoiceCondition)) +
  geom_line(size=0.5,aes(color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.vd.cfl, aes(x=scaledValueDiff, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Relative Value\n(z-scored)") + ylab("Conflict") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024','#008012')) + 
  scale_color_manual("",values=c('#0673C3','#00B024','#008012')) + 
  coord_cartesian(ylim=c(1,4)) + scale_y_continuous(breaks = c(1,4))

p.eff.vd.cfl.ns
#ggsave('Study12_RT.pdf')
```

```{r}
lay <- rbind(c(1,NA,2,NA,3,NA,4))

plots <- list(p.diff.conflict.ns,p.eff.mv.cfl.ns,p.eff.cc.int.ns,p.eff.vd.cfl.ns)
grobs <- list()
widths <- list()
heights <- list()

for (i in 1:length(plots)){
    grobs[[i]] <- ggplotGrob(plots[[i]])
    widths[[i]] <- grobs[[i]]$widths
    heights[[i]] <- grobs[[i]]$heights
}

maxwidth <- do.call(grid::unit.pmax, widths)
maxheight <- do.call(grid::unit.pmax, heights)

for (i in 1:length(grobs)){
  grobs[[i]]$widths <- as.list(maxwidth)
  grobs[[i]]$heights <- as.list(maxheight)
}

p<-grid.arrange(grobs = grobs, layout_matrix = lay,widths=unit(c(1.8,0.1,2.7,0.1,2.7,0.1,2.7), c("cm", "cm")),heights=unit(c(3),c('cm','cm')))

ggsave(filename = '../Figures/FigureS3.pdf',p,units = 'cm',width = 25,height = 12)
```




```{r fig.width=1,fig.height=1}

eff_mv.cfl.nd <- Effect(c("scaledMeanValue","catChoiceCondition"),
                       model.rating.nd,
                       xlevels=list(scaledMeanValue=seq(quantile(df.total.new.d$scaledMeanValue,0.025),
                                                        quantile(df.total.new.d$scaledMeanValue,0.975),0.1)))
IA.mv.cfl.nd <- as.data.frame(eff_mv.cfl.nd) %>% dplyr::mutate(study='Study 3')

IA.mv.cfl <- IA.mv.cfl.nd

IA.mv.cfl$catChoiceCondition <- relevel(IA.mv.cfl$catChoiceCondition,ref = 'XOR')

p.eff.mv.cfl.nd<-ggplot(data=IA.mv.cfl, aes(x=scaledMeanValue, y=fit,group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.mv.cfl, aes(x=scaledMeanValue, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab("Conflict") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024')) + # ggtitle('Exclusive') +
  coord_cartesian(ylim=c(1,4)) + scale_y_continuous(breaks = c(1,4))

p.eff.mv.cfl.nd
# ggsave('figures/ov_conflict_by_cond_d.pdf',width=4,height=2.5)
```

```{r fig.width=1,fig.height=1}

new.mv.1 <- seq(quantile(df.total.new.d$scaledMeanValue,0.025),
                quantile(df.total.new.d$scaledMeanValue,0.975),0.1)

eff.df.mv.nd <- marginalConflictMVEffect(model.rating.nd,df.total.new.d$scaledMeanValue,new.mv.1) %>%
  dplyr::mutate(scaledMeanValue=x,
                catChoiceCondition='XOR - OR',
                fit= eff,
                upper= eff+ci,
                lower= eff-ci,
                se=NA,
                study='Study 3')

p.eff.cc.int.nd<-ggplot(data=eff.df.mv.nd, aes(x=x, y=fit)) + 
  geom_line(size=0.5)+theme_bw(12) +
  geom_ribbon(data=eff.df.mv.nd, aes(x=x, max = upper, min = lower),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab('Effect of Inclusivity') +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  scale_fill_manual("",values=c("#005555","#550055")) + scale_color_manual("",values=c("#005555","#550055")) + # ggtitle('Exclusive - Non-Exclusive') +
  coord_cartesian(ylim=c(-1,0.2)) + scale_y_continuous(breaks = c(-1,0))

p.eff.cc.int.nd


```

```{r fig.width=1,fig.height=1}

eff_vd.cfl.nd <- Effect(c("scaledValueDiff","catChoiceCondition"),
                   model.rating.nd,
                   xlevels=list(scaledValueDiff=seq(quantile(df.total.new.d$scaledValueDiff,0.025),
                                                    quantile(df.total.new.d$scaledValueDiff,0.975),0.1)))
IA.vd.cfl <- as.data.frame(eff_vd.cfl.nd) %>% dplyr::mutate(study='Study 1')

IA.vd.cfl$catChoiceCondition <- relevel(IA.vd.cfl$catChoiceCondition,ref = 'XOR')

p.eff.vd.cfl.nd<-ggplot(data=IA.vd.cfl, aes(x=scaledValueDiff, y=fit,group=catChoiceCondition)) +
  geom_line(size=0.5,aes(color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.vd.cfl, aes(x=scaledValueDiff, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Relative Value\n(z-scored)") + ylab("Conflict") + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#00B024','#008012')) + 
  scale_color_manual("",values=c('#0673C3','#00B024','#008012')) + 
  coord_cartesian(ylim=c(1,4)) + scale_y_continuous(breaks = c(1,4))

p.eff.vd.cfl.nd
#ggsave('Study12_RT.pdf')
```

```{r}
lay <- rbind(c(1,NA,2,NA,3,NA,4))

plots <- list(p.diff.conflict.nd,p.eff.mv.cfl.nd,p.eff.cc.int.nd,p.eff.vd.cfl.nd)
grobs <- list()
widths <- list()
heights <- list()

for (i in 1:length(plots)){
    grobs[[i]] <- ggplotGrob(plots[[i]])
    widths[[i]] <- grobs[[i]]$widths
    heights[[i]] <- grobs[[i]]$heights
}

maxwidth <- do.call(grid::unit.pmax, widths)
maxheight <- do.call(grid::unit.pmax, heights)

for (i in 1:length(grobs)){
  grobs[[i]]$widths <- as.list(maxwidth)
  grobs[[i]]$heights <- as.list(maxheight)
}

p<-grid.arrange(grobs = grobs, layout_matrix = lay,widths=unit(c(1.8,0.1,2.7,0.1,2.7,0.1,2.7), c("cm", "cm")),heights=unit(c(3),c('cm','cm')))

ggsave(filename = '../Figures/FigureS4.pdf',p,units = 'cm',width = 25,height = 12)
```




# All about the voluntary choices

```{r rt_model.good, warning=TRUE}
df.or.rt.12 <- df.total.rt.12 %>% filter(catChoiceCondition=='OR') %>%
    dplyr::mutate(scaledMeanValue=scale(meanValue),
                  scaledValueDiff=scale(valueDiff),
                  scaledTrialNum=scale(trialN),
                  scaledFirstRT=scale(firstRT))


df.or.rt.3 <- df.total.rt.3 %>% filter(catChoiceCondition=='OR') %>%
    dplyr::mutate(scaledMeanValue=scale(meanValue),
                  scaledValueDiff=scale(valueDiff),
                  scaledTrialNum=scale(trialN),
                  scaledFirstRT=scale(firstRT))
```


```{r}
df.or.rt.12.kept <- inner_join(df.or.rt.12,
                               rbind(df.rating.1.summary,df.rating.2.summary),by='participant') %>% 
  rowwise() %>%
  dplyr::mutate(valueKept = getMeanChosen(c(Value1,Value2,Value3,Value4),
                                          c(Order1,Order2,Order3,Order4)),
                minKept=getMinChosen(c(Value1,Value2,Value3,Value4),
                                     c(Order1,Order2,Order3,Order4)),
                NUFKept=getNUFChosen(c(Value1,Value2,Value3,Value4),
                                     c(Order1,Order2,Order3,Order4),
                                     medianValue),
                NUFKept2=getNUFChosen(c(Value1,Value2,Value3,Value4),
                                     c(Order1,Order2,Order3,Order4),
                                     avgValue),
                NUF=getNUF(c(Value1,Value2,Value3,Value4),medianValue),
                NUF2=getNUF(c(Value1,Value2,Value3,Value4),avgValue)) %>% ungroup()

# df.or.rt.12.kept <- inner_join(df.or.rt.12.kept,rbind(df.rating.1.summary,df.rating.2.summary),by='participant')

df.or.rt.new.s.kept <- inner_join(df.or.rt.new.s,df.rating.new.s,by='participant') %>% rowwise() %>%
  dplyr::mutate(valueKept = getMeanChosen(c(Value1,Value2,Value3,Value4),
                                          c(Order1,Order2,Order3,Order4)),
                minKept=getMinChosen(c(Value1,Value2,Value3,Value4),
                                     c(Order1,Order2,Order3,Order4)),
                NUFKept=getNUFChosen(c(Value1,Value2,Value3,Value4),
                                     c(Order1,Order2,Order3,Order4),
                                     medianValue),
                NUFKept2=getNUFChosen(c(Value1,Value2,Value3,Value4),
                                     c(Order1,Order2,Order3,Order4),
                                     avgValue),
                NUF=getNUF(c(Value1,Value2,Value3,Value4),medianValue),
                NUF2=getNUF(c(Value1,Value2,Value3,Value4),avgValue)) %>% ungroup()

# df.or.rt.new.s.kept <- inner_join(df.or.rt.new.s.kept,df.rating.new.s,by='participant')

df.s.combined.or <- rbind(df.or.rt.12.kept %>% select(minKept,valueKept,NUFKept,NChosen,NUF,NUFKept2,NUF2,conflict,meanValue,medianValue,valueDiff,trialN,firstRT,acc,participant) %>% mutate(study='old'),
                          df.or.rt.new.s.kept %>% filter(firstRT<15) %>% select(minKept,valueKept,NUFKept,NChosen,NUF,NUFKept2,NUF2,conflict,meanValue,medianValue,valueDiff,trialN,firstRT,acc,participant) %>% mutate(study='new')) %>% ungroup() %>%
  dplyr::mutate(scaledMeanValue=scale(meanValue),
         scaledValueDiff=scale(valueDiff),
         scaledTrialNum=scale(trialN),
         scaledFirstRT=scale(firstRT),
         scaledConflict=scale(conflict),
         scaledNUF=scale(NUF),
         scaledNUF2=scale(NUF2),
         study=factor(study))

contrasts(df.s.combined.or$acc)<-contr.sum
contrasts(df.s.combined.or$study)<-contr.sum
```



```{r}

df.or.rt.3.kept <- inner_join(df.or.rt.3,
                               df.rating.3.summary,by='participant') %>% 
  rowwise() %>%
  dplyr::mutate(valueKept = getMeanUnChosen(c(Value1,Value2,Value3,Value4),
                                          c(Order1,Order2,Order3,Order4)),
                minKept=getMinUnChosen(c(Value1,Value2,Value3,Value4),
                                     c(Order1,Order2,Order3,Order4)),
                NUFKept=getNUFUnChosen(c(Value1,Value2,Value3,Value4),
                                     c(Order1,Order2,Order3,Order4),
                                     medianValue),
                NUFKept2=getNUFUnChosen(c(Value1,Value2,Value3,Value4),
                                     c(Order1,Order2,Order3,Order4),
                                     avgValue),
                NUF=getNUF(c(Value1,Value2,Value3,Value4),medianValue),
                NUF2=getNUF(c(Value1,Value2,Value3,Value4),avgValue)) %>% ungroup()

df.or.rt.new.d.kept <- inner_join(df.or.rt.new.d,df.rating.new.d,by='participant') %>% rowwise() %>%
  dplyr::mutate(valueKept = getMeanUnChosen(c(Value1,Value2,Value3,Value4),
                                          c(Order1,Order2,Order3,Order4)),
                minKept=getMinUnChosen(c(Value1,Value2,Value3,Value4),
                                     c(Order1,Order2,Order3,Order4)),
                NUFKept=getNUFUnChosen(c(Value1,Value2,Value3,Value4),
                                     c(Order1,Order2,Order3,Order4),
                                     medianValue),
                NUFKept2=getNUFUnChosen(c(Value1,Value2,Value3,Value4),
                                     c(Order1,Order2,Order3,Order4),
                                     avgValue),
                NUF=getNUF(c(Value1,Value2,Value3,Value4),medianValue),
                NUF2=getNUF(c(Value1,Value2,Value3,Value4),avgValue)) %>% ungroup()

df.d.combined.or <- rbind(df.or.rt.3.kept %>% select(minKept,valueKept,NUFKept,NChosen,NUFKept2,NUF,NUF2,conflict,meanValue,medianValue,valueDiff,trialN,firstRT,acc,participant) %>% mutate(study='old'),
                          df.or.rt.new.d.kept %>% filter(firstRT<15) %>% select(minKept,valueKept,NUFKept,NChosen,NUFKept2,NUF,NUF2,conflict,meanValue,medianValue,valueDiff,trialN,firstRT,acc,participant) %>% mutate(study='new')) %>% ungroup() %>%
  dplyr::mutate(scaledMeanValue=scale(meanValue),
         scaledValueDiff=scale(valueDiff),
         scaledTrialNum=scale(trialN),
         scaledFirstRT=scale(firstRT),
         scaledConflict=scale(conflict),
         scaledNUF=scale(NUF),
         scaledNUF2=scale(NUF2),
         NRemain = 4 - NChosen,
         NRemain2 = if_else(NChosen<4,4 - NChosen,1),
         study=factor(study))

contrasts(df.d.combined.or$acc)<-contr.sum
contrasts(df.d.combined.or$study)<-contr.sum
```


```{r}
model.N.s.combined.01 <- lmer(NChosen ~ study * (scaledConflict + poly(scaledMeanValue,2) + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc) + (1 + scaledConflict + poly(scaledMeanValue,2) + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc|participant),data=df.s.combined.or,REML=F)

model.N.d.combined.01 <- lmer(NChosen ~ study * (scaledConflict + poly(scaledMeanValue,2) + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc) + (1 + scaledConflict + poly(scaledMeanValue,2) + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc|participant),data=df.d.combined.or,REML=F)

model.NR.d.combined.01 <- lmer(NRemain ~ study * (scaledConflict + poly(scaledMeanValue,2) + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc) + (1 + scaledConflict + poly(scaledMeanValue,2) + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc|participant),data=df.d.combined.or,REML=F)

```


```{r}
polymv <- poly(df.s.combined.or$scaledMeanValue,2)

df.s.combined.or$mvL <-polymv[,1]
df.s.combined.or$mvQ <-polymv[,2]

model.N.s.combined.01.direct <- lmer(NChosen ~ study * (scaledConflict + mvL + mvQ + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc) + (1 + scaledConflict + mvL + mvQ + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc|participant),data=df.s.combined.or,REML=F)

model.nuf.s.combined.ni.01.direct <- lmer(NUFKept2/NChosen ~ study * (scaledConflict + scaledNUF2 + mvL + mvQ + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc) + (1 + scaledConflict + scaledNUF2 + mvL + mvQ + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc|participant),data=df.s.combined.or,REML=F)

model.nuf.s.combined.ni.01.poly <- lmer(NUFKept2/NChosen ~ study * (scaledConflict + scaledNUF2 + poly(scaledMeanValue,2) + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc) + (1 + scaledConflict + scaledNUF2 + poly(scaledMeanValue,2) + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc|participant),data=df.s.combined.or,REML=F)

model.N.s.combined.01.poly <- lmer(NChosen ~ study * (scaledConflict + poly(scaledMeanValue,2) + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc) + (1 + scaledConflict + poly(scaledMeanValue,2) + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc|participant),data=df.s.combined.or,REML=F)

```







```{r}

polymv <- poly(df.d.combined.or$scaledMeanValue,2)

df.d.combined.or$mvL <-polymv[,1]
df.d.combined.or$mvQ <-polymv[,2]

model.N.d.combined.01.direct <- lmer(NChosen ~ study * (scaledConflict + mvL + mvQ + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc) + (1 + scaledConflict + mvL + mvQ + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc|participant),data=df.d.combined.or,REML=F)

model.NR.d.combined.01.direct <- lmer(NRemain ~ study * (scaledConflict + mvL + mvQ + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc) + (1 + scaledConflict + mvL + mvQ + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc|participant),data=df.d.combined.or,REML=F)

model.nuf.d.combined.ni.01.direct <- lmer(NUFKept2/NRemain2 ~ study * (scaledConflict + scaledNUF2 + mvL + mvQ + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc) + (1 + scaledConflict + scaledNUF2 + mvL + mvQ + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc|participant),data=df.d.combined.or,REML=F)

model.nuf.d.combined.ni.01.poly <- lmer(NUFKept2/NRemain2 ~ study * (scaledConflict + scaledNUF2 + poly(scaledMeanValue,2) + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc) + (1 + scaledConflict + scaledNUF2 + poly(scaledMeanValue,2) + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc|participant),data=df.d.combined.or,REML=F)

model.N.d.combined.01.poly <- lmer(NChosen ~ study * (scaledConflict + poly(scaledMeanValue,2) + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc) + (1 + scaledConflict + poly(scaledMeanValue,2) + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc|participant),data=df.d.combined.or,REML=F)
```

```{r}
df.all.combined.or.gr <- rbind(df.s.combined.or %>% mutate(NUFRatio=NUFKept2/NChosen,
                                                           NKept=NChosen) %>% select(NUFRatio,NUF2,NKept,conflict,meanValue,valueDiff,trialN,firstRT,acc,participant,scaledConflict,scaledMeanValue,scaledValueDiff,scaledFirstRT,scaledTrialNum,study,scaledNUF2) %>% mutate(action='s'),
                               df.d.combined.or %>% mutate(NUFRatio=NUFKept2/NRemain2,
                                                           NKept=NRemain) %>% 
select(NUFRatio,NUF2,NKept,conflict,meanValue,valueDiff,trialN,firstRT,acc,participant,scaledConflict,scaledMeanValue,scaledValueDiff,scaledFirstRT,scaledTrialNum,study,scaledNUF2) %>% mutate(action='r')) %>% mutate(action=factor(action)) %>%
  mutate(study=factor(study),
         scaledConflict=scale(conflict),
         scaledMeanValue=scale(meanValue),
         scaledValueDiff=scale(valueDiff),
         scaledTrialNum=scale(trialN),
         scaledFirstRT=scale(firstRT),
         scaledNUF2=scale(NUF2))

contrasts(df.all.combined.or.gr$acc)<-contr.sum
contrasts(df.all.combined.or.gr$study)<-contr.sum
contrasts(df.all.combined.or.gr$action)<-contr.sum

model.N.all.combined<- lmer(NKept ~ study * action * (scaledConflict + poly(scaledMeanValue,2) + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc) + (1 + scaledConflict + poly(scaledMeanValue,2) + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc|participant),data=df.all.combined.or.gr)

model.nuf.all.combined.ni<- lmer(NUFRatio ~ study * action * (scaledConflict + scaledNUF2 + poly(scaledMeanValue,2) + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc) + (1 + scaledConflict + scaledNUF2 + poly(scaledMeanValue,2) + scaledTrialNum + scaledValueDiff + scaledFirstRT + acc|participant),data=df.all.combined.or.gr)


```


```{r}
library(kableExtra)

kbl(car::Anova(model.N.s.combined.01.poly,type="III"),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
kbl(car::Anova(model.N.d.combined.01.poly,type="III"),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
kbl(car::Anova(model.nuf.s.combined.ni.01.poly,type="III"),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
kbl(car::Anova(model.nuf.d.combined.ni.01.poly,type="III"),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")

```

```{r}

kbl(car::Anova(model.N.all.combined,type="III"),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
kbl(car::Anova(model.nuf.all.combined.ni,type="III"),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")

```


```{r}
tab_model(model.N.s.combined.01,model.N.d.combined.01,model.NR.d.combined.01,model.N.all.combined,digits=3)

```


```{r}
tab_model(model.nuf.s.combined.ni.01.direct,model.nuf.d.combined.ni.01.direct,digits=3)

```

```{r}
tab_model(model.nuf.all.combined.ni,digits=3)

```


```{r fig.height=2,fig.width=2}

eff_vd.n.s.all <- Effect(c("scaledValueDiff"),
                   model.N.s.combined.01,
                   xlevels=list(scaledValueDiff=seq(min(quantile(df.s.combined.or$scaledValueDiff,0.025),
                                                        quantile(df.d.combined.or$scaledValueDiff,0.025)),
                                                    max(quantile(df.s.combined.or$scaledValueDiff,0.975),
                                                        quantile(df.d.combined.or$scaledValueDiff,0.975)),0.1)))
IA.vd.N.s.all <- as.data.frame(eff_vd.n.s.all) %>% mutate(study='Selection')


eff_vd.n.d.all <- Effect(c("scaledValueDiff"),
                   model.N.d.combined.01,
                   xlevels=list(scaledValueDiff=seq(min(quantile(df.s.combined.or$scaledValueDiff,0.025),
                                                        quantile(df.d.combined.or$scaledValueDiff,0.025)),
                                                    max(quantile(df.s.combined.or$scaledValueDiff,0.975),
                                                        quantile(df.d.combined.or$scaledValueDiff,0.975)),0.1)))
IA.vd.N.d.all <- as.data.frame(eff_vd.n.d.all) %>% mutate(study='Removal')

IA.vd.N.all <- rbind(IA.vd.N.s.all,IA.vd.N.d.all)


```


```{r fig.width=2,fig.height=2}

p.eff.vd.N.all<-ggplot(data=IA.vd.N.all, aes(x=scaledValueDiff, y=fit, group=study)) +
  geom_line(size=0.5,aes(color=study))+theme_bw(12) +
  geom_ribbon(data=IA.vd.N.all, aes(x=scaledValueDiff, max = upper, min = lower,fill=study),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Relative Value\n(z-scored)") + ylab("N Chosen") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        axis.title.y.right = element_text(color = '#AA0000', size=6)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#AA0000','#222222')) + 
  scale_color_manual("",values=c('#AA0000','#222222')) + 
  coord_cartesian(ylim=c(1.5,2.5)) +   scale_y_continuous(
    name = "N Chosen",
    breaks = c(1.5,2.5),
    sec.axis = sec_axis(~.*1, name="N Removed",breaks=c(1.5,2.5))
  )
p.eff.vd.N.all
```


```{r fig.height=2,fig.width=2}

eff_mv.n.s.all <- Effect(c("scaledMeanValue"),
                   model.N.s.combined.01,
                   xlevels=list(scaledMeanValue=seq(min(quantile(df.s.combined.or$scaledMeanValue,0.025),
                                                        quantile(df.d.combined.or$scaledMeanValue,0.025)),
                                                    max(quantile(df.s.combined.or$scaledMeanValue,0.975),
                                                        quantile(df.d.combined.or$scaledMeanValue,0.975)),0.1)))
IA.mv.N.s.all <- as.data.frame(eff_mv.n.s.all) %>% mutate(study='Selection')


eff_mv.n.d.all <- Effect(c("scaledMeanValue"),
                   model.N.d.combined.01,
                   xlevels=list(scaledMeanValue=seq(min(quantile(df.s.combined.or$scaledMeanValue,0.025),
                                                        quantile(df.d.combined.or$scaledMeanValue,0.025)),
                                                    max(quantile(df.s.combined.or$scaledMeanValue,0.975),
                                                        quantile(df.d.combined.or$scaledMeanValue,0.975)),0.1)))
IA.mv.N.d.all <- as.data.frame(eff_mv.n.d.all) %>% mutate(study='Removal')

IA.mv.N.all <- rbind(IA.mv.N.s.all,IA.mv.N.d.all)


```


```{r fig.width=2,fig.height=2}

p.eff.mv.N.all<-ggplot(data=IA.mv.N.all, aes(x=scaledMeanValue, y=fit, group=study)) +
  geom_line(size=0.5,aes(color=study))+theme_bw(12) +
  geom_ribbon(data=IA.mv.N.all, aes(x=scaledMeanValue, max = upper, min = lower,fill=study),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab("N Chosen") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        axis.title.y.right = element_text(color = '#AA0000', size=6)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#AA0000','#222222')) + 
  scale_color_manual("",values=c('#AA0000','#222222')) + 
  coord_cartesian(ylim=c(1,4)) +   scale_y_continuous(
    name = "N Chosen",
    breaks = c(1,4),
    sec.axis = sec_axis(~.*1, name="N Removed",breaks=c(1,4))
  )
p.eff.mv.N.all

```



```{r fig.height=2,fig.width=2}

eff_mv.nc.s <- Effect(c("scaledConflict"),
                   model.N.s.combined.01.direct,
                   xlevels=list(scaledConflict=seq(min(quantile(df.s.combined.or$scaledConflict,0.025),
                                                        quantile(df.d.combined.or$scaledConflict,0.025)),
                                                    max(quantile(df.s.combined.or$scaledConflict,0.975),
                                                        quantile(df.d.combined.or$scaledConflict,0.975)),0.1)))
IA.mv.nc.s <- as.data.frame(eff_mv.nc.s) %>% mutate(study='Selection')


eff_mv.nc.d <- Effect(c("scaledConflict"),
                   model.NR.d.combined.01.direct,
                   xlevels=list(scaledConflict=seq(min(quantile(df.s.combined.or$scaledConflict,0.025),
                                                        quantile(df.d.combined.or$scaledConflict,0.025)),
                                                    max(quantile(df.s.combined.or$scaledConflict,0.975),
                                                        quantile(df.d.combined.or$scaledConflict,0.975)),0.1)))
IA.mv.nc.d <- as.data.frame(eff_mv.nc.d) %>% mutate(study='Removal')

IA.mv.nc.t <- rbind(IA.mv.nc.s,IA.mv.nc.d) %>% mutate(study=relevel(factor(study),ref = 'Selection'))


test<-ggplot(data=IA.mv.nc.t, aes(x=scaledConflict, y=fit, group=study)) +
  geom_line(size=0.5,aes(color=study))+theme_bw(12) +
  geom_ribbon(data=IA.mv.nc.t, aes(x=scaledConflict, max = upper, min = lower,fill=study),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Conflict\n(z-scored)") + ylab("N Kept") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position = 'none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#222222','#AA0000')) + 
  scale_color_manual("",values=c('#222222','#AA0000')) + 
  coord_cartesian(ylim=c(2,2.5)) + scale_y_continuous(breaks = c(2,2.5))
test

```



```{r fig.height=2,fig.width=2}

eff_mv.nc.s <- Effect(c("scaledConflict"),
                   model.nuf.s.combined.ni.01.direct,
                   xlevels=list(scaledConflict=seq(min(quantile(df.s.combined.or$scaledConflict,0.025),
                                                        quantile(df.d.combined.or$scaledConflict,0.025)),
                                                    max(quantile(df.s.combined.or$scaledConflict,0.975),
                                                        quantile(df.d.combined.or$scaledConflict,0.975)),0.1)))
IA.mv.nc.s <- as.data.frame(eff_mv.nc.s) %>% mutate(study='Selection')


eff_mv.nc.d <- Effect(c("scaledConflict"),
                   model.nuf.d.combined.ni.01.direct,
                   xlevels=list(scaledConflict=seq(min(quantile(df.s.combined.or$scaledConflict,0.025),
                                                        quantile(df.d.combined.or$scaledConflict,0.025)),
                                                    max(quantile(df.s.combined.or$scaledConflict,0.975),
                                                        quantile(df.d.combined.or$scaledConflict,0.975)),0.1)))
IA.mv.nc.d <- as.data.frame(eff_mv.nc.d) %>% mutate(study='Removal')

IA.mv.nc.t <- rbind(IA.mv.nc.s,IA.mv.nc.d) %>% mutate(study=relevel(factor(study),ref = 'Selection'))


test2<-ggplot(data=IA.mv.nc.t, aes(x=scaledConflict, y=fit, group=study)) +
  geom_line(size=0.5,aes(color=study))+theme_bw(12) +
  geom_ribbon(data=IA.mv.nc.t, aes(x=scaledConflict, max = upper, min = lower,fill=study),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Conflict\n(z-scored)") + ylab("P(Suboptimal)") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position = 'none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#222222','#AA0000')) + 
  scale_color_manual("",values=c('#222222','#AA0000')) + 
  coord_cartesian(ylim=c(.2,.4)) + scale_y_continuous(breaks = c(.2,.4))
test2

```



```{r}

df.value.12 <- gather(df.total.rt.12 %>% select(participant,trialN,Value1:Value4,meanValue,valueDiff,catChoiceCondition),
       'position','value',Value1:Value4)

df.order.12 <- gather(df.total.rt.12 %>% select(participant,trialN,Order1:Order4),
       'position','order',Order1:Order4)

df.value.12$order <- df.order.12$order

df.order.value.12 <- inner_join(df.value.12,rbind(df.rating.1.summary,df.rating.2.summary),by='participant')

df.value.ns <- gather(df.total.rt.new.s %>% select(participant,trialN,Value1:Value4,meanValue,valueDiff,catChoiceCondition),
       'position','value',Value1:Value4)

df.order.ns <- gather(df.total.rt.new.s %>% select(participant,trialN,Order1:Order4),
       'position','order',Order1:Order4)

df.value.ns$order <- df.order.ns$order

df.order.value.ns <- inner_join(df.value.ns,df.rating.new.s %>% select(participant,medianValue,avgValue),by='participant')

df.order.value.s <- rbind(df.order.value.12 %>% mutate(study='1'),df.order.value.ns %>% mutate(study='2')) %>% 
  filter(catChoiceCondition=='OR') %>%
  mutate(isOpt=factor(value>avgValue),
         isChosen=factor(order>0),
         order=factor(order),
         scaledMeanValue=scale(meanValue),
         scaledValueDiff=scale(valueDiff),
         scaledValue=scale(value),
         scaledAvgValue=scale(avgValue),
         scaledDevValue=scale(value-avgValue),
         study=factor(study))
contrasts(df.order.value.s$study)<-contr.sum


model.order.s <- glmer(isChosen ~ scaledMeanValue + scaledDevValue + (1 + scaledMeanValue + scaledDevValue |participant) + (1|study),data=df.order.value.s,
                     family=binomial())

summary(model.order.s)

df.value.3 <- gather(df.total.rt.3 %>% select(participant,trialN,Value1:Value4,meanValue,valueDiff,catChoiceCondition),
       'position','value',Value1:Value4)

df.order.3 <- gather(df.total.rt.3 %>% select(participant,trialN,Order1:Order4),
       'position','order',Order1:Order4)

df.value.3$order <- df.order.3$order

df.order.value.3 <- inner_join(df.value.3,df.rating.3.summary,by='participant')

df.value.newd <- gather(df.total.rt.new.d %>% select(participant,trialN,Value1:Value4,meanValue,valueDiff,catChoiceCondition),
       'position','value',Value1:Value4)

df.order.newd <- gather(df.total.rt.new.d %>% select(participant,trialN,Order1:Order4),
       'position','order',Order1:Order4)

df.value.newd$order <- df.order.newd$order

df.order.value.nd <- inner_join(df.value.newd,df.rating.new.d  %>% select(participant,medianValue,avgValue),by='participant')

df.order.value.d <- rbind(df.order.value.3 %>% mutate(study='1'),df.order.value.nd %>% mutate(study='2')) %>% 
  filter(catChoiceCondition=='OR') %>%
  mutate(isOpt=factor(value>avgValue),
         isChosen=factor(order>0),
         scaledMeanValue=scale(meanValue),
         scaledValueDiff=scale(valueDiff),
         scaledValue=scale(value),
         scaledAvgValue=scale(avgValue),
         scaledDevValue=scale(value-avgValue),
         study=factor(study))
contrasts(df.order.value.d$study)<-contr.sum


model.order.d <- glmer(isChosen ~ scaledMeanValue + scaledDevValue + (1 + scaledMeanValue + scaledDevValue |participant) + (1|study),data=df.order.value.d,
                     family=binomial())

summary(model.order.d)

rawDevValue <- seq(-5,5,0.1)

newscaledDevValue <- scale(rawDevValue,center = mean(df.order.value.d$value-df.order.value.d$avgValue),
                           scale = sd(df.order.value.d$value-df.order.value.d$avgValue))

df.effect.value.d <- data.frame(Effect(model.order.d,focal.predictors = c('scaledDevValue'),xlevels=list(scaledDevValue=newscaledDevValue)))

df.effect.value.d$rawx <- rawDevValue

df.effect.value.d$study <- 'd'

newscaledDevValue <- scale(rawDevValue,center = mean(df.order.value.s$value-df.order.value.s$avgValue),
                           scale = sd(df.order.value.s$value-df.order.value.s$avgValue))

df.effect.value.s <- data.frame(Effect(model.order.s,focal.predictors = c('scaledDevValue'),xlevels=list(scaledDevValue=newscaledDevValue)))

df.effect.value.s$rawx <- rawDevValue

df.effect.value.s$study <- 's'

df.effect.value <- rbind(df.effect.value.s,df.effect.value.d) %>% mutate(study=factor(study))

contrasts(df.effect.value$study) <- contr.sum
```

```{r}
p.eff.vtr.N.all<-ggplot(data=df.effect.value, aes(x=rawx, y=fit, group=study)) +
  geom_line(size=0.5,aes(color=study))+theme_bw(12) +
  geom_ribbon(data=df.effect.value, aes(x=rawx, max = upper, min = lower,fill=study),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Item Value - Average") + ylab("P(Chosen)") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        axis.title.y.right = element_text(color = '#AA0000', size=6)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#AA0000','#222222')) + 
  scale_color_manual("",values=c('#AA0000','#222222')) + 
  coord_cartesian(ylim=c(0,1)) +   scale_y_continuous(
    breaks = c(0,0.5,1),
    sec.axis = sec_axis(~.*1, name="P(Removed)",breaks=c(0,0.5,1))
  ) + geom_vline(xintercept = 0,size=0.2) + geom_hline(yintercept = 0.5,size=0.2)
p.eff.vtr.N.all

```


```{r}
lay <- rbind(c(1,2,NA),c(1,2,3),c(4,5,3),c(4,5,NA))

plots <- list(p.eff.mv.N.all,p.eff.vd.N.all,p.eff.vtr.N.all,test,test2)
grobs <- list()
widths <- list()
heights <- list()

for (i in 1:length(plots)){
    grobs[[i]] <- ggplotGrob(plots[[i]])
    widths[[i]] <- grobs[[i]]$widths
    heights[[i]] <- grobs[[i]]$heights
}

maxwidth <- do.call(grid::unit.pmax, widths)
maxheight <- do.call(grid::unit.pmax,heights)

for (i in 1:length(grobs)){
     grobs[[i]]$heights <- as.list(maxheight)
     grobs[[i]]$widths <- as.list(maxwidth)
}

p<-grid.arrange(grobs = grobs, layout_matrix = lay,widths=unit(c(3.6,3.6,3.6), c("cm", "cm")),heights=unit(c(1.5,1.5,1.5,1.5),c('cm')))

ggsave(filename = '../Figures/Figure9_V3.pdf',p,units = 'cm',width = 18,height = 10)
```

```{r}

df.rating.ddl <- read.csv('../Data/Study4/Study4_2.csv')

df.total.ddl <- read.csv('../Data/Study4/Study4_1.csv') %>%
  mutate(catChoiceCondition=relevel(factor(duration),ref='60'),
         isBestFirst=firstValue==bestValue,
         scaledMeanValue=scale(meanValue),
         scaledValueDiff=scale(valueDiff),
         scaledTrialNum=scale(trialN))

df.total.rt.ddl <- df.total.ddl %>% 
  mutate(catChoiceCondition=relevel(factor(duration),ref='60'),
         rr=firstValue/firstRT) %>% filter(firstRT>0.1,firstRT<15) %>%
  mutate(scaledMeanValue=scale(meanValue),
         scaledValueDiff=scale(valueDiff),
         scaledTrialNum=scale(trialN))

contrasts(df.total.ddl$catChoiceCondition)<-contr.sdif
contrasts(df.total.rt.ddl$catChoiceCondition)<-contr.sdif
df.total.rt.ddl$scaledRT<-scale(log10(df.total.rt.ddl$firstRT))
df.total.rt.ddl$acc<-as.factor(df.total.rt.ddl$isBestFirst)
contrasts(df.total.rt.ddl$acc)<-contr.sum
```


```{r}
df.total.rt.ddl$rr <- df.total.rt.ddl$firstValue/df.total.rt.ddl$firstRT

model.rr <- lmerTest::lmer(rr ~ catChoiceCondition * ( scaledMeanValue + scaledValueDiff) + scaledTrialNum + (1 + catChoiceCondition * ( scaledMeanValue + scaledValueDiff) + scaledTrialNum|participant),data=df.total.rt.ddl)

```




```{r}

model.RT <- lmerTest::lmer(firstRT ~ catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.total.rt.ddl)

model.acc <- glmer(isBestFirst ~ catChoiceCondition * scaledMeanValue +  catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * scaledMeanValue +  catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.total.rt.ddl,family = binomial)

model.acc.dummy <- lmer(isBestFirst ~ catChoiceCondition * scaledMeanValue +  catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * scaledMeanValue +  catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.total.rt.ddl)

# model.rr.ddl <- lmerTest::lmer(rr ~ catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * scaledMeanValue + catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.total.rt.ddl)

model.rating <- lmerTest::lmer(conflict ~ catChoiceCondition * poly(scaledMeanValue,2) + catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * poly(scaledMeanValue,2) + scaledValueDiff|participant),data=df.total.ddl)


```


```{r}
library(kableExtra)

kbl(car::Anova(model.RT,type="III"),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
kbl(car::Anova(model.acc,type="III"),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
kbl(car::Anova(model.rating,type="III"),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
```


```{r}
model.RT.coeff <- lmerTest::lmer(firstRT ~ catChoiceCondition / scaledMeanValue + catChoiceCondition / scaledValueDiff + scaledTrialNum + 
                     (1 + catChoiceCondition / scaledMeanValue + catChoiceCondition / scaledValueDiff + scaledTrialNum|participant), 
                   data=df.total.rt.ddl)

```


```{r}
coeff.mat.RT <- coef(summary(model.RT.coeff))
coeff.mat.RT.ov <- data.frame(coeff.mat.RT[c('catChoiceCondition3:scaledMeanValue',
                                      'catChoiceCondition60:scaledMeanValue'),
                                    c('Estimate','Std. Error')])
coeff.mat.RT.ov$catChoiceCondition <- c('OR','XOR')
colnames(coeff.mat.RT.ov) <- c('beta_OV','se_OV','catChoiceCondition')
coeff.mat.RT.vd <- data.frame(coeff.mat.RT[c('catChoiceCondition3:scaledValueDiff',
                                      'catChoiceCondition60:scaledValueDiff')
                                    ,c('Estimate','Std. Error')])
coeff.mat.RT.vd$catChoiceCondition <- c('OR','XOR')
colnames(coeff.mat.RT.vd) <- c('beta_VD','se_VD','catChoiceCondition')

coeff.mat.RT <- inner_join(data.frame(coeff.mat.RT.ov),
                             data.frame(coeff.mat.RT.vd),by='catChoiceCondition') %>% mutate(study='Study DDL')
rownames(coeff.mat.RT) <- NULL

coeff.mat.RT <- rbind(coeff.mat.RT)

#coeff.mat.RT$catChoiceCondition <- rownames(coeff.mat.RT)
```



### Extract coefficents in DDL study

```{r}
model.acc.coeff <- glmer(isBestFirst ~ catChoiceCondition / scaledMeanValue + catChoiceCondition / scaledValueDiff + scaledTrialNum + 
                     (1 + catChoiceCondition / scaledMeanValue + catChoiceCondition / scaledValueDiff + scaledTrialNum|participant),
                     data=df.total.rt.ddl,family=binomial)

```


```{r}
coeff.mat.Acc <- coef(summary(model.acc.coeff))
coeff.mat.Acc.ov <- data.frame(coeff.mat.Acc[c('catChoiceCondition3:scaledMeanValue',
                                      'catChoiceCondition60:scaledMeanValue'),
                                    c('Estimate','Std. Error')])
coeff.mat.Acc.ov$catChoiceCondition <- c('OR','XOR')
colnames(coeff.mat.Acc.ov) <- c('beta_OV','se_OV','catChoiceCondition')
coeff.mat.Acc.vd <- data.frame(coeff.mat.Acc[c('catChoiceCondition3:scaledValueDiff',
                                      'catChoiceCondition60:scaledValueDiff')
                                    ,c('Estimate','Std. Error')])
coeff.mat.Acc.vd$catChoiceCondition <- c('OR','XOR')
colnames(coeff.mat.Acc.vd) <- c('beta_VD','se_VD','catChoiceCondition')

coeff.mat.Acc <- inner_join(data.frame(coeff.mat.Acc.ov),
                             data.frame(coeff.mat.Acc.vd),by='catChoiceCondition') %>% mutate(study='Study DDL')
rownames(coeff.mat.Acc) <- NULL

coeff.mat.Acc <- rbind(coeff.mat.Acc)

coeff.mat.RT.total <- rbind(coeff.mat.RT,coeff.mat.RT.12) %>% mutate(color=c('DDL','NULL','OR','NULL'))


coeff.mat.Acc.total <- rbind(coeff.mat.Acc,coeff.mat.Acc.12) %>% mutate(color=c('DDL','NULL','OR','NULL'))
```

```{r fig.width=1,fig.height=1}
coeff.mat.RT.total$catChoiceCondition <- relevel(factor(coeff.mat.RT.total$catChoiceCondition),'XOR')
p.rt.mv.coeff.summary.14 <- ggplot(coeff.mat.RT.total %>% filter(study %in% c('Study 12','Study DDL')),aes(x = study,y=beta_OV,group=catChoiceCondition,color=color)) + geom_point(position = position_dodge(0.5),size=1) + geom_errorbar(position=position_dodge(0.5),aes(ymin=beta_OV-se_OV,ymax=beta_OV+se_OV,color=color),width=0.1) + theme_bw(12) + theme(panel.border = element_blank(), panel.grid.major = element_blank(), plot.title = element_text(hjust = 0.5,size=6),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",0.2),
        axis.ticks=element_line(colour='black',0.2)) + 
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + ylab('Effect of OV') + xlab('') + scale_x_discrete(labels=c('Inclusivity','Urgency')) + scale_color_manual(values=c('#B02000','#0673C3',"#00B024"))  + scale_y_continuous(limits = c(-0.5,0.05),breaks=c(-0.5,0)) + geom_hline(yintercept = 0,linetype="dashed",size=0.2)

p.rt.mv.coeff.summary.14

```



```{r fig.width=1,fig.height=1}
coeff.mat.RT.total$catChoiceCondition <- relevel(factor(coeff.mat.RT.total$catChoiceCondition),'XOR')
p.rt.vd.coeff.summary.14 <- ggplot(coeff.mat.RT.total %>% filter(study %in% c('Study 12','Study DDL')),aes(x = study,y=beta_VD,group=catChoiceCondition,color=color)) + geom_point(position = position_dodge(0.5),size=1) + geom_errorbar(position=position_dodge(0.5),aes(ymin=beta_VD-se_VD,ymax=beta_VD+se_VD,color=color),width=0.1) + theme_bw(12) + theme(panel.border = element_blank(), panel.grid.major = element_blank(), plot.title = element_text(hjust = 0.5,size=6),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",0.2),
        axis.ticks=element_line(colour='black',0.2)) + 
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + ylab('Effect of RV') + xlab('') + scale_x_discrete(labels=c('Inclusivity','Urgency')) + scale_color_manual(values=c('#B02000','#0673C3',"#00B024"))  + scale_y_continuous(limits = c(-0.5,0.05),breaks=c(-0.5,0)) + geom_hline(yintercept = 0,linetype="dashed",size=0.2)

p.rt.vd.coeff.summary.14

```


```{r}
model.rating.coeff <- lmer(conflict ~ catChoiceCondition / poly(scaledMeanValue,2) + catChoiceCondition / scaledValueDiff + scaledTrialNum + 
                     (1 + catChoiceCondition / poly(scaledMeanValue,2) + catChoiceCondition / scaledValueDiff + scaledTrialNum|participant),
                     data=df.total.ddl)
```

```{r}
model.rating.coeff.12 <- lmer(conflict ~ catChoiceCondition / poly(scaledMeanValue,2) + catChoiceCondition / scaledValueDiff + scaledTrialNum + 
                     (1 + catChoiceCondition / poly(scaledMeanValue,2) + catChoiceCondition / scaledValueDiff + scaledTrialNum|participant),
                     data=df.total.valid.12)

```


```{r}
coeff.mat.rating <- coef(summary(model.rating.coeff))
coeff.mat.rating.ov <- data.frame(coeff.mat.rating[c('catChoiceCondition3:poly(scaledMeanValue, 2)1',
                                      'catChoiceCondition60:poly(scaledMeanValue, 2)1'),
                                    c('Estimate','Std. Error')])
coeff.mat.rating.ov$catChoiceCondition <- c('OR','XOR')
colnames(coeff.mat.rating.ov) <- c('beta_OV','se_OV','catChoiceCondition')
coeff.mat.rating.vd <- data.frame(coeff.mat.rating[c('catChoiceCondition3:scaledValueDiff',
                                      'catChoiceCondition60:scaledValueDiff')
                                    ,c('Estimate','Std. Error')])
coeff.mat.rating.vd$catChoiceCondition <- c('OR','XOR')
colnames(coeff.mat.rating.vd) <- c('beta_VD','se_VD','catChoiceCondition')

coeff.mat.rating <- inner_join(data.frame(coeff.mat.rating.ov),
                             data.frame(coeff.mat.rating.vd),by='catChoiceCondition') %>% mutate(study='Study DDL')
rownames(coeff.mat.rating) <- NULL

coeff.mat.rating <- rbind(coeff.mat.rating)

#coeff.mat.RT$catChoiceCondition <- rownames(coeff.mat.RT)
```


```{r}
coeff.mat.rating.12 <- coef(summary(model.rating.coeff.12))
coeff.mat.rating.12.ov <- data.frame(coeff.mat.rating.12[c('catChoiceConditionOR:poly(scaledMeanValue, 2)1',
                                      'catChoiceConditionXOR:poly(scaledMeanValue, 2)1'),
                                    c('Estimate','Std. Error')])
coeff.mat.rating.12.ov$catChoiceCondition <- c('OR','XOR')
colnames(coeff.mat.rating.12.ov) <- c('beta_OV','se_OV','catChoiceCondition')
coeff.mat.rating.12.vd <- data.frame(coeff.mat.rating.12[c('catChoiceConditionOR:scaledValueDiff',
                                      'catChoiceConditionXOR:scaledValueDiff')
                                    ,c('Estimate','Std. Error')])
coeff.mat.rating.12.vd$catChoiceCondition <- c('OR','XOR')
colnames(coeff.mat.rating.12.vd) <- c('beta_VD','se_VD','catChoiceCondition')

coeff.mat.rating.12 <- inner_join(data.frame(coeff.mat.rating.12.ov),
                             data.frame(coeff.mat.rating.12.vd),by='catChoiceCondition') %>% mutate(study='Study 12')
rownames(coeff.mat.rating.12) <- NULL

coeff.mat.rating.12 <- rbind(coeff.mat.rating.12)

#coeff.mat.RT$catChoiceCondition <- rownames(coeff.mat.RT)

coeff.mat.rating.total <- rbind(coeff.mat.rating,coeff.mat.rating.12) %>% mutate(color=c('DDL','NULL','OR','NULL'))
```




```{r fig.width=1,fig.height=1}
coeff.mat.rating.total$catChoiceCondition <- relevel(factor(coeff.mat.rating.total$catChoiceCondition),'XOR')
p.cfl.mv.coeff.summary.14 <-ggplot(coeff.mat.rating.total %>% filter(study %in% c('Study 12','Study DDL')),aes(x = study,y=beta_OV,group=catChoiceCondition,color=color)) + geom_point(position = position_dodge(0.5),size=1) + geom_errorbar(position=position_dodge(0.5),aes(ymin=beta_OV-se_OV,ymax=beta_OV+se_OV,color=color),width=0.1) + theme_bw(12) + theme(panel.border = element_blank(), panel.grid.major = element_blank(), plot.title = element_text(hjust = 0.5,size=6),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",0.2),
        axis.ticks=element_line(colour='black',0.2)) + 
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + ylab('Effect of OV\n(1st Order)') + xlab('') + scale_x_discrete(labels=c('Inclusivity','Urgency')) + scale_color_manual(values=c('#B02000','#0673C3',"#00B024")) + scale_y_continuous(limits = c(-10,40),breaks=c(0,40))+geom_hline(yintercept = 0,linetype="dashed",size=0.2)

p.cfl.mv.coeff.summary.14

```



```{r fig.width=1,fig.height=1}
coeff.mat.rating.total$catChoiceCondition <- relevel(factor(coeff.mat.rating.total$catChoiceCondition),'XOR')
p.cfl.vd.coeff.summary.14 <-ggplot(coeff.mat.rating.total %>% filter(study %in% c('Study 12','Study DDL')),aes(x = study,y=beta_VD,group=catChoiceCondition,color=color)) + geom_point(position = position_dodge(0.5),size=1) + geom_errorbar(position=position_dodge(0.5),aes(ymin=beta_VD-se_VD,ymax=beta_VD+se_VD,color=color),width=0.1) + theme_bw(12) + theme(panel.border = element_blank(), panel.grid.major = element_blank(), plot.title = element_text(hjust = 0.5,size=6),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",0.2),
        axis.ticks=element_line(colour='black',0.2)) + 
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + ylab('Effect of RV') + xlab('') + scale_x_discrete(labels=c('Inclusivity','Urgency')) + scale_color_manual(values=c('#B02000','#0673C3',"#00B024")) + scale_y_continuous(limits = c(-0.15,0.025),breaks=c(-0.15,0))+geom_hline(yintercept = 0,linetype="dashed",size=0.2)

p.cfl.vd.coeff.summary.14

```



```{r}
lay <- rbind(c(1,2),c(3,4))

plots <- list(p.rt.mv.coeff.summary.14,p.rt.vd.coeff.summary.14,
              p.cfl.mv.coeff.summary.14,p.cfl.vd.coeff.summary.14)

grobs <- list()
widths <- list()
heights <- list()

for (i in 1:length(plots)){
    grobs[[i]] <- ggplotGrob(plots[[i]])
    widths[[i]] <- grobs[[i]]$widths
    heights[[i]] <- grobs[[i]]$heights
    
}

maxwidth <- do.call(grid::unit.pmax, widths)
maxheight <- do.call(grid::unit.pmax,heights)

for (i in 1:length(grobs)){
     grobs[[i]]$heights <- as.list(maxheight)
     grobs[[i]]$widths <- as.list(maxwidth)
}

p<-grid.arrange(grobs = grobs, layout_matrix = lay,widths=unit(c(3.5,3.5), c("cm", "cm")),heights=unit(c(3.5,3.5),c('cm','cm')))

ggsave(filename = '../Figures/Figure8_V4.pdf',p,units = 'cm',width = 15,height = 15)
```



```{r}

poly.mv <- poly(df.total.ddl$scaledMeanValue,2)
df.total.ddl$mvL <- poly.mv[,1]
df.total.ddl$mvQ <- poly.mv[,2]

model.rating.direct <- lmerTest::lmer(conflict ~ catChoiceCondition * (mvL + mvQ) + catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * (mvL + mvQ) + catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.total.ddl)


```



```{r fig.width=1,fig.height=1}

eff_mv.cfl.ddl <- Effect(c("scaledMeanValue","catChoiceCondition"),
                   model.rating,
                   xlevels=list(scaledMeanValue=seq(quantile(df.total.ddl$scaledMeanValue,0.025),
                                                    quantile(df.total.ddl$scaledMeanValue,0.975),0.1)))
IA.mv.cfl.ddl <- as.data.frame(eff_mv.cfl.ddl)

IA.mv.cfl.ddl$catChoiceCondition <- relevel(IA.mv.cfl.ddl$catChoiceCondition,ref = '60')

p.eff.mv.cfl.ddl<-ggplot(data=IA.mv.cfl.ddl, aes(x=scaledMeanValue, y=fit,group=catChoiceCondition)) + 
  geom_line(size=0.5,aes(color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.mv.cfl.ddl, aes(x=scaledMeanValue, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab("Conflict") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), plot.title = element_text(hjust = 0.5,size=6),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6),strip.text.y = element_blank()) + 
  scale_fill_manual("",values=c('#0673C3','#B00024')) + 
  scale_color_manual("",values=c('#0673C3','#B00024')) + 
  coord_cartesian(ylim=c(1.5,3.5)) + scale_y_continuous(breaks = c(2,3))

p.eff.mv.cfl.ddl
```


```{r fig.width=1,fig.height=1}

eff_vd.cfl.ddl <- Effect(c("scaledValueDiff","catChoiceCondition"),
                   model.rating,
                   xlevels=list(scaledValueDiff=seq(quantile(df.total.ddl$scaledValueDiff,0.025),
                                                    quantile(df.total.ddl$scaledValueDiff,0.975),0.1)))
IA.vd.cfl.ddl <- as.data.frame(eff_vd.cfl.ddl)

IA.vd.cfl.ddl$catChoiceCondition <- relevel(IA.vd.cfl.ddl$catChoiceCondition,ref = '60')

p.eff.vd.cfl.ddl<-ggplot(data=IA.vd.cfl.ddl, aes(x=scaledValueDiff, y=fit,group=catChoiceCondition)) + 
  geom_line(size=0.5,aes(color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.vd.cfl.ddl, aes(x=scaledValueDiff, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Relative Value\n(z-scored)") + ylab("Conflict") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), plot.title = element_text(hjust = 0.5,size=6),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6),strip.text.y = element_blank()) + 
  scale_fill_manual("",values=c('#0673C3','#B00024')) + 
  scale_color_manual("",values=c('#0673C3','#B00024')) + 
  coord_cartesian(ylim=c(1.5,3.5)) + scale_y_continuous(breaks = c(2,3))

p.eff.vd.cfl.ddl
```




```{r}
marginalConflictVDEffect <- function(model,x) {
  
  coeffs.mv.1 <- summary(model)$coeff[,'Estimate']
  
  eff <- coeffs.mv.1['catChoiceCondition3-60'] + 
    coeffs.mv.1['catChoiceCondition3-60:scaledValueDiff']*x
  
  cov.mat <- vcov(model)
  
  eff.ci <-  1.96 * sqrt(cov.mat[2,2] + x^2 * cov.mat[9,9] +
                                 2 * x * cov.mat[2,9])
  
  eff.df<-data.frame(x=x,eff=eff,ci=eff.ci)
  
  return(eff.df)
}
```


```{r fig.width=1,fig.height=1}

new.vd.1 <- seq(quantile(df.total.ddl$scaledValueDiff,0.025),
                quantile(df.total.ddl$scaledValueDiff,0.975),0.1)

eff.df.vd.ddl <- marginalConflictVDEffect(model.rating,new.vd.1) %>%
  dplyr::mutate(scaledValueDiff=x,
                catChoiceCondition='3 - 60',
                fit= eff,
                upper= eff+ci,
                lower= eff-ci,
                se=NA,
                study='Study 3')

p.eff.cc.int.ddl<-ggplot(data=eff.df.vd.ddl, aes(x=x, y=fit)) + 
  geom_line(size=0.5)+theme_bw(12) +
  geom_ribbon(data=eff.df.vd.ddl, aes(x=x, max = upper, min = lower),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Relative Value\n(z-scored)") + ylab('Effect of Urgency') +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), plot.title = element_text(hjust = 0.5,size=6),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        strip.text.y = element_blank()) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  scale_fill_manual("",values=c("#005555","#550055")) + scale_color_manual("",values=c("#005555","#550055")) + # ggtitle('Exclusive - Non-Exclusive')#  +
  coord_cartesian(ylim=c(-.15,0.5)) + scale_y_continuous(breaks = c(0,0.5))

p.eff.cc.int.ddl


```

```{r}
tab_model(model.RT,model.acc,pred.labels = c("Intercept","High - Low Urgency","Overall Value","Relative Value","Trial Order","Urgency by OV","Urgency by RV"),dv.labels = c('RT','Accuracy'),show.re.var = F,show.icc=F,show.ngroups = F,show.obs = F,show.r2 = F,show.stat = T,transform = NULL)


```


```{r}
tab_model(model.rating,pred.labels = c("Intercept","High - Low Urgency","Overall Value","Overall Value^2","Relative Value","Trial Order","Urgency by OV","Urgency by OV^2","Urgency by RV"),dv.labels = c('Conflict'),show.re.var = F,show.icc=F,show.ngroups = F,show.obs = F,show.r2 = F,show.stat = T)


```


```{r}
tab_model(model.logRT.gi,model.acc.gi,pred.labels = c("Intercept","Inclusivity","Overall Value","Relative Value","Trial Order","Incl by OV","Incl by RV"),dv.labels = c('RT','Accuracy'),show.re.var = F,show.icc=F,show.ngroups = F,show.obs = F,show.r2 = F,show.stat = T,transform = NULL)


```


```{r}
tab_model(model.conflict.gi,pred.labels = c("Intercept","Inclusivity","Overall Value","Overall Value^2","Relative Value","Trial Order","Incl by OV","Incl by OV^2","Incl by RV"),dv.labels = c('Conflict'),show.re.var = F,show.icc=F,show.ngroups = F,show.obs = F,show.r2 = F,show.stat = T)


```



```{r}
tab_model(model.FRT.cfl,model.acc.cfl,pred.labels = c("Intercept","Inclusivity","Overall Value","Relative Value","Trial Order","Incl by OV","Incl by RV"),dv.labels = c('RT','Accuracy'),show.re.var = F,show.icc=F,show.ngroups = F,show.obs = F,show.r2 = F,show.stat = T,transform = NULL)


```


```{r}
tab_model(model.rating.cfl,pred.labels = c("Intercept","Inclusivity","Overall Value","Overall Value^2","Relative Value","Trial Order","Incl by OV","Incl by OV^2","Incl by RV"),dv.labels = c('Conflict'),show.re.var = F,show.icc=F,show.ngroups = F,show.obs = F,show.r2 = F,show.stat = T)


```



```{r}
coeff.rt <- t(fixef(model.RT)['catChoiceCondition3-60'])
df.ci <- confint(model.RT,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.rt <- df.ci['catChoiceCondition3-60',]
estimate.rt <- cbind(coeff.rt,t(ci.rt))
colnames(estimate.rt)<-c('coeff','lower','upper')

coeff.acc <- t(fixef(model.acc.dummy)['catChoiceCondition3-60'])
df.ci <- confint(model.acc.dummy,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.acc <- df.ci['catChoiceCondition3-60',]
estimate.acc <- cbind(coeff.acc,t(ci.acc))
colnames(estimate.acc)<-c('coeff','lower','upper')

coeff.rr <- t(fixef(model.rr)['catChoiceCondition3-60'])
df.ci <- confint(model.rr,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.rr <- df.ci['catChoiceCondition3-60',]
estimate.rr <- cbind(coeff.rr,t(ci.rr))
colnames(estimate.rr)<-c('coeff','lower','upper')

coeff.conf <- t(fixef(model.rating)['catChoiceCondition3-60'])
df.ci <- confint(model.rating,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.conf <- df.ci['catChoiceCondition3-60',]
estimate.conf <- cbind(coeff.conf,t(ci.conf))
colnames(estimate.conf)<-c('coeff','lower','upper')

estimate.all <- data.frame(rbind(estimate.rt,estimate.acc,estimate.rr,estimate.conf))
estimate.all$var <- c('RT','Acc','RR','Conflict')
```


```{r,fig.width=2,fig.height=2}
p.diff.acc.ddl <- ggplot(estimate.all %>% filter(var %in% c('Acc')), aes(x=var, y=coeff))  + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  geom_point(stat="identity", position=position_dodge(0.6),size=0.5) +
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.1,size=0.4,
                 position=position_dodge(.6))+labs(x="", y = "Effect of Urgency")+theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        text=element_text(size=6),legend.position="none") +
  scale_x_discrete(labels=c("Acc"='P(Best First)')) + scale_y_continuous(limits = c(-0.1,0.01),breaks = c(-0.1,0))

p.diff.acc.ddl

```


```{r fig.height=2,fig.width=2}
p.diff.rt.ddl <- ggplot(estimate.all %>% filter(var %in% c('RT')), aes(x=var, y=coeff))  + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  geom_point(stat="identity", position=position_dodge(0.6),size=0.5) +
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.1,size=0.4,
                 position=position_dodge(.6))+labs(x="", y = "Effect of Urgency\n(sec)")+theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        text=element_text(size=6),legend.position="none") +
  scale_x_discrete(labels=c("RT"='RT')) + scale_y_continuous(limits = c(-2,0.2),breaks = c(-2,0))

p.diff.rt.ddl
```




```{r fig.height=2,fig.width=2}
p.diff.rr.ddl <- ggplot(estimate.all %>% filter(var %in% c('RR')), aes(x=var, y=coeff))  + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  geom_point(stat="identity", position=position_dodge(0.6),size=0.5) +
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.1,size=0.4,
                 position=position_dodge(.6))+labs(x="", y = "Effect of Urgency\n(Unit Value/sec)")+theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        text=element_text(size=6),legend.position="none") +
  scale_x_discrete(labels=c("RR"='Reward Rate')) + scale_y_continuous(limits = c(-0.2,2),breaks = c(0,2))

p.diff.rr.ddl
```


```{r fig.height=2,fig.width=2}
p.diff.conflict.ddl <- ggplot(estimate.all %>% filter(var %in% c('Conflict')), aes(x=var, y=coeff))  + geom_hline(yintercept=0,color='#555555') + 
  geom_point(stat="identity", position=position_dodge(0.6),size=0.5) +
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.1,size=0.4,
                 position=position_dodge(.6))+labs(x="", y = "Effect of Urgency")+theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        text=element_text(size=6),legend.position="none") +
  scale_x_discrete(labels=c("Conflict"='Conflict')) + scale_y_continuous(limits = c(-0.2,0.2),breaks = c(-0.2,0,0.2))
p.diff.conflict.ddl
```



```{r fig.width=1, fig.height=1}
eff_mv.RT.ddl <- Effect(c("scaledMeanValue","catChoiceCondition"),
                   model.RT,
                   xlevels=list(scaledMeanValue=seq(quantile(df.total.rt.ddl$scaledMeanValue,0.025),
                                                    quantile(df.total.rt.ddl$scaledMeanValue,0.975),0.1)))
IA.mv.RT.ddl <- as.data.frame(eff_mv.RT.ddl) %>% dplyr::mutate(study='Study 3')

p.eff.mv.rt.ddl<-ggplot(data=IA.mv.RT.ddl, aes(x=scaledMeanValue, y=fit, group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.mv.RT.ddl, aes(x=scaledMeanValue, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab("RT (sec)") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#B00024')) + 
  scale_color_manual("",values=c('#0673C3','#B00024')) + 
  coord_cartesian(ylim=c(1,4)) + scale_y_continuous(breaks = c(1,4))

p.eff.mv.rt.ddl
```


```{r fig.width=1, fig.height=1}
eff_vd.RT.ddl <- Effect(c("scaledValueDiff","catChoiceCondition"),
                   model.RT,
                   xlevels=list(scaledValueDiff=seq(quantile(df.total.rt.ddl$scaledValueDiff,0.025),
                                                    quantile(df.total.rt.ddl$scaledValueDiff,0.975),0.1)))
IA.vd.RT.ddl <- as.data.frame(eff_vd.RT.ddl) %>% dplyr::mutate(study='Study 3')

p.eff.vd.rt.ddl <-ggplot(data=IA.vd.RT.ddl, aes(x=scaledValueDiff, y=fit, group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.vd.RT.ddl, aes(x=scaledValueDiff, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Relative Value\n(z-scored)") + ylab("RT (sec)") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#B00024')) + 
  scale_color_manual("",values=c('#0673C3','#B00024')) + 
  coord_cartesian(ylim=c(1,4)) + scale_y_continuous(breaks = c(1,4))

p.eff.vd.rt.ddl
```





```{r fig.width=1,fig.height=1}

eff_mv.acc.ddl <- Effect(c("scaledMeanValue","catChoiceCondition"),
                   model.acc,
                   xlevels=list(scaledMeanValue=seq(quantile(df.total.rt.ddl$scaledMeanValue,0.025),
                                                    quantile(df.total.rt.ddl$scaledMeanValue,0.972),0.1)))
IA.mv.acc.ddl <- as.data.frame(eff_mv.acc.ddl) %>% dplyr::mutate(study='Study 3')

p.eff.mv.acc.ddl <-ggplot(data=IA.mv.acc.ddl, aes(x=scaledMeanValue, y=fit, group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.mv.acc.ddl, aes(x=scaledMeanValue, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab("P(Best First)") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#B00024')) + 
  scale_color_manual("",values=c('#0673C3','#B00024')) + 
  coord_cartesian(ylim=c(0.1,0.9)) + scale_y_continuous(breaks = c(0.1,0.9),labels=function(x) sprintf("%.1f", x))

p.eff.mv.acc.ddl
#ggsave('Study12_RT.pdf')
```



```{r fig.width=1,fig.height=1}

eff_vd.acc.ddl <- Effect(c("scaledValueDiff","catChoiceCondition"),
                   model.acc,
                   xlevels=list(scaledValueDiff=seq(quantile(df.total.rt.ddl$scaledValueDiff,0.025),
                                                    quantile(df.total.rt.ddl$scaledValueDiff,0.975),0.1)))
IA.vd.acc.ddl <- as.data.frame(eff_vd.acc.ddl) %>% dplyr::mutate(study='Study 3')

p.eff.vd.acc.ddl<-ggplot(data=IA.vd.acc.ddl, aes(x=scaledValueDiff, y=fit, group=catChoiceCondition)) +
  geom_line(size=0.5,aes(linetype=study,color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.vd.acc.ddl, aes(x=scaledValueDiff, max = upper, min = lower,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Relative Value\n(z-scored)") + ylab("P(Best First)") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + 
  scale_fill_manual("",values=c('#0673C3','#B00024')) + 
  scale_color_manual("",values=c('#0673C3','#B00024')) + 
  coord_cartesian(ylim=c(0.1,0.9)) + scale_y_continuous(breaks = c(0.1,0.9),labels=function(x) sprintf("%.1f", x))

p.eff.vd.acc.ddl
#ggsave('Study12_RT.pdf')
```



```{r}
lay <- rbind(c(1, 4, 4, 4, 7),
             c(2, 2, NA,3, 3),
             c(5, 5, NA,6, 6))

plots <- list(p.diff.rt.ddl,p.eff.mv.rt.ddl,p.eff.vd.rt.ddl,
              p.diff.acc.ddl,p.eff.mv.acc.ddl,p.eff.vd.acc.ddl,p.diff.rr.ddl)
grobs <- list()
widths <- list()
heights <- list()

for (i in 1:length(plots)){
    grobs[[i]] <- ggplotGrob(plots[[i]])
    widths[[i]] <- grobs[[i]]$widths
    heights[[i]] <- grobs[[i]]$heights
}

maxwidth <- do.call(grid::unit.pmax, widths)
maxheight <- do.call(grid::unit.pmax,heights)

for (i in c(2,3,5,6)){
     grobs[[i]]$widths <- as.list(maxwidth)
}

for (i in 1:length(grobs)){
     grobs[[i]]$heights <- as.list(maxheight)
}

widths <- list()

for (i in c(1,4,7)){
    widths[[i]] <- grobs[[i]]$widths
}

maxwidth <- do.call(grid::unit.pmax,widths)

for (i in c(1,4,7)){
     grobs[[i]]$widths <- as.list(maxwidth)
}

p<-grid.arrange(grobs = grobs, layout_matrix = lay,widths=unit(c(2.1,0.9,0.2,0.9,2.1), c("cm", "cm")),heights=unit(c(3,3,3),c('cm','cm')))

ggsave(filename = '../Figures/FigureS5_V2.pdf',p,units = 'cm',width = 10,height = 15)
```


```{r}
lay <- rbind(c(1,NA,2,NA,3,NA,4))

plots <- list(p.diff.conflict.ddl,p.eff.mv.cfl.ddl,p.eff.vd.cfl.ddl,p.eff.cc.int.ddl)
grobs <- list()
widths <- list()
heights <- list()

for (i in 1:length(plots)){
    grobs[[i]] <- ggplotGrob(plots[[i]])
    widths[[i]] <- grobs[[i]]$widths
    heights[[i]] <- grobs[[i]]$heights
}

maxwidth <- do.call(grid::unit.pmax, widths)
maxheight <- do.call(grid::unit.pmax, heights)

for (i in 1:length(grobs)){
  grobs[[i]]$widths <- as.list(maxwidth)
  grobs[[i]]$heights <- as.list(maxheight)
}

p<-grid.arrange(grobs = grobs, layout_matrix = lay,widths=unit(c(2.1,0.1,2.7,0.1,2.7,0.1,2.7), c("cm", "cm")),heights=unit(c(3),c('cm','cm')))

ggsave(filename = '../Figures/FigureS6_V2.pdf',p,units = 'cm',width = 25,height = 12)
```


```{r}
df.orxorg <- read.csv('../Data/Study5/Study5a/Study5a_1.csv')
df.orxorg.rating <- read.csv('../Data/Study5/Study5a/Study5a_2.csv')

# df.orxorg.rt <- read.csv('Study5a/resp1.csv')

df.orxori <- read.csv('../Data/Study5/Study5b/Study5b_1.csv')
df.orxorg.rating <- read.csv('../Data/Study5/Study5b/Study5b_2.csv')

# df.orxori.rt <- read.csv('Study5b/resp2.csv')

```


```{r}
df.orxorgi <- rbind(df.orxorg %>% select(participant,firstRT,isBestFirst,meanValue,valueDiff,choiceCondition,trialNGlobal,conflict),
                    df.orxori %>% select(participant,firstRT,isBestFirst,meanValue,valueDiff,choiceCondition,trialNGlobal,conflict)) %>%
  mutate(scaledMeanValue=scale(meanValue),
         scaledValueDiff=scale(valueDiff),
         scaledTrialNum=scale(trialNGlobal),
         catChoiceCondition=relevel(factor(choiceCondition,labels = c('OR','XOR')),ref = 'XOR'))

contrasts(df.orxorgi$catChoiceCondition) <- MASS::contr.sdif
```


```{r}
df.orxorgi.rt <- rbind(df.orxorg %>% filter(firstRT>0.1) %>% select(participant,firstRT,isBestFirst,meanValue,valueDiff,choiceCondition,trialNGlobal,conflict),
                       df.orxori %>% filter(firstRT>0.1) %>% select(participant,firstRT,isBestFirst,meanValue,valueDiff,choiceCondition,trialNGlobal,conflict)) %>%
  mutate(scaledMeanValue=scale(meanValue),
         scaledValueDiff=scale(valueDiff),
         scaledTrialNum=scale(trialNGlobal),
         catChoiceCondition=relevel(factor(choiceCondition,labels = c('OR','XOR')),ref = 'XOR'))

contrasts(df.orxorgi.rt$catChoiceCondition) <- MASS::contr.sdif
```


```{r}
model.logRT.gi <- lmer(log10(firstRT) ~ catChoiceCondition * (scaledMeanValue + scaledValueDiff) + scaledTrialNum + (1 + catChoiceCondition * (scaledMeanValue + scaledValueDiff) + scaledTrialNum|participant),data=df.orxorgi.rt)

model.acc.gi <- glmer(isBestFirst ~ catChoiceCondition * (scaledMeanValue + scaledValueDiff) + scaledTrialNum + (1 + catChoiceCondition * (scaledMeanValue + scaledValueDiff) + scaledTrialNum|participant),data=df.orxorgi.rt,family = binomial())

model.conflict.gi <- lmer(conflict ~ catChoiceCondition * (poly(scaledMeanValue,2) + scaledValueDiff) + scaledTrialNum + (1 + catChoiceCondition * (poly(scaledMeanValue,2) + scaledValueDiff) + scaledTrialNum|participant),data=df.orxorgi)
```





```{r}
df.orxori.total <- df.orxori %>% select(participant,firstRT,isBestFirst,meanValue,valueDiff,choiceCondition,trialNGlobal,conflict) %>%
  mutate(scaledMeanValue=scale(meanValue),
         scaledValueDiff=scale(valueDiff),
         scaledTrialNum=scale(trialNGlobal),
         catChoiceCondition=relevel(factor(choiceCondition,labels = c('OR','XOR')),ref = 'XOR'))

contrasts(df.orxori.total$catChoiceCondition) <- MASS::contr.sdif
```



```{r}
df.orxori.rt <- df.orxori.total %>% filter(firstRT>0.1) %>% select(participant,firstRT,isBestFirst,meanValue,valueDiff,choiceCondition,trialNGlobal,conflict) %>%
  mutate(scaledMeanValue=scale(meanValue),
         scaledValueDiff=scale(valueDiff),
         scaledTrialNum=scale(trialNGlobal),
         catChoiceCondition=relevel(factor(choiceCondition,labels = c('OR','XOR')),ref = 'XOR'))

contrasts(df.orxori.rt$catChoiceCondition) <- MASS::contr.sdif
```


```{r}
model.logRT.i <- lmer(log10(firstRT) ~ catChoiceCondition * (scaledMeanValue + scaledValueDiff) + scaledTrialNum + (1 + catChoiceCondition * (scaledMeanValue + scaledValueDiff) + scaledTrialNum|participant),data=df.orxori.rt)

model.acc.i <- glmer(isBestFirst ~ catChoiceCondition * (scaledMeanValue + scaledValueDiff) + scaledTrialNum + (1 + catChoiceCondition * (scaledMeanValue + scaledValueDiff) + scaledTrialNum|participant),data=df.orxori.rt,family = binomial())

model.conflict.i <- lmer(conflict ~ catChoiceCondition * (poly(scaledMeanValue,2) + scaledValueDiff) + scaledTrialNum + (1 + catChoiceCondition * (poly(scaledMeanValue,2) + scaledValueDiff) + scaledTrialNum|participant),data=df.orxori.total)
```




```{r fig.width=1,fig.height=1}

new.mv <- seq(quantile(df.orxorgi$scaledMeanValue,0.025),
              quantile(df.orxorgi$scaledMeanValue,0.975),0.1)

eff.df.mv.gi <- marginalConflictMVEffect(model.conflict.gi,df.orxorgi$scaledMeanValue,new.mv) %>%
  dplyr::mutate(scaledMeanValue=x,
                catChoiceCondition='XOR - OR',
                fit= eff,
                upper= eff+ci,
                lower= eff-ci,
                se=NA,
                study='Study 3')

p.eff.cc.int.gi<-ggplot(data=eff.df.mv.gi, aes(x=x, y=fit)) + 
  geom_line(size=0.5)+theme_bw(12) +
  geom_ribbon(data=eff.df.mv.gi, aes(x=x, max = upper, min = lower),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab('Effect of Inclusivity') +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), plot.title = element_text(hjust = 0.5,size=6),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        strip.text.y = element_blank()) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  scale_fill_manual("",values=c("#005555","#550055")) + scale_color_manual("",values=c("#005555","#550055")) + # ggtitle('Exclusive - Non-Exclusive') +
  coord_cartesian(ylim=c(-1,0.3)) + scale_y_continuous(breaks = c(-1,0))

p.eff.cc.int.gi

ggsave(filename = '../Figures/FigureS11B.pdf',p.eff.cc.int.gi,units = 'cm',width = 3,height = 3)

```




```{r fig.width=1,fig.height=1}

new.mv <- seq(quantile(df.orxori.total$scaledMeanValue,0.025),
              quantile(df.orxori.total$scaledMeanValue,0.975),0.1)

eff.df.mv.i <- marginalConflictMVEffect(model.conflict.i,df.orxori.total$scaledMeanValue,new.mv) %>%
  dplyr::mutate(scaledMeanValue=x,
                catChoiceCondition='XOR - OR',
                fit= eff,
                upper= eff+ci,
                lower= eff-ci,
                se=NA,
                study='Study 3')

p.eff.cc.int.i<-ggplot(data=eff.df.mv.i, aes(x=x, y=fit)) + 
  geom_line(size=0.5)+theme_bw(12) +
  geom_ribbon(data=eff.df.mv.i, aes(x=x, max = upper, min = lower),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab('Effect of Inclusivity') +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), plot.title = element_text(hjust = 0.5,size=6),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        strip.text.y = element_blank()) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + geom_hline(yintercept=0,color='#555555',size=0.2) + 
  scale_fill_manual("",values=c("#005555","#550055")) + scale_color_manual("",values=c("#005555","#550055")) + # ggtitle('Exclusive - Non-Exclusive') +
  coord_cartesian(ylim=c(-1,0.3)) + scale_y_continuous(breaks = c(-1,0))

p.eff.cc.int.i

ggsave(filename = '../Figures/FigureS12B.pdf',p.eff.cc.int.i,units = 'cm',width = 3,height = 3)
```




```{r}
coeff.rt.ns <- fixef(model.logRT.gi)[c('catChoiceConditionOR-XOR','catChoiceConditionOR-XOR:scaledMeanValue','catChoiceConditionOR-XOR:scaledValueDiff')]
df.ci <- confint(model.logRT.gi,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.rt <- df.ci[c('catChoiceConditionOR-XOR','catChoiceConditionOR-XOR:scaledMeanValue','catChoiceConditionOR-XOR:scaledValueDiff'),]
estimate.rt.gi <- t(rbind(coeff.rt.ns,t(ci.rt)))
colnames(estimate.rt.gi)<-c('coeff','lower','upper')
rownames(estimate.rt.gi) <- NULL
estimate.rt.gi <- data.frame(estimate.rt.gi)
estimate.rt.gi$params <- c('Incl - Excl','(Incl - Excl) X OV','(Incl - Excl) X RV')
estimate.rt.gi$dv <- 'RT'
```


```{r fig.width=4,fig.height=2}
p.summary.gi.rt <- ggplot(estimate.rt.gi,aes(x=params,y=coeff)) + geom_hline(yintercept=0,color='#AAAAAA',size=0.2) + geom_point(position = position_dodge(0.6),size=0.5) + geom_errorbar(position = position_dodge(0.6),aes(ymin=lower,ymax=upper),width=0.2) + coord_flip() + theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        text=element_text(size=6),legend.position="none") + scale_y_continuous(limits = c(-0.04,0.04),breaks = c(-0.04,0,0.04)) + xlab('') + ylab('') + scale_x_discrete(labels=c('Incl - Excl'='On intercept','(Incl - Excl) X OV'='On overall value effect','(Incl - Excl) X RV'='On relative value effect'))
p.summary.gi.rt

ggsave(filename = '../Figures/FigureS11A.pdf',p.summary.gi.rt,units = 'cm',width = 4.8,height = 3)
```


```{r}
coeff.rt.ns <- fixef(model.logRT.i)[c('catChoiceConditionOR-XOR','catChoiceConditionOR-XOR:scaledMeanValue','catChoiceConditionOR-XOR:scaledValueDiff')]
df.ci <- confint(model.logRT.i,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.rt <- df.ci[c('catChoiceConditionOR-XOR','catChoiceConditionOR-XOR:scaledMeanValue','catChoiceConditionOR-XOR:scaledValueDiff'),]
estimate.rt.i <- t(rbind(coeff.rt.ns,t(ci.rt)))
colnames(estimate.rt.i)<-c('coeff','lower','upper')
rownames(estimate.rt.i) <- NULL
estimate.rt.i <- data.frame(estimate.rt.i)
estimate.rt.i$params <- c('Incl - Excl','(Incl - Excl) X OV','(Incl - Excl) X RV')
estimate.rt.i$dv <- 'RT'
```





```{r fig.width=4,fig.height=2}
p.summary.i.rt <- ggplot(estimate.rt.i,aes(x=params,y=coeff)) + geom_hline(yintercept=0,color='#AAAAAA',size=0.2) + geom_point(position = position_dodge(0.6),size=0.5) + geom_errorbar(position = position_dodge(0.6),aes(ymin=lower,ymax=upper),width=0.2) + coord_flip() + theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        text=element_text(size=6),legend.position="none") + scale_y_continuous(limits = c(-0.04,0.04),breaks = c(-0.04,0,0.04)) + xlab('') + ylab('') + scale_x_discrete(labels=c('Incl - Excl'='On intercept','(Incl - Excl) X OV'='On overall value effect','(Incl - Excl) X RV'='On relative value effect'))
p.summary.i.rt

ggsave(filename = '../Figures/FigureS12A.pdf',p.summary.i.rt,units = 'cm',width = 4.8,height = 3)
```



```{r}
library(kableExtra)
kbl(car::Anova(model.logRT.gi,type="3"),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria",)
kbl(car::Anova(model.acc.gi,type="3"),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
kbl(car::Anova(model.conflict.gi,type="3"),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
```





```{r}
library(kableExtra)
kbl(list(car::Anova(model.logRT.i,type="3"),car::Anova(model.logRT.i,type="3")),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
kbl(car::Anova(model.acc.i,type="3"),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
kbl(car::Anova(model.conflict.i,type="3"),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
```


```{r}
kbl(merge(data.frame(car::Anova(model.RT.12,type="3")),data.frame(car::Anova(model.acc.12,type="3")),by=0,sort = FALSE),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
kbl(car::Anova(model.conflict.12,type='3'),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
kbl(merge(data.frame(car::Anova(model.RT.3,type="3")),data.frame(car::Anova(model.acc.3,type="3")),by=0,sort = FALSE),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
kbl(car::Anova(model.conflict.3,type='3'),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
kbl(merge(data.frame(car::Anova(model.RT.ns,type="3")),data.frame(car::Anova(model.acc.ns,type="3")),by=0,sort = FALSE),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
kbl(car::Anova(model.rating.ns,type='3'),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
kbl(merge(data.frame(car::Anova(model.RT.nd,type="3")),data.frame(car::Anova(model.acc.nd,type="3")),by=0,sort = FALSE),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
kbl(car::Anova(model.rating.nd,type='3'),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
kbl(merge(data.frame(car::Anova(model.RT,type="3")),data.frame(car::Anova(model.acc,type="3")),by=0,sort = FALSE),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
kbl(car::Anova(model.rating,type='3'),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")

kbl(merge(merge(data.frame(car::Anova(model.logRT.gi,type="3")),data.frame(car::Anova(model.acc.gi,type="3")),by=0,sort = FALSE),
          merge(data.frame(car::Anova(model.logRT.i,type="3")),data.frame(car::Anova(model.acc.i,type="3")),by=0,sort = FALSE),by=0,sort=F
          ),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")


kbl(merge(data.frame(car::Anova(model.conflict.gi,type="3")),
          data.frame(car::Anova(model.conflict.i,type="3")),by=0,sort=F
          ),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")

kbl(merge(data.frame(car::Anova(model.FRT.cfl,type="3")),data.frame(car::Anova(model.acc.cfl,type="3")),by=0,sort = FALSE),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
kbl(car::Anova(model.rating.cfl,type='3'),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")


kbl(merge(data.frame(car::Anova(model.N.s.combined.01.poly,type="III")),
          data.frame(car::Anova(model.N.d.combined.01.poly,type="III")),by=0,sort = F),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
kbl(merge(data.frame(car::Anova(model.nuf.s.combined.ni.01.poly,type="III")),
          data.frame(car::Anova(model.nuf.d.combined.ni.01.poly,type="III")),by=0,sort = F),digits = 3) %>%
  kable_classic(full_width = F, html_font = "Cambria")
```


# Study 6

```{r}

df.rating.6 <- read.csv('../Data/Study6/Study6_2.csv')

df.total.cfl.6 <- read.csv('../Data/Study6/Study6_1.csv') %>%
  mutate(catChoiceCondition=factor(choiceCondition,labels = c('OR','XOR'))) %>%
  mutate(isBestFirst=firstValue==bestValue) %>%
  mutate(scaledTrialNum=scale(trialNGlobal),
         scaledVarValue=scale(varValue),
         scaledValueDiff2=scale(bestValue-worstValue),
         scaledMeanValue=scale(meanValue),
         scaledValueDiff=scale(valueDiff))

df.total.rt.cfl.6 <- df.total.cfl.6 %>% filter(firstRT>0.1) %>%
  mutate(scaledTrialNum=scale(trialNGlobal),
         scaledMeanValue=scale(meanValue),
         scaledVarValue=scale(varValue),
         scaledValueDiff=scale(valueDiff),
         scaledRT=scale(firstRT),
         catAcc=factor(isBestFirst))
contrasts(df.total.rt.cfl.6$catAcc)<-contr.sum
df.total.rt.cfl.6$catChoiceCondition<-relevel(df.total.rt.cfl.6$catChoiceCondition,'XOR')
df.total.cfl.6$catChoiceCondition<-relevel(df.total.cfl.6$catChoiceCondition,'XOR')
contrasts(df.total.rt.cfl.6$catChoiceCondition)<-MASS::contr.sdif
contrasts(df.total.cfl.6$catChoiceCondition)<-MASS::contr.sdif
```



```{r}
model.FRT.cfl <- lmerTest::lmer(log10(firstRT) ~ catChoiceCondition * (scaledMeanValue + scaledValueDiff) + scaledTrialNum + (1 + catChoiceCondition * (scaledMeanValue + scaledValueDiff) + scaledTrialNum|participant),data=df.total.rt.cfl.6,control=lmerControl(optCtrl=list(maxfun=50000) ))

model.acc.cfl <- glmer(isBestFirst ~ catChoiceCondition * scaledMeanValue +  catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * scaledMeanValue +  catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.total.rt.cfl.6,family = binomial)

model.rating.cfl <- lmerTest::lmer(conflict ~ catChoiceCondition * (poly(scaledMeanValue,2) + scaledValueDiff) + scaledTrialNum + (1 + catChoiceCondition * (poly(scaledMeanValue,2) + scaledValueDiff) + scaledTrialNum|participant),data=df.total.rt.cfl.6,control=lmerControl(optCtrl=list(maxfun=100000)))
```



```{r}
coeff.rt.ns <- fixef(model.FRT.cfl)[c('catChoiceConditionOR-XOR','catChoiceConditionOR-XOR:scaledMeanValue','catChoiceConditionOR-XOR:scaledValueDiff')]
df.ci <- confint(model.FRT.cfl,method="Wald")
df.ci <- df.ci[!is.na(df.ci[,1]),]
ci.rt <- df.ci[c('catChoiceConditionOR-XOR','catChoiceConditionOR-XOR:scaledMeanValue','catChoiceConditionOR-XOR:scaledValueDiff'),]
estimate.rt.i <- t(rbind(coeff.rt.ns,t(ci.rt)))
colnames(estimate.rt.i)<-c('coeff','lower','upper')
rownames(estimate.rt.i) <- NULL
estimate.rt.i <- data.frame(estimate.rt.i)
estimate.rt.i$params <- c('Incl - Excl','(Incl - Excl) X OV','(Incl - Excl) X RV')
estimate.rt.i$dv <- 'RT'
```





```{r fig.width=4,fig.height=2}
p.summary.i.rt <- ggplot(estimate.rt.i,aes(x=params,y=coeff)) + geom_hline(yintercept=0,color='#AAAAAA',size=0.2) + geom_point(position = position_dodge(0.6),size=0.5) + geom_errorbar(position = position_dodge(0.6),aes(ymin=lower,ymax=upper),width=0.2) + coord_flip() + theme_bw(12) + 
  theme(panel.border = element_blank(),panel.grid.major = element_blank(),
        axis.title.x = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0)),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2),
        text=element_text(size=6),legend.position="none") + scale_y_continuous(limits = c(-0.04,0.04),breaks = c(-0.04,0,0.04)) + xlab('') + ylab('') + scale_x_discrete(labels=c('Incl - Excl'='On intercept','(Incl - Excl) X OV'='On overall value effect','(Incl - Excl) X RV'='On relative value effect'))
p.summary.i.rt

ggsave(filename = '../Figures/FigureS2A.pdf',p.summary.i.rt,units = 'cm',width = 4.8,height = 3)
```


```{r acc_plot.good,fig.width=1,fig.height=1}

eff_mv.acc.3 <- Effect(c("scaledMeanValue","catChoiceCondition"),
                   model.rating.cfl,
                   xlevels=list(scaledMeanValue=seq(quantile(df.total.rt.cfl.6$scaledMeanValue,0.025),
                                                    quantile(df.total.rt.cfl.6$scaledMeanValue,0.975),0.1)
                                ))
IA.mv.acc.3 <- as.data.frame(eff_mv.acc.3) %>% dplyr::mutate(study='Study 3')

p.eff.mv.acc.3 <-ggplot(data=IA.mv.acc.3, aes(x=scaledMeanValue, y=fit, group=catChoiceCondition)) + 
  geom_line(size=0.5,aes(color=catChoiceCondition))+theme_bw(12) +
  geom_ribbon(data=IA.mv.acc.3, aes(x=scaledMeanValue, max = lower, min = upper,fill=catChoiceCondition),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab("Conflict") + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),
        axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(text = element_text(size=6),legend.position = 'none') + 
  scale_fill_manual("",values=c('#0673C3','#00B024')) + 
  scale_color_manual("",values=c('#0673C3','#00B024'))

p.eff.mv.acc.3
ggsave(filename = '../Figures/FigureS2B.pdf',p.eff.mv.acc.3,units = 'cm',width = 3,height = 3)
```


```{r}
marginalConflictMVEffect <- function(model,x,newx) {
  poly.base <- poly(x,2)
  
  new_poly <- predict(poly.base,newx)
  
  coeffs.mv.1 <- summary(model)$coeff[,'Estimate']
  
  eff <- coeffs.mv.1['catChoiceConditionOR-XOR'] + 
    coeffs.mv.1['catChoiceConditionOR-XOR:poly(scaledMeanValue, 2)1']*new_poly[,1] + 
    coeffs.mv.1['catChoiceConditionOR-XOR:poly(scaledMeanValue, 2)2']*new_poly[,2]
  
  cov.mat <- vcov(model)
  
  eff.ci <- 1.96 * sqrt(cov.mat[2,2] + new_poly[,1]^2 * cov.mat[7,7] + new_poly[,2]^2 * cov.mat[8,8] + 
                                 2 * new_poly[,1] * cov.mat[2,7] + 2 * new_poly[,2] * cov.mat[2,8] + 
                                 2 * new_poly[,1] * new_poly[,2] * cov.mat[7,8])
  
  eff.df<-data.frame(x=newx,eff=eff,ci=eff.ci)
  
  return(eff.df)
}



```


```{r fig.width=2,fig.height=2}
new.mv.1 <- seq(quantile(df.total.rt.cfl.6$scaledMeanValue,0.025),
                quantile(df.total.rt.cfl.6$scaledMeanValue,0.975),0.1)

eff.df.mv.12 <- marginalConflictMVEffect(model.rating.cfl,
                                         df.total.rt.cfl.6$scaledMeanValue,
                                         new.mv.1) %>%
  dplyr::mutate(scaledMeanValue=x,
                catChoiceCondition='XOR - OR',
                fit=eff,
                upper=eff+ci,
                lower=eff-ci,
                se=NA,
                study='Study 12')

p.eff.cc.int.12<-ggplot(data=eff.df.mv.12, aes(x=x, y=fit)) + 
  geom_line(size=0.5)+theme_bw(12) +
  geom_ribbon(data=eff.df.mv.12, aes(x=x, max = upper, min = lower),alpha=0.3, inherit.aes = FALSE)+ 
  xlab("Overall Value\n(z-scored)") + ylab('Effect of Inclusivity') +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), plot.title = element_text(hjust = 0.5,size=6),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black",size=0.2),strip.text.y = element_blank(),
        axis.ticks = element_line(colour = "black",size=0.2)) +
  theme(legend.justification=c(1,1),legend.position='none',text = element_text(size=6)) + geom_hline(yintercept=0,color='#555555',size=0.2) + #ggtitle('Conflict') +
  coord_cartesian(ylim=c(-1,0.1)) + scale_y_continuous(breaks = c(-1,0))

p.eff.cc.int.12

ggsave(filename = '../Figures/FigureS2C.pdf',p.eff.cc.int.12,units = 'cm',width = 3,height = 3)

```

```{r}
df.12.1 <- df.total.rt.12 %>% filter(NChosen==1) %>% mutate(scaledMeanValue=scale(meanValue),
                                                            scaledValueDiff=scale(valueDiff),
                                                            scaledTrialNum=scale(trialN))


model.conflict.12.n1 <- lmerTest::lmer(conflict ~ catChoiceCondition * poly(scaledMeanValue,2) + catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * poly(scaledMeanValue,2) + catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.12.1)



```


```{r}
df.ns.1 <- df.total.rt.new.s %>% filter(NChosen==1) %>% mutate(scaledMeanValue=scale(meanValue),
                                                            scaledValueDiff=scale(valueDiff),
                                                            scaledTrialNum=scale(trialN))


model.conflict.ns.n1 <- lmerTest::lmer(conflict ~ catChoiceCondition * poly(scaledMeanValue,2) + catChoiceCondition * scaledValueDiff + scaledTrialNum + (1 + catChoiceCondition * poly(scaledMeanValue,2) + catChoiceCondition * scaledValueDiff + scaledTrialNum|participant),data=df.ns.1)


tab_model(model.conflict.12.n1,model.conflict.ns.n1,transform = NULL,show.re.var = F,pred.labels = c("Intercept","Inclusivity","Overall Value","Overall Value^2","Relative Value","Trial Order","Incl by OV","Incl by OV^2","Incl by RV"),dv.labels = c("Study 1","Study 3A"),show.icc=F,show.ngroups = F,show.obs = F,show.r2 = F,show.stat = T)
```